<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>SEO-отчёт: {{ card.overview.title if card.overview and card.overview.title else 'Без названия' }}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f9f9f9; }
        h1, h2, h3 { color: #2d3a4a; }
        .score { font-size: 2em; color: #2e7d32; }
        .recommendations { background: #fffbe7; padding: 15px; border-radius: 8px; }
        .card-info, .section { background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        ul { margin: 0 0 0 20px; }
        table { border-collapse: collapse; width: 100%; background: #fff; margin-bottom: 20px; }
        th, td { border: 1px solid #e0e0e0; padding: 8px 12px; text-align: left; }
        th { background: #f0f0f0; }
        .ok { color: #2e7d32; font-weight: bold; }
        .bad { color: #c62828; font-weight: bold; }
        .photo-thumb { max-width: 120px; max-height: 90px; margin: 2px; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>SEO-анализ страницы Яндекс.Карт</h1>
    <div class="card-info">
        <h2>{{ card.overview.title if card.overview and card.overview.title else 'Без названия' }}</h2>
        <p><b>Ссылка:</b> <a href="{{ card.overview.site if card.overview and card.overview.site else '#' }}">{{ card.overview.site if card.overview and card.overview.site else 'Нет сайта' }}</a></p>
    </div>
    <div class="score">
        <b>Оценка SEO:</b> {{ analysis.score }} / 100
    </div>
    <div class="recommendations">
        <h2>Рекомендации по улучшению</h2>
        <ul>
            {% for rec in analysis.recommendations %}
            <li>{{ rec }}</li>
            {% endfor %}
        </ul>
    </div>
    <div class="section">
        <h2>Обзор</h2>
        {% if card.overview %}
        <table>
            <tr><th>Название</th><td>{{ card.overview.title | default('') }}</td></tr>
            <tr><th>Рейтинг</th><td>{{ card.overview.rating | default('') }}</td></tr>
            <tr><th>Количество оценок</th><td>{{ card.overview.reviews_count | default('') }}</td></tr>
            <tr><th>Ближайшее метро</th>
                <td>{{ card.nearest_metro.name }}{% if card.nearest_metro.distance %} ({{ card.nearest_metro.distance }}){% endif %}</td>
            </tr>
            <tr><th>Ближайшая остановка</th>
                <td>{{ card.nearest_stop.name }}{% if card.nearest_stop.distance %} ({{ card.nearest_stop.distance }}){% endif %}</td>
            </tr>
            <tr><th>Адрес</th><td>{{ card.overview.address | default('') }}</td></tr>
            <tr><th>Телефон</th><td>{{ card.overview.phone | default('') }}</td></tr>
            <tr><th>Сайт</th><td><a href="{{ card.overview.site | default('#') }}">{{ card.overview.site | default('Нет сайта') }}</a></td></tr>
            <tr><th>Описание</th><td>{{ card.overview.description | default('') }}</td></tr>
            <tr><th>Категории</th><td>{{ card.overview.categories|join(', ') if card.overview.categories else '' }}</td></tr>
            <tr><th>Часы работы</th><td>{{ card.overview.hours | default('') }}</td></tr>
        </table>
        {% else %}<p>Нет данных</p>{% endif %}
    </div>
    <div class="section">
        <h2>Категории товаров и услуг</h2>
        {% if card.product_categories and card.product_categories|length > 0 %}
        <ul>
            {% for cat in card.product_categories %}
            <li>{{ cat }}</li>
            {% endfor %}
        </ul>
        {% else %}<p>Нет данных</p>{% endif %}
    </div>
    <div class="section">
        <h2>Товары и услуги</h2>
        {% if card.products and card.products|length > 0 %}
            {% for cat in card.products %}
                <h3>{{ cat["category"] }}</h3>
                {% if cat["items"] and cat["items"]|length > 0 %}
                <table>
                    <tr>
                        <th>Название</th>
                        <th>Описание</th>
                        <th>Цена</th>
                        <th>Длительность</th>
                        <th>Фото</th>
                    </tr>
                    {% for item in cat["items"] %}
                    <tr>
                        <td>{{ item.name }}</td>
                        <td>{{ item.description }}</td>
                        <td>{{ item.price }}</td>
                        <td>{{ item.duration }}</td>
                        <td>{% if item.photo %}<img src="{{ item.photo }}" alt="{{ item.name }}" style="max-width:80px;max-height:80px;"/>{% endif %}</td>
                    </tr>
                    {% endfor %}
                </table>
                {% else %}<p>Нет товаров в категории</p>{% endif %}
            {% endfor %}
        {% else %}<p>Нет данных</p>{% endif %}
    </div>
    <div class="section">
        <h2>Новости</h2>
        {% if card.news and card.news|length > 0 %}
        <table>
            <tr><th>Дата</th><th>Текст</th><th>Фото</th></tr>
            {% for n in card.news %}
            <tr>
                <td>{{ n.date }}</td>
                <td>{{ n.text }}</td>
                <td>
                    {% if n.photos and n.photos|length > 0 %}
                        {% for photo in n.photos %}
                            <img src="{{ photo }}" style="max-width:80px;max-height:80px;"/>
                        {% endfor %}
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </table>
        {% else %}<p>Нет новостей</p>{% endif %}
    </div>
    <div class="section">
        <h2>Фото</h2>
        {% if card.photos and card.photos|length > 0 %}
            {% for p in card.photos %}
                <img src="{{ p }}" class="photo-thumb">
            {% endfor %}
            <p>Всего фото: {{ card.photos|length }}</p>
        {% else %}<p>Нет фото</p>{% endif %}
    </div>
    <div class="section">
        <h2>Отзывы</h2>
        {% if card.reviews %}
            <p>Средняя оценка: <b>{{ card.reviews.rating | default('') }}</b> | Количество отзывов: <b>{{ card.reviews.reviews_count | default('') }}</b></p>
            {% if card.reviews.items %}
            <table>
                <tr><th>Автор</th><th>Дата</th><th>Оценка</th><th>Текст</th><th>Ответ организации</th></tr>
                {% for r in card.reviews["items"] %}
                <tr>
                    <td>{{ r.author | default('') }}</td>
                    <td>{{ r.date | default('') }}</td>
                    <td>{{ r.score | default('') }}</td>
                    <td>{{ r.text | default('') }}</td>
                    <td>{{ r.org_reply | default('') }}</td>
                </tr>
                {% endfor %}
            </table>
            {% else %}<p>Нет отзывов</p>{% endif %}
        {% else %}
            <p>Нет отзывов</p>
        {% endif %}
    </div>
    <div class="section">
        <h2>Особенности</h2>
        {% set f = card.features_full %}
        {% if f %}
            <h3>Булевые особенности (галочки):</h3>
            {% if f.bool and f.bool|length > 0 %}
            <ul>
                {% for b in f.bool %}
                <li>{{ b.text }}{% if b.defined %} <b>(особая)</b>{% endif %}</li>
                {% endfor %}
            </ul>
            {% else %}<p>Нет булевых особенностей</p>{% endif %}

            <h3>Ценностные особенности (категории услуг):</h3>
            {% if f.valued and f.valued|length > 0 %}
            <ul>
                {% for v in f.valued %}
                <li><b>{{ v.title }}:</b> {{ v.value }}</li>
                {% endfor %}
            </ul>
            {% else %}<p>Нет ценностных особенностей</p>{% endif %}

            <h3>Цены:</h3>
            {% if f.prices and f.prices|length > 0 %}
            <ul>
                {% for p in f.prices %}
                <li><b>{{ p.title }}:</b> {{ p.value }}</li>
                {% endfor %}
            </ul>
            {% else %}<p>Нет цен</p>{% endif %}

            <h3>Категории (из блока «Особенности»):</h3>
            {% if f.categories and f.categories|length > 0 %}
            <ul>
                {% for cat in f.categories %}
                <li>{{ cat }}</li>
                {% endfor %}
            </ul>
            {% else %}<p>Нет категорий</p>{% endif %}
        {% else %}
            <p>Нет данных</p>
        {% endif %}
    </div>
</body>
</html> 