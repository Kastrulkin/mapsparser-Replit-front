<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>SEO Report: {{ card.overview.title if card.overview and card.overview.title else 'No Title' }}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f9f9f9; }
        h1, h2, h3 { color: #2d3a4a; }
        .score { font-size: 2em; color: #2e7d32; }
        .recommendations { background: #fffbe7; padding: 15px; border-radius: 8px; }
        .card-info, .section { background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        ul { margin: 0 0 0 20px; }
        table { border-collapse: collapse; width: 100%; background: #fff; margin-bottom: 20px; }
        th, td { border: 1px solid #e0e0e0; padding: 8px 12px; text-align: left; }
        th { background: #f0f0f0; }
        .ok { color: #2e7d32; font-weight: bold; }
        .bad { color: #c62828; font-weight: bold; }
        .photo-thumb { max-width: 120px; max-height: 90px; margin: 2px; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>SEO Analysis of Yandex Maps Page</h1>
    <div class="card-info">
        <h2>{{ card.overview.title if card.overview and card.overview.title else 'No Title' }}</h2>
        <p><b>Link:</b> <a href="{{ card.overview.site if card.overview and card.overview.site else '#' }}">{{ card.overview.site if card.overview and card.overview.site else 'No Website' }}</a></p>
    </div>
    <div class="score">
        <b>SEO Score:</b> {{ analysis.score }} / 100
    </div>
    <div class="recommendations">
        <h2>Improvement Recommendations</h2>
        {% if analysis.ai_analysis and analysis.ai_analysis.generated_text %}
        <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
            <h3>ü§ñ AI Analysis:</h3>
            <p>{{ analysis.ai_analysis.generated_text }}</p>
        </div>
        {% endif %}
        <ul>
            {% for rec in analysis.recommendations %}
            <li>{{ rec }}</li>
            {% endfor %}
        </ul>
    </div>
    <div class="section">
        <h2>Overview</h2>
        {% if card.overview %}
        <table>
            <tr><th>Title</th><td>{{ card.overview.title | default('') }}</td></tr>
            <tr><th>Rating</th><td>{{ card.overview.rating | default('') }}</td></tr>
            <tr><th>Ratings Count</th><td>{{ card.overview.ratings_count | default('') }}</td></tr>
            <tr><th>Reviews Count</th><td>{{ card.overview.reviews_count | default('') }}</td></tr>
            <tr><th>Nearest Metro</th><td>{% if card.nearest_metro %}{{ card.nearest_metro.name }}{% if card.nearest_metro.distance %} ({{ card.nearest_metro.distance }}){% endif %}{% else %}‚Äî{% endif %}</td></tr>
            <tr><th>Nearest Stop</th><td>{% if card.nearest_stop %}{{ card.nearest_stop.name }}{% if card.nearest_stop.distance %} ({{ card.nearest_stop.distance }}){% endif %}{% else %}‚Äî{% endif %}</td></tr>
            <tr><th>Address</th><td>{{ card.overview.address | default('') }}</td></tr>
            <tr><th>Phone</th><td>{{ card.overview.phone | default('') }}</td></tr>
            <tr><th>Website</th><td>{{ card.overview.site | default('') }}</td></tr>
            <tr><th>Working Hours</th><td>{{ card.overview.hours | default('') }}</td></tr>
        </table>
        {% else %}<p>No data</p>{% endif %}
    </div>
    
    <!-- New section Categories -->
    <div class="section">
        <h2>Categories</h2>
        {% if card.overview.rubric and card.overview.rubric|length > 0 %}
            <ul>
            {% for r in card.overview.rubric %}
                <li>{{ r }}</li>
            {% endfor %}
            </ul>
        {% else %}
            <p>‚Äî</p>
        {% endif %}
    </div>
    <div class="section">
        <h2>Product and Service Categories</h2>
        {% if card.product_categories and card.product_categories|length > 0 %}
        <ul>
            {% for cat in card.product_categories %}
            <li>{{ cat }}</li>
            {% endfor %}
        </ul>
        {% else %}<p>No data</p>{% endif %}
    </div>
    <div class="section">
        <h2>Products and Services</h2>
        {% if card.products and card.products|length > 0 %}
            {% for cat in card.products %}
                <h3>{{ cat["category"] }}</h3>
                {% if cat["items"] and cat["items"]|length > 0 %}
                <table>
                    <tr>
                        <th>Name</th>
                        <th>Description</th>
                        <th>Price</th>
                        <th>Duration</th>
                        <th>Photo</th>
                    </tr>
                    {% for item in cat["items"] %}
                    <tr>
                        <td>{{ item.name }}</td>
                        <td>{{ item.description }}</td>
                        <td>{{ item.price }}</td>
                        <td>{{ item.duration }}</td>
                        <td>{% if item.photo %}<img src="{{ item.photo }}" alt="{{ item.name }}" style="max-width:80px;max-height:80px;"/>{% endif %}</td>
                    </tr>
                    {% endfor %}
                </table>
                {% else %}<p>No products in category</p>{% endif %}
            {% endfor %}
        {% else %}<p>No data</p>{% endif %}
    </div>
    <div class="section">
        <h2>–ù–æ–≤–æ—Å—Ç–∏</h2>
        {% if card.news and card.news|length > 0 %}
        <table>
            <tr><th>–î–∞—Ç–∞</th><th>–¢–µ–∫—Å—Ç</th><th>–§–æ—Ç–æ</th></tr>
            {% for n in card.news %}
            <tr>
                <td>{{ n.date }}</td>
                <td>{{ n.text }}</td>
                <td>
                    {% if n.photos and n.photos|length > 0 %}
                        {% for photo in n.photos %}
                            <img src="{{ photo }}" style="max-width:80px;max-height:80px;"/>
                        {% endfor %}
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </table>
        {% else %}<p>–ù–µ—Ç –Ω–æ–≤–æ—Å—Ç–µ–π</p>{% endif %}
    </div>
    <div class="section">
        <h2>–§–æ—Ç–æ</h2>
        {% if card.photos and card.photos|length > 0 %}
            {% for p in card.photos %}
                <img src="{{ p }}" class="photo-thumb">
            {% endfor %}
            <p>–í—Å–µ–≥–æ —Ñ–æ—Ç–æ: {{ card.photos|length }}</p>
        {% else %}<p>–ù–µ—Ç —Ñ–æ—Ç–æ</p>{% endif %}
    </div>
    <div class="section">
        <h2>–û—Ç–∑—ã–≤—ã</h2>
        <div style="color:#c62828; font-size:1em; margin-bottom:10px;">
            <b>–í–Ω–∏–º–∞–Ω–∏–µ:</b> –í –æ—Ç—á—ë—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–µ –≤—Å–µ –æ—Ç–∑—ã–≤—ã. –Ø–Ω–¥–µ–∫—Å –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∑—ã–≤–æ–≤, –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–±–æ—Ä–∞ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –û–±—ã—á–Ω–æ —É–¥–∞—ë—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å –æ—Ç–∑—ã–≤–æ–≤ (40‚Äì120), –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ —É–∫–∞–∑–∞–Ω–æ –±–æ–ª—å—à–µ.
        </div>
        {% if card.reviews %}
            <p>–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞: <b>{{ card.reviews.rating | default('') }}</b> | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∑—ã–≤–æ–≤: <b>{{ card.reviews.reviews_count | default('') }}</b></p>
            {% if card.reviews.items %}
            <p><b>–í—Å–µ–≥–æ —Å–ø–∞—Ä—Å–∏–ª–æ—Å—å –æ—Ç–∑—ã–≤–æ–≤: {{ card.reviews["items"]|length }}</b></p>
            <table>
                <tr><th>‚Ññ</th><th>–ê–≤—Ç–æ—Ä</th><th>–î–∞—Ç–∞</th><th>–û—Ü–µ–Ω–∫–∞</th><th>–¢–µ–∫—Å—Ç</th><th>–û—Ç–≤–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏</th></tr>
                {% for r in card.reviews["items"] %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ r.author | default('') }}</td>
                    <td>{{ r.date | default('') }}</td>
                    <td>{{ r.score | default('') }}</td>
                    <td>{{ r.text | default('') }}</td>
                    <td>{{ r.org_reply | default('') }}</td>
                </tr>
                {% endfor %}
            </table>
            {% else %}<p>–ù–µ—Ç –æ—Ç–∑—ã–≤–æ–≤</p>{% endif %}
        {% else %}
            <p>–ù–µ—Ç –æ—Ç–∑—ã–≤–æ–≤</p>
        {% endif %}
    </div>
    <div class="section">
        <h2>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</h2>
        {% set f = card.features_full %}
        {% if f %}
            <h3>–ë—É–ª–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ (–≥–∞–ª–æ—á–∫–∏):</h3>
            {% if f.bool and f.bool|length > 0 %}
            <ul>
                {% for b in f.bool %}
                <li>{% if b.text %}{{ b.text }}{% else %}{{ b }}{% endif %}{% if b.defined %} <b>(–æ—Å–æ–±–∞—è)</b>{% endif %}</li>
                {% endfor %}
            </ul>
            {% else %}<p>–ù–µ—Ç –±—É–ª–µ–≤—ã—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π</p>{% endif %}

            <h3>–¶–µ–Ω–Ω–æ—Å—Ç–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É—Å–ª—É–≥):</h3>
            {% if f.valued and f.valued|length > 0 %}
            <ul>
                {% for v in f.valued %}
                <li><b>{{ v.title }}:</b> {{ v.value }}</li>
                {% endfor %}
            </ul>
            {% else %}<p>–ù–µ—Ç —Ü–µ–Ω–Ω–æ—Å—Ç–Ω—ã—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π</p>{% endif %}

            <h3>–¶–µ–Ω—ã:</h3>
            {% if f.prices and f.prices|length > 0 %}
            <ul>
                {% for p in f.prices %}
                <li><b>{{ p.title }}:</b> {{ p.value }}</li>
                {% endfor %}
            </ul>
            {% else %}<p>–ù–µ—Ç —Ü–µ–Ω</p>{% endif %}

            <h3>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (–∏–∑ –±–ª–æ–∫–∞ ¬´–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏¬ª):</h3>
            {% if f.categories and f.categories|length > 0 %}
            <ul>
                {% for cat in f.categories %}
                <li>{{ cat }}</li>
                {% endfor %}
            </ul>
            {% else %}<p>–ù–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π</p>{% endif %}
        {% else %}
            <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>
        {% endif %}
    </div>

    {% if competitor %}
    <div class="section competitor-section" style="border-top: 3px solid #e74c3c; margin-top: 30px; padding-top: 20px;">
        <h1 style="color: #e74c3c;">–ê–ù–ê–õ–ò–ó –ö–û–ù–ö–£–†–ï–ù–¢–ê</h1>
        {% if competitor.status %}
            <p style="color: #e74c3c; font-weight: bold;">{{ competitor.status }}</p>
        {% else %}
            <div class="section">
                <h2>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞</h2>
                <table>
                    <tr><th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th><th>–ó–Ω–∞—á–µ–Ω–∏–µ</th></tr>
                    <tr><td>–ù–∞–∑–≤–∞–Ω–∏–µ</td><td>{{ competitor.overview.title or '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}</td></tr>
                    <tr><td>–ê–¥—Ä–µ—Å</td><td>{{ competitor.overview.address or '–ù–µ —É–∫–∞–∑–∞–Ω' }}</td></tr>
                    <tr><td>–¢–µ–ª–µ—Ñ–æ–Ω</td><td>{{ competitor.overview.phone or '–ù–µ —É–∫–∞–∑–∞–Ω' }}</td></tr>
                    <tr><td>–°–∞–π—Ç</td><td>{{ competitor.overview.site or '–ù–µ —É–∫–∞–∑–∞–Ω' }}</td></tr>
                    <tr><td>–†–µ–π—Ç–∏–Ω–≥</td><td>{{ competitor.overview.rating or '–ù–µ —É–∫–∞–∑–∞–Ω' }}</td></tr>
                    <tr><td>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ü–µ–Ω–æ–∫</td><td>{{ competitor.overview.ratings_count or '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}</td></tr>
                    <tr><td>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∑—ã–≤–æ–≤</td><td>{{ competitor.overview.reviews_count or '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}</td></tr>
                    <tr><td>–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã</td><td>{{ competitor.overview.hours or '–ù–µ —É–∫–∞–∑–∞–Ω—ã' }}</td></tr>
                </table>
            </div>
            {% if competitor.products %}
            <div class="section">
                <h2>–¢–æ–≤–∞—Ä—ã –∏ —É—Å–ª—É–≥–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞</h2>
                {% for category in competitor.products %}
                <h3>{{ category.category }}</h3>
                <table>
                    <tr><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th><th>–¶–µ–Ω–∞</th><th>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</th><th>–§–æ—Ç–æ</th></tr>
                    {% for item in category.items %}
                    <tr>
                        <td>{{ item.name }}</td>
                        <td>{{ item.description }}</td>
                        <td>{{ item.price }}</td>
                        <td>{{ item.duration }}</td>
                        <td>{% if item.photo %}<img src="{{ item.photo }}" style="max-width:80px;max-height:80px;">{% endif %}</td>
                    </tr>
                    {% endfor %}
                </table>
                {% endfor %}
            </div>
            {% endif %}
            {% if competitor.reviews.items %}
            <div class="section">
                <h2>–û—Ç–∑—ã–≤—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞</h2>
                <p>–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞: <b>{{ competitor.reviews.rating }}</b> | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∑—ã–≤–æ–≤: <b>{{ competitor.reviews.reviews_count }}</b></p>
                <p><b>–í—Å–µ–≥–æ —Å–ø–∞—Ä—Å–∏–ª–æ—Å—å –æ—Ç–∑—ã–≤–æ–≤: {{ competitor.reviews.items|length }}</b></p>
                
                <table>
                    <tr><th>‚Ññ</th><th>–ê–≤—Ç–æ—Ä</th><th>–î–∞—Ç–∞</th><th>–û—Ü–µ–Ω–∫–∞</th><th>–¢–µ–∫—Å—Ç</th><th>–û—Ç–≤–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏</th></tr>
                    {% for review in competitor.reviews.items[:10] %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ review.author }}</td>
                        <td>{{ review.date }}</td>
                        <td>{{ review.score }}</td>
                        <td>{{ review.text }}</td>
                        <td>{{ review.org_reply }}</td>
                    </tr>
                    {% endfor %}
                </table>
                {% if competitor.reviews.items|length > 10 %}
                <p><i>–ü–æ–∫–∞–∑–∞–Ω—ã –ø–µ—Ä–≤—ã–µ 10 –æ—Ç–∑—ã–≤–æ–≤ –∏–∑ {{ competitor.reviews.items|length }}</i></p>
                {% endif %}
            </div>
            {% endif %}
            <div class="section">
                <h2>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–æ–π</h2>
                <table>
                    <tr><th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th><th>–û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞</th><th>–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç</th></tr>
                    <tr>
                        <td>–†–µ–π—Ç–∏–Ω–≥</td>
                        <td>{{ card.overview.rating or '–ù–µ —É–∫–∞–∑–∞–Ω' }}</td>
                        <td>{{ competitor.overview.rating or '–ù–µ —É–∫–∞–∑–∞–Ω' }}</td>
                    </tr>
                    <tr>
                        <td>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ü–µ–Ω–æ–∫</td>
                        <td>{{ card.overview.ratings_count or '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}</td>
                        <td>{{ competitor.overview.ratings_count or '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}</td>
                    </tr>
                    <tr>
                        <td>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∑—ã–≤–æ–≤</td>
                        <td>{{ card.overview.reviews_count or '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}</td>
                        <td>{{ competitor.overview.reviews_count or '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}</td>
                    </tr>
                    <tr>
                        <td>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–æ—Ç–æ</td>
                        <td>{{ card.photos_count or 0 }}</td>
                        <td>{{ competitor.photos_count or 0 }}</td>
                    </tr>
                    <tr>
                        <td>–ù–∞–ª–∏—á–∏–µ —Å–∞–π—Ç–∞</td>
                        <td>{% if card.overview.site %}–ï—Å—Ç—å{% else %}–ù–µ—Ç{% endif %}</td>
                        <td>{% if competitor.overview.site %}–ï—Å—Ç—å{% else %}–ù–µ—Ç{% endif %}</td>
                    </tr>
                    <tr>
                        <td>–ù–∞–ª–∏—á–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞</td>
                        <td>{% if card.overview.phone %}–ï—Å—Ç—å{% else %}–ù–µ—Ç{% endif %}</td>
                        <td>{% if competitor.overview.phone %}–ï—Å—Ç—å{% else %}–ù–µ—Ç{% endif %}</td>
                    </tr>
                </table>
            </div>
        {% endif %}
    </div>
    {% endif %}

</body>
</html> 