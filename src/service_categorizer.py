#!/usr/bin/env python3
"""
–°–∏—Å—Ç–µ–º–∞ —É–º–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ —É—Å–ª—É–≥ –¥–ª—è BeautyBot
"""

import re
from typing import Dict, List, Tuple, Optional
from dataclasses import dataclass

@dataclass
class ServiceCategory:
    """–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ª—É–≥–∏"""
    name: str
    keywords: List[str]
    wordstat_queries: List[str]
    priority: int = 1

class ServiceCategorizer:
    """–£–º–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ª—É–≥ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º –∏ –∑–∞–ø—Ä–æ—Å–∞–º –í–æ—Ä–¥—Å—Ç–∞—Ç–∞"""
    
    def __init__(self):
        self.categories = self._init_categories()
        self.wordstat_queries = self._load_wordstat_queries()
    
    def _init_categories(self) -> Dict[str, ServiceCategory]:
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π —É—Å–ª—É–≥"""
        return {
            'hair': ServiceCategory(
                name='–°—Ç—Ä–∏–∂–∫–∏ –∏ —É–∫–ª–∞–¥–∫–∏',
                keywords=[
                    '—Å—Ç—Ä–∏–∂–∫–∞', '—É–∫–ª–∞–¥–∫–∞', '–ø—Ä–∏—á–µ—Å–∫–∞', '–≤–æ–ª–æ—Å—ã', '–ø–∞—Ä–∏–∫–º–∞—Ö–µ—Ä',
                    '–±–æ–±', '–∫–∞—Ä–µ', '–ø–∏–∫—Å–∏', '–∫–∞—Å–∫–∞–¥', '–ª–µ—Å–µ–Ω–∫–∞', '–∞—Å–∏–º–º–µ—Ç—Ä–∏—è',
                    '—á–µ–ª–∫–∞', '–±–∞–Ω–≥—Å', '—Å—Ç—Ä–∏–∂–∫–∞ –∂–µ–Ω—Å–∫–∞—è', '—Å—Ç—Ä–∏–∂–∫–∞ –º—É–∂—Å–∫–∞—è',
                    '–¥–µ—Ç—Å–∫–∞—è —Å—Ç—Ä–∏–∂–∫–∞', '–∫—Ä–µ–∞—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä–∏–∂–∫–∞'
                ],
                wordstat_queries=[
                    '—Å—Ç—Ä–∏–∂–∫–∞ –∂–µ–Ω—Å–∫–∞—è', '—Å—Ç—Ä–∏–∂–∫–∞ –º—É–∂—Å–∫–∞—è', '—É–∫–ª–∞–¥–∫–∞ –≤–æ–ª–æ—Å',
                    '–ø–∞—Ä–∏–∫–º–∞—Ö–µ—Ä—Å–∫–∞—è', '—Å—Ç—Ä–∏–∂–∫–∞ –≤ —Å–∞–ª–æ–Ω–µ', '–¥–µ—Ç—Å–∫–∞—è —Å—Ç—Ä–∏–∂–∫–∞'
                ],
                priority=1
            ),
            'cosmetology': ServiceCategory(
                name='–ö–æ—Å–º–µ—Ç–æ–ª–æ–≥–∏—è',
                keywords=[
                    '–∫–æ—Å–º–µ—Ç–æ–ª–æ–≥–∏—è', '–∫–æ—Å–º–µ—Ç–æ–ª–æ–≥', '—á–∏—Å—Ç–∫–∞ –ª–∏—Ü–∞', '–ø–∏–ª–∏–Ω–≥ –ª–∏—Ü–∞',
                    '–±–æ—Ç–æ–∫—Å', '–¥–∏—Å–ø–æ—Ä—Ç', '–∫–æ–Ω—Ç—É—Ä–Ω–∞—è –ø–ª–∞—Å—Ç–∏–∫–∞', '—Ñ–∏–ª–ª–µ—Ä—ã',
                    '–≥–∏–∞–ª—É—Ä–æ–Ω–æ–≤–∞—è –∫–∏—Å–ª–æ—Ç–∞', '–±–∏–æ—Ä–µ–≤–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è', '–º–µ–∑–æ—Ç–µ—Ä–∞–ø–∏—è',
                    '–ø–ª–∞–∑–º–æ–ª–∏—Ñ—Ç–∏–Ω–≥', 'rf-–ª–∏—Ñ—Ç–∏–Ω–≥', 'smas-–ª–∏—Ñ—Ç–∏–Ω–≥', '—É–ª—å—Ç—Ä–∞–∑–≤—É–∫–æ–≤–æ–π smas',
                    '–ª–∞–∑–µ—Ä–Ω–∞—è —ç–ø–∏–ª—è—Ü–∏—è', '—Ñ–æ—Ç–æ—ç–ø–∏–ª—è—Ü–∏—è', '–ª–∞–∑–µ—Ä–Ω–æ–µ –æ–º–æ–ª–æ–∂–µ–Ω–∏–µ',
                    '–ª–∞–∑–µ—Ä–Ω–∞—è —à–ª–∏—Ñ–æ–≤–∫–∞', '–Ω–∏—Ç–µ–≤–æ–π –ª–∏—Ñ—Ç–∏–Ω–≥', '–ª–∏–ø–æ–ª–∏—Ç–∏–∫–∏',
                    '–º–∏–∫—Ä–æ—Ç–æ–∫–∏', '–∞–ø–ø–∞—Ä–∞—Ç–Ω–∞—è –∫–æ—Å–º–µ—Ç–æ–ª–æ–≥–∏—è', '–¥–µ—Ä–º–∞–ø–µ–Ω', '–º–∏–∫—Ä–æ–Ω–∏–¥–ª–∏–Ω–≥',
                    '–∞–Ω—Ç–∏–≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã', '–ª–µ—á–µ–Ω–∏–µ –∞–∫–Ω–µ', '–ø–æ—Å—Ç–∞–∫–Ω–µ', '–∫—É–ø–µ—Ä–æ–∑',
                    '—É—Ö–æ–¥ –∑–∞ –∫–æ–∂–µ–π', '–æ–º–æ–ª–æ–∂–µ–Ω–∏–µ –ª–∏—Ü–∞', '–º–∞—Å–∫–∞ –¥–ª—è –ª–∏—Ü–∞'
                ],
                wordstat_queries=[
                    '–∫–æ—Å–º–µ—Ç–æ–ª–æ–≥–∏—è', '–∫–æ—Å–º–µ—Ç–æ–ª–æ–≥', '—á–∏—Å—Ç–∫–∞ –ª–∏—Ü–∞', '–ø–∏–ª–∏–Ω–≥ –ª–∏—Ü–∞',
                    '–±–æ—Ç–æ–∫—Å', '–∫–æ–Ω—Ç—É—Ä–Ω–∞—è –ø–ª–∞—Å—Ç–∏–∫–∞', '—Ñ–∏–ª–ª–µ—Ä—ã',
                    '–±–∏–æ—Ä–µ–≤–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è', '–º–µ–∑–æ—Ç–µ—Ä–∞–ø–∏—è', '–ª–∞–∑–µ—Ä–Ω–∞—è —ç–ø–∏–ª—è—Ü–∏—è',
                    '–ª–∞–∑–µ—Ä–Ω–æ–µ –æ–º–æ–ª–æ–∂–µ–Ω–∏–µ', '–Ω–∏—Ç–µ–≤–æ–π –ª–∏—Ñ—Ç–∏–Ω–≥', 'rf-–ª–∏—Ñ—Ç–∏–Ω–≥', 'smas-–ª–∏—Ñ—Ç–∏–Ω–≥'
                ],
                priority=2
            ),
            'coloring': ServiceCategory(
                name='–û–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ',
                keywords=[
                    '–æ–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ', '–ø–æ–∫—Ä–∞—Å–∫–∞', '–º–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ', '–∫–æ–ª–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ',
                    '—Ç–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ', '–±–ª–æ–Ω–¥–∏—Ä–æ–≤–∞–Ω–∏–µ', '–æ—Å–≤–µ—Ç–ª–µ–Ω–∏–µ', '–±–∞–ª–∞—è–∂',
                    '—à–∞—Ç—É—à', '–æ–º–±—Ä–µ', '–∞–π—Ä—Ç–∞—á', '–±—Ä–∞–∑–∏–ª—å—Å–∫–æ–µ –æ–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ',
                    '—Å–∫—Ä—ã—Ç–æ–µ –æ–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ', '–∫–æ–Ω—Ç—É—Ä–∏–Ω–≥', '—Ä–µ—Ñ–ª–µ–∫—Å'
                ],
                wordstat_queries=[
                    '–æ–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ –≤–æ–ª–æ—Å', '–º–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ', '–∫–æ–ª–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ',
                    '—Ç–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ', '–±–ª–æ–Ω–¥–∏—Ä–æ–≤–∞–Ω–∏–µ', '–±–∞–ª–∞—è–∂', '—à–∞—Ç—É—à'
                ],
                priority=1
            ),
            'nails': ServiceCategory(
                name='–ú–∞–Ω–∏–∫—é—Ä –∏ –ø–µ–¥–∏–∫—é—Ä',
                keywords=[
                    '–º–∞–Ω–∏–∫—é—Ä', '–ø–µ–¥–∏–∫—é—Ä', '–Ω–æ–≥—Ç–∏', '–≥–µ–ª—å-–ª–∞–∫', '—à–µ–ª–ª–∞–∫',
                    '–Ω–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ', '—Ñ—Ä–µ–Ω—á', '—Ñ—Ä–µ–Ω—á-–º–∞–Ω–∏–∫—é—Ä', '–¥–∏–∑–∞–π–Ω –Ω–æ–≥—Ç–µ–π',
                    '–ø–∞—Ä–∞—Ñ–∏–Ω–æ—Ç–µ—Ä–∞–ø–∏—è', '–æ–±—Ä–µ–∑–Ω–æ–π –º–∞–Ω–∏–∫—é—Ä', '–µ–≤—Ä–æ–ø–µ–π—Å–∫–∏–π –º–∞–Ω–∏–∫—é—Ä',
                    '–∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–π –º–∞–Ω–∏–∫—é—Ä', '–ø–æ–∫—Ä—ã—Ç–∏–µ –≥–µ–ª—å-–ª–∞–∫'
                ],
                wordstat_queries=[
                    '–º–∞–Ω–∏–∫—é—Ä', '–ø–µ–¥–∏–∫—é—Ä', '–≥–µ–ª—å-–ª–∞–∫', '–Ω–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ –Ω–æ–≥—Ç–µ–π',
                    '–¥–∏–∑–∞–π–Ω –Ω–æ–≥—Ç–µ–π', '—Ñ—Ä–µ–Ω—á-–º–∞–Ω–∏–∫—é—Ä'
                ],
                priority=2
            ),
            'eyebrows': ServiceCategory(
                name='–ë—Ä–æ–≤–∏ –∏ —Ä–µ—Å–Ω–∏—Ü—ã',
                keywords=[
                    '–±—Ä–æ–≤–∏', '—Ä–µ—Å–Ω–∏—Ü—ã', '–∫–æ—Ä—Ä–µ–∫—Ü–∏—è –±—Ä–æ–≤–µ–π', '–æ–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ –±—Ä–æ–≤–µ–π',
                    '–ª–∞–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±—Ä–æ–≤–µ–π', '–Ω–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ —Ä–µ—Å–Ω–∏—Ü', '–æ–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ —Ä–µ—Å–Ω–∏—Ü',
                    '–Ω–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ –±—Ä–æ–≤–µ–π', '–º–∏–∫—Ä–æ–±–ª–µ–π–¥–∏–Ω–≥', '—Ç–∞—Ç—É–∞–∂ –±—Ä–æ–≤–µ–π',
                    '–ª–∞–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Å–Ω–∏—Ü', '–∑–∞–≤–∏–≤–∫–∞ —Ä–µ—Å–Ω–∏—Ü'
                ],
                wordstat_queries=[
                    '–±—Ä–æ–≤–∏', '—Ä–µ—Å–Ω–∏—Ü—ã', '–∫–æ—Ä—Ä–µ–∫—Ü–∏—è –±—Ä–æ–≤–µ–π', '–Ω–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ —Ä–µ—Å–Ω–∏—Ü',
                    '–ª–∞–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±—Ä–æ–≤–µ–π', '–º–∏–∫—Ä–æ–±–ª–µ–π–¥–∏–Ω–≥'
                ],
                priority=2
            ),
            'spa': ServiceCategory(
                name='–ú–∞—Å—Å–∞–∂ –∏ –°–ü–ê',
                keywords=[
                    '–º–∞—Å—Å–∞–∂', '—Å–ø–∞', '–æ–±–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ', '–ø–∏–ª–∏–Ω–≥', '—Å–∫—Ä–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ',
                    '–∞–Ω—Ç–∏—Ü–µ–ª–ª—é–ª–∏—Ç–Ω—ã–π –º–∞—Å—Å–∞–∂', '—Ä–µ–ª–∞–∫—Å –º–∞—Å—Å–∞–∂', '–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –º–∞—Å—Å–∞–∂',
                    '–ª–∏–º—Ñ–æ–¥—Ä–µ–Ω–∞–∂–Ω—ã–π –º–∞—Å—Å–∞–∂', '—Ç–∞–π—Å–∫–∏–π –º–∞—Å—Å–∞–∂', '–∞—Ä–æ–º–∞—Ç–µ—Ä–∞–ø–∏—è',
                    '—Å–æ–ª–µ–≤–æ–µ –æ–±–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ', '—à–æ–∫–æ–ª–∞–¥–Ω–æ–µ –æ–±–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ'
                ],
                wordstat_queries=[
                    '–º–∞—Å—Å–∞–∂', '—Å–ø–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã', '–æ–±–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ', '–∞–Ω—Ç–∏—Ü–µ–ª–ª—é–ª–∏—Ç–Ω—ã–π –º–∞—Å—Å–∞–∂',
                    '—Ä–µ–ª–∞–∫—Å –º–∞—Å—Å–∞–∂', '–∞—Ä–æ–º–∞—Ç–µ—Ä–∞–ø–∏—è'
                ],
                priority=3
            ),
            'barber': ServiceCategory(
                name='–ë–∞—Ä–±–µ—Ä—à–æ–ø',
                keywords=[
                    '–±–∞—Ä–±–µ—Ä—à–æ–ø', '–º—É–∂—Å–∫–∞—è —Å—Ç—Ä–∏–∂–∫–∞', '–±–æ—Ä–æ–¥–∞', '—É—Å—ã', '–±—Ä–∏—Ç—å–µ',
                    '—Å—Ç—Ä–∏–∂–∫–∞ –±–æ—Ä–æ–¥—ã', '–∫–æ—Ä—Ä–µ–∫—Ü–∏—è –±–æ—Ä–æ–¥—ã', '—É–∫–ª–∞–¥–∫–∞ –±–æ—Ä–æ–¥—ã',
                    '–º—É–∂—Å–∫–æ–π –º–∞–Ω–∏–∫—é—Ä', '–º—É–∂—Å–∫–æ–π –ø–µ–¥–∏–∫—é—Ä', '—Å—Ç—Ä–∏–∂–∫–∞ –ø–æ–¥ –º–∞—à–∏–Ω–∫—É',
                    '–∫—Ä–µ–∞—Ç–∏–≤–Ω–∞—è –º—É–∂—Å–∫–∞—è —Å—Ç—Ä–∏–∂–∫–∞'
                ],
                wordstat_queries=[
                    '–±–∞—Ä–±–µ—Ä—à–æ–ø', '–º—É–∂—Å–∫–∞—è —Å—Ç—Ä–∏–∂–∫–∞', '—Å—Ç—Ä–∏–∂–∫–∞ –±–æ—Ä–æ–¥—ã', '–º—É–∂—Å–∫–æ–π –º–∞–Ω–∏–∫—é—Ä',
                    '—Å—Ç—Ä–∏–∂–∫–∞ –ø–æ–¥ –º–∞—à–∏–Ω–∫—É'
                ],
                priority=2
            ),
            'other': ServiceCategory(
                name='–î—Ä—É–≥–∏–µ —É—Å–ª—É–≥–∏',
                keywords=[],
                wordstat_queries=[],
                priority=10
            )
        }
    
    def _load_wordstat_queries(self) -> Dict[str, List[str]]:
        """–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ —Ñ–∞–π–ª–∞"""
        try:
            with open('../prompts/popular_queries_with_clicks.txt', 'r', encoding='utf-8') as f:
                content = f.read()
            
            # –ü–∞—Ä—Å–∏–º –∑–∞–ø—Ä–æ—Å—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
            queries_by_category = {}
            current_category = None
            
            for line in content.split('\n'):
                line = line.strip()
                if line.startswith('## '):
                    current_category = line[3:].strip()
                    queries_by_category[current_category] = []
                elif line.startswith('- ') and current_category:
                    # –ò–∑–≤–ª–µ–∫–∞–µ–º –∑–∞–ø—Ä–æ—Å –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∫–∞–∑–æ–≤
                    query = line[2:].split(' (')[0].strip()
                    queries_by_category[current_category].append(query)
            
            return queries_by_category
            
        except FileNotFoundError:
            print("‚ö†Ô∏è  –§–∞–π–ª —Å –ø–æ–ø—É–ª—è—Ä–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω")
            return {}
        except Exception as e:
            print(f"‚ö†Ô∏è  –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤: {e}")
            return {}
    
    def categorize_service(self, service_name: str, service_description: str = "") -> Tuple[str, float, List[str]]:
        """
        –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ª—É–≥–∏
        
        Args:
            service_name: –ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏
            service_description: –û–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª—É–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            
        Returns:
            Tuple[category_key, confidence, matched_keywords]
        """
        text = f"{service_name} {service_description}".lower()
        
        # –°—á–µ—Ç—á–∏–∫–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        category_scores = {}
        matched_keywords = {}
        
        for category_key, category in self.categories.items():
            score = 0
            matched = []
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            for keyword in category.keywords:
                if keyword.lower() in text:
                    score += category.priority * 2  # –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤–µ—Å—è—Ç –±–æ–ª—å—à–µ
                    matched.append(keyword)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –í–æ—Ä–¥—Å—Ç–∞—Ç–∞
            if category_key in self.wordstat_queries:
                for query in self.wordstat_queries[category_key]:
                    if query.lower() in text:
                        score += category.priority * 1.5
                        matched.append(query)
            
            if score > 0:
                category_scores[category_key] = score
                matched_keywords[category_key] = matched
        
        if not category_scores:
            return 'other', 0.0, []
        
        # –ù–∞—Ö–æ–¥–∏–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º —Å—á–µ—Ç–æ–º
        best_category = max(category_scores.items(), key=lambda x: x[1])
        confidence = min(best_category[1] / 10.0, 1.0)  # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –¥–æ 0-1
        
        return best_category[0], confidence, matched_keywords[best_category[0]]
    
    def get_category_info(self, category_key: str) -> Optional[ServiceCategory]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"""
        return self.categories.get(category_key)
    
    def get_suggested_queries(self, category_key: str, limit: int = 10) -> List[str]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"""
        if category_key not in self.wordstat_queries:
            return []
        
        queries = self.wordstat_queries[category_key]
        return queries[:limit]
    
    def analyze_service_text(self, text: str) -> Dict:
        """–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞ —É—Å–ª—É–≥–∏ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —É–ª—É—á—à–µ–Ω–∏–π"""
        category, confidence, matched = self.categorize_service(text)
        category_info = self.get_category_info(category)
        suggested_queries = self.get_suggested_queries(category, 5)
        
        return {
            'category': category,
            'category_name': category_info.name if category_info else '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
            'confidence': confidence,
            'matched_keywords': matched,
            'suggested_queries': suggested_queries,
            'improvements': self._suggest_improvements(text, category, suggested_queries)
        }
    
    def _suggest_improvements(self, text: str, category: str, suggested_queries: List[str]) -> List[str]:
        """–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é —Ç–µ–∫—Å—Ç–∞ —É—Å–ª—É–≥–∏"""
        improvements = []
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Ç–µ–∫—Å—Ç–µ
        text_lower = text.lower()
        missing_queries = []
        
        for query in suggested_queries[:3]:  # –¢–æ–ø-3 –∑–∞–ø—Ä–æ—Å–∞
            if query.lower() not in text_lower:
                missing_queries.append(query)
        
        if missing_queries:
            improvements.append(f"–î–æ–±–∞–≤—å—Ç–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã: {', '.join(missing_queries)}")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏–Ω—É –æ–ø–∏—Å–∞–Ω–∏—è
        if len(text) < 50:
            improvements.append("–£–≤–µ–ª–∏—á—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª—É–≥–∏ (–º–∏–Ω–∏–º—É–º 50 —Å–∏–º–≤–æ–ª–æ–≤)")
        elif len(text) > 200:
            improvements.append("–°–æ–∫—Ä–∞—Ç–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤)")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
        category_info = self.get_category_info(category)
        if category_info:
            missing_keywords = []
            for keyword in category_info.keywords[:5]:  # –¢–æ–ø-5 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
                if keyword.lower() not in text_lower:
                    missing_keywords.append(keyword)
            
            if missing_keywords:
                improvements.append(f"–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: {', '.join(missing_keywords[:3])}")
        
        return improvements

# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ç–æ—Ä–∞
categorizer = ServiceCategorizer()

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
if __name__ == "__main__":
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—é
    test_services = [
        "–°—Ç—Ä–∏–∂–∫–∞ –∂–µ–Ω—Å–∫–∞—è —Å —É–∫–ª–∞–¥–∫–æ–π",
        "–û–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ –≤–æ–ª–æ—Å –º–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ",
        "–ú–∞–Ω–∏–∫—é—Ä –≥–µ–ª—å-–ª–∞–∫ —Å –¥–∏–∑–∞–π–Ω–æ–º",
        "–ö–æ—Ä—Ä–µ–∫—Ü–∏—è –±—Ä–æ–≤–µ–π –∏ –æ–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ",
        "–ê–Ω—Ç–∏—Ü–µ–ª–ª—é–ª–∏—Ç–Ω—ã–π –º–∞—Å—Å–∞–∂",
        "–ú—É–∂—Å–∫–∞—è —Å—Ç—Ä–∏–∂–∫–∞ –ø–æ–¥ –º–∞—à–∏–Ω–∫—É"
    ]
    
    print("üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ —É—Å–ª—É–≥:")
    print("=" * 50)
    
    for service in test_services:
        result = categorizer.analyze_service_text(service)
        print(f"\nüìù –£—Å–ª—É–≥–∞: {service}")
        print(f"üè∑Ô∏è  –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {result['category_name']} (—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {result['confidence']:.2f})")
        print(f"üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: {', '.join(result['matched_keywords'])}")
        if result['suggested_queries']:
            print(f"üí° –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã: {', '.join(result['suggested_queries'])}")
        if result['improvements']:
            print(f"‚ú® –£–ª—É—á—à–µ–Ω–∏—è: {'; '.join(result['improvements'])}")
