# –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞ SEO —Å –†–µ–ø–ª–∏—Ç –Ω–∞ –ö—É—Ä—Å–æ—Ä–µ

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 24 –¥–µ–∫–∞–±—Ä—è 2025

## üéØ –¢–µ–∫—É—â–∏–π —Ñ–æ–∫—É—Å: –ü–∞—Ä—Å–∏–Ω–≥ –∏–∑ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ –Ø–Ω–¥–µ–∫—Å.–ë–∏–∑–Ω–µ—Å

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

#### –ü–∞—Ä—Å–µ—Ä Yandex.Business
- ‚úÖ –ë–∞–∑–æ–≤—ã–π –ø–∞—Ä—Å–µ—Ä –¥–ª—è –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ (`yandex_business_parser.py`)
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–∑—ã–≤–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –æ—Ç–∑—ã–≤—ã (—á–µ—Ä–µ–∑ –ø–æ–ª–µ `owner_comment`)
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–ø—Ä–æ—Å–º–æ—Ç—Ä—ã, –∑–≤–æ–Ω–∫–∏, –ø–µ—Ä–µ—Ö–æ–¥—ã)
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –ø–æ—Å—Ç–æ–≤/–ø—É–±–ª–∏–∫–∞—Ü–∏–π —á–µ—Ä–µ–∑ sidebar API
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ sidebar API
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ `ExternalBusinessReviews`, `ExternalBusinessStats`, `ExternalBusinessPosts`, `ExternalBusinessPhotos`
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ cookies –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ Fallback –Ω–∞ HTML-–ø–∞—Ä—Å–∏–Ω–≥ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API

#### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚úÖ –¢–∞–±–ª–∏—Ü—ã –ë–î –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:
  - `ExternalBusinessAccounts` - –∞–∫–∫–∞—É–Ω—Ç—ã –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞
  - `ExternalBusinessReviews` - –æ—Ç–∑—ã–≤—ã
  - `ExternalBusinessStats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–Ω—è–º
  - `ExternalBusinessPosts` - –ø–æ—Å—Ç—ã/–ø—É–±–ª–∏–∫–∞—Ü–∏–∏
  - `ExternalBusinessPhotos` - —Ñ–æ—Ç–æ
- ‚úÖ –í–æ—Ä–∫–µ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (`yandex_business_sync_worker.py`)
- ‚úÖ –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ auth_data —á–µ—Ä–µ–∑ `EXTERNAL_AUTH_SECRET_KEY`
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API endpoints (`docs/YANDEX_BUSINESS_API_ENDPOINTS.md`)
- ‚úÖ –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ChatGPT
- ‚úÖ –ë–∞–∑–æ–≤—ã–µ API endpoints –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å–∞–ª–æ–Ω–æ–≤
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π —á–µ—Ä–µ–∑ ChatGPT
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ Stripe –¥–ª—è –æ–ø–ª–∞—Ç—ã
- ‚úÖ Telegram –∏ WhatsApp —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- ‚úÖ –ú–æ–¥–µ—Ä–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å–æ–≤

## üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ

### –ü–∞—Ä—Å–∏–Ω–≥ Yandex.Business
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä—Å–µ—Ä–∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ (–±–µ–∑ sandbox –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π)
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö (62 –æ—Ç–∑—ã–≤–∞, 25 —Å –æ—Ç–≤–µ—Ç–∞–º–∏, 37 –±–µ–∑)
- [ ] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å sidebar API (404 –æ—à–∏–±–∫–∏)
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–¥–Ω–æ–π —Ç–æ—á–∫–∏ –≤ UI

### –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–µ—Ç–µ–π
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–æ—á–µ–∫ –≤ –æ–¥–Ω–æ–º –∞–∫–∫–∞—É–Ω—Ç–µ –Ø–Ω–¥–µ–∫—Å.–ë–∏–∑–Ω–µ—Å
- [ ] –°–≤—è–∑—ã–≤–∞–Ω–∏–µ —Ç–æ—á–µ–∫ —Å–µ—Ç–∏ —Å –æ–¥–Ω–∏–º `external_account_id`
- [ ] –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–µ—Ç–∏
- [ ] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–µ—Ç–∏ –≤ UI

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–ø—É—Å–∫–∞ –ø–∞—Ä—Å–µ—Ä–∞ –ø–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—é (cron/scheduler)
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –ø–∞—Ä—Å–∏–Ω–≥–∞

### ChatGPT App Store
- [ ] –î–æ—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω–Ω–µ–∫—Ç–∞ –∫ ChatGPT App Store
- [ ] –ü–æ–∏—Å–∫ –±–∏–∑–Ω–µ—Å–æ–≤ –∏–∑ —Å–µ—Ç–∏ —á–µ—Ä–µ–∑ ChatGPT
- [ ] –ó–∞–∫–∞–∑ —É—Å–ª—É–≥ —á–µ—Ä–µ–∑ ChatGPT
- [ ] –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ ChatGPT

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

#### ExternalBusinessAccounts
–•—Ä–∞–Ω–∏—Ç –∞–∫–∫–∞—É–Ω—Ç—ã –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞:
- `id` - ID –∞–∫–∫–∞—É–Ω—Ç–∞
- `business_id` - —Å–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å–æ–º (–º–æ–∂–µ—Ç –±—ã—Ç—å NULL –¥–ª—è —Å–µ—Ç–µ–π)
- `source` - –∏—Å—Ç–æ—á–Ω–∏–∫ ('yandex_business')
- `external_id` - ID –≤ —Å–∏—Å—Ç–µ–º–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (permalink)
- `auth_data_encrypted` - –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ cookies
- `is_active` - –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ –∞–∫–∫–∞—É–Ω—Ç
- `last_sync` - –ø–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- `last_error` - –ø–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞

#### ExternalBusinessReviews
–û—Ç–∑—ã–≤—ã –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:
- `id` - ID –æ—Ç–∑—ã–≤–∞
- `external_account_id` - —Å–≤—è–∑—å —Å –∞–∫–∫–∞—É–Ω—Ç–æ–º
- `business_id` - —Å–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å–æ–º (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞)
- `external_review_id` - ID –≤ —Å–∏—Å—Ç–µ–º–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
- `author_name` - –∏–º—è –∞–≤—Ç–æ—Ä–∞
- `rating` - –æ—Ü–µ–Ω–∫–∞ (1-5)
- `text` - —Ç–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞
- `date` - –¥–∞—Ç–∞ –æ—Ç–∑—ã–≤–∞
- `has_response` - –µ—Å—Ç—å –ª–∏ –æ—Ç–≤–µ—Ç
- `response_text` - —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞
- `response_date` - –¥–∞—Ç–∞ –æ—Ç–≤–µ—Ç–∞

#### ExternalBusinessStats
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–Ω—è–º:
- `id` - ID –∑–∞–ø–∏—Å–∏
- `external_account_id` - —Å–≤—è–∑—å —Å –∞–∫–∫–∞—É–Ω—Ç–æ–º
- `business_id` - —Å–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å–æ–º
- `date` - –¥–∞—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- `views` - –ø—Ä–æ—Å–º–æ—Ç—Ä—ã
- `calls` - –∑–≤–æ–Ω–∫–∏
- `clicks` - –ø–µ—Ä–µ—Ö–æ–¥—ã
- `unique_id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID (external_account_id + date)

#### ExternalBusinessPosts
–ü–æ—Å—Ç—ã/–ø—É–±–ª–∏–∫–∞—Ü–∏–∏:
- `id` - ID –ø–æ—Å—Ç–∞
- `external_account_id` - —Å–≤—è–∑—å —Å –∞–∫–∫–∞—É–Ω—Ç–æ–º
- `business_id` - —Å–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å–æ–º
- `external_post_id` - ID –≤ —Å–∏—Å—Ç–µ–º–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
- `title` - –∑–∞–≥–æ–ª–æ–≤–æ–∫
- `text` - —Ç–µ–∫—Å—Ç
- `date` - –¥–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
- `views` - –ø—Ä–æ—Å–º–æ—Ç—Ä—ã
- `likes` - –ª–∞–π–∫–∏

#### ExternalBusinessPhotos
–§–æ—Ç–æ:
- `id` - ID –∑–∞–ø–∏—Å–∏
- `external_account_id` - —Å–≤—è–∑—å —Å –∞–∫–∫–∞—É–Ω—Ç–æ–º
- `business_id` - —Å–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å–æ–º
- `total_count` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–æ—Ç–æ
- `last_updated` - –ø–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### YandexBusinessParser (`src/yandex_business_parser.py`)
–û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞:
- `fetch_reviews()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- `fetch_stats()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- `fetch_posts()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤
- `fetch_photos_count()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ñ–æ—Ç–æ
- `fetch_organization_info()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

#### YandexBusinessSyncWorker (`src/yandex_business_sync_worker.py`)
–í–æ—Ä–∫–µ—Ä –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
- `run_once()` - –æ–¥–∏–Ω –ø—Ä–æ—Ö–æ–¥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- `_load_active_accounts()` - –∑–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
- `_upsert_reviews()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–æ–≤
- `_upsert_stats()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- `_upsert_posts()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤
- `_upsert_photos()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–æ—Ç–æ

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ auth_data —á–µ—Ä–µ–∑ `EXTERNAL_AUTH_SECRET_KEY`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `safe_db_utils` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è cookies, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `docs/YANDEX_BUSINESS_API_ENDPOINTS.md` - –æ–ø–∏—Å–∞–Ω–∏–µ API endpoints
- `docs/TEST_YANDEX_ON_SERVER.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- `CHATGPT_INTEGRATION_STATUS.md` - —Å—Ç–∞—Ç—É—Å ChatGPT –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## üöÄ –î–µ–ø–ª–æ–π

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
```bash
git pull origin main
source venv/bin/activate
pip install -r requirements.txt
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
# Flask —Å–µ—Ä–≤–µ—Ä
systemctl restart seo-main

# –í–æ—Ä–∫–µ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω –æ—Ç–¥–µ–ª—å–Ω–æ)
systemctl restart yandex-sync-worker
```

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
```bash
python src/migrate_external_posts_photos.py
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `ExternalBusinessAccounts`
- –£—Å–ø–µ—à–Ω–æ—Å—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: —á–µ—Ä–µ–∑ `last_sync` –∏ `last_error`
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∑—ã–≤–æ–≤: —á–µ—Ä–µ–∑ `ExternalBusinessReviews`
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: —á–µ—Ä–µ–∑ `ExternalBusinessStats`

