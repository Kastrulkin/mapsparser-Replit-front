# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É –º–∏–≥—Ä–∞—Ü–∏–π –ë–î

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –º–∏–≥—Ä–∞—Ü–∏–π

1. **–°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
   ```bash
   cp src/reports.db src/reports.db.backup_$(date +%Y%m%d_%H%M%S)
   cp reports.db reports.db.backup_$(date +%Y%m%d_%H%M%S) 2>/dev/null || true
   ```

2. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞**

## üìã –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π

### 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ master_id –≤ FinancialTransactions

```bash
cd /path/to/project
python src/migrate_add_master_id.py
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ `master_id` –≤ —Ç–∞–±–ª–∏—Ü—É `FinancialTransactions`
- –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–≤—è–∑—ã–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –º–∞—Å—Ç–µ—Ä–∞–º–∏

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–µ–π

```bash
python src/migrate_add_network_support.py
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ `network_id` –≤ —Ç–∞–±–ª–∏—Ü—É `Businesses`
- –°–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É `Networks` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–µ—Ç—è—Ö
- –°–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É `Masters` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–∞—Å—Ç–µ—Ä–∞—Ö
- –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ `telegram_id` –≤ —Ç–∞–±–ª–∏—Ü—É `Users` (–¥–ª—è Telegram-–±–æ—Ç–∞)
- –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ `business_id` –≤ —Ç–∞–±–ª–∏—Ü—É `FinancialTransactions`
- –°–æ–∑–¥–∞—ë—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –±–∏–∑–Ω–µ—Å–∞ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç

```bash
python src/migrate_add_business_type_and_yandex.py
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ `business_type` –≤ —Ç–∞–±–ª–∏—Ü—É `Businesses` (—Ç–∏–ø –±–∏–∑–Ω–µ—Å–∞ –≤–Ω—É—Ç—Ä–∏ –±—å—é—Ç–∏-–≤–µ—Ä—Ç–∏–∫–∞–ª–∏)
- –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—è `yandex_org_id` –∏ `yandex_url` –¥–ª—è —Å–≤—è–∑–∏ —Å –∫–∞—Ä—Ç–æ—á–∫–æ–π –≤ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç–∞—Ö
- –î–æ–±–∞–≤–ª—è–µ—Ç –∫–µ—à-–ø–æ–ª—è `yandex_rating`, `yandex_reviews_total`, `yandex_reviews_30d`, `yandex_last_sync` –≤ `Businesses`
- –°–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É `YandexBusinessStats` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö —Ä—è–¥–æ–≤ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É –∏ –æ—Ç–∑—ã–≤–∞–º

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–π

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü:**
   ```bash
   sqlite3 src/reports.db ".schema FinancialTransactions"
   sqlite3 src/reports.db ".schema Networks"
   sqlite3 src/reports.db ".schema Masters"
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**
   ```bash
   sqlite3 src/reports.db "SELECT COUNT(*) FROM FinancialTransactions;"
   sqlite3 src/reports.db "SELECT COUNT(*) FROM Businesses;"
   ```

## üîÑ –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

–ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–∑ –±—ç–∫–∞–ø–∞:

```bash
cp src/reports.db.backup_YYYYMMDD_HHMMSS src/reports.db
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ `safe_db_utils`:

```python
from safe_db_utils import restore_from_backup
restore_from_backup("db_backups/reports_YYYYMMDD_HHMMSS.db.backup")
```

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `safe_migrate()` –∏–∑ `safe_db_utils.py`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –±—ç–∫–∞–ø—ã –ø–µ—Ä–µ–¥ –∫–∞–∂–¥–æ–π –º–∏–≥—Ä–∞—Ü–∏–µ–π
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ (–æ–Ω–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª–µ–π/—Ç–∞–±–ª–∏—Ü)
- –ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å, –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–∞—Ç—ã–≤–∞—é—Ç—Å—è

