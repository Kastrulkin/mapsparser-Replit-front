# –ò—Ç–æ–≥–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —É–ø—Ä–æ—â–µ–Ω–∏—è –∫–æ–¥–∞

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –ó–∞–º–µ–Ω–∞ –≤—Å–µ—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π `SELECT owner_id` –Ω–∞ `get_business_owner_id()`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ó–∞–º–µ–Ω–µ–Ω–æ 9+ –º–µ—Å—Ç –≤ `main.py`

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è owner_id
- –õ–µ–≥–∫–æ –∏–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- –ú–µ–Ω—å—à–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
- –£–ª—É—á—à–µ–Ω–∞ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å

**–ü—Ä–∏–º–µ—Ä –∑–∞–º–µ–Ω—ã:**
```python
# –ë—ã–ª–æ:
cursor.execute("SELECT owner_id FROM Businesses WHERE id = ?", (business_id,))
row = cursor.fetchone()
if not row:
    return jsonify({"error": "–ë–∏–∑–Ω–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω"}), 404
owner_id = row[0]

# –°—Ç–∞–ª–æ:
owner_id = get_business_owner_id(cursor, business_id)
if not owner_id:
    return jsonify({"error": "–ë–∏–∑–Ω–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω"}), 404
```

---

### 2. –í—ã–Ω–æ—Å cookies –∏–∑ `parser.py` –≤ –∫–æ–Ω—Ñ–∏–≥

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å `src/parser_config_cookies.py`

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- Cookies –Ω–µ –∑–∞–≥—Ä–æ–º–æ–∂–¥–∞—é—Ç –∫–æ–¥ –ø–∞—Ä—Å–µ—Ä–∞
- –õ–µ–≥–∫–æ –æ–±–Ω–æ–≤–ª—è—Ç—å cookies —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ —Ñ–∞–π–ª
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ cookies –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- `src/parser_config_cookies.py` - –º–æ–¥—É–ª—å —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `get_yandex_cookies()`
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏:
  1. –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `YANDEX_COOKIES_JSON`
  2. –§–∞–π–ª `yandex_cookies.json` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
  3. –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
from parser_config_cookies import get_yandex_cookies
cookies = get_yandex_cookies()
```

---

### 3. –†–∞–∑–±–∏–µ–Ω–∏–µ `main.py` –Ω–∞ –º–æ–¥—É–ª–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–æ–∑–¥–∞–Ω–∞ –±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏:**

#### `src/core/helpers.py`
- `get_business_owner_id()` - –ø–æ–ª—É—á–µ–Ω–∏–µ owner_id –±–∏–∑–Ω–µ—Å–∞
- `get_business_id_from_user()` - –ø–æ–ª—É—á–µ–Ω–∏–µ business_id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `get_user_language()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —è–∑—ã–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### `src/core/app_factory.py`
- `create_app()` - —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `rate_limit_if_available()` - –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è rate limiting

#### `src/api/services_api.py`
- Blueprint –¥–ª—è API —É—Å–ª—É–≥
- –†–æ—É—Ç—ã: `/api/services/add`, `/api/services/list`, `/api/services/update`, `/api/services/delete`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
src/
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ helpers.py          # Helper —Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ app_factory.py       # –§–∞–±—Ä–∏–∫–∞ Flask app
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ services_api.py      # API –¥–ª—è —É—Å–ª—É–≥ (–ø—Ä–∏–º–µ—Ä)
‚îî‚îÄ‚îÄ main.py                  # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª (—É–ø—Ä–æ—â–µ–Ω)
```

**–ü–ª–∞–Ω –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞–∑–±–∏–µ–Ω–∏—è:**
- `api/business_api.py` - API –¥–ª—è –±–∏–∑–Ω–µ—Å–æ–≤
- `api/news_api.py` - API –¥–ª—è –Ω–æ–≤–æ—Å—Ç–µ–π
- `api/reviews_api.py` - API –¥–ª—è –æ—Ç–∑—ã–≤–æ–≤
- `api/analysis_api.py` - API –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- `api/admin_api.py` - –ê–¥–º–∏–Ω—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
- –ò –¥—Ä—É–≥–∏–µ –º–æ–¥—É–ª–∏ (—Å–º. `REFACTORING_PLAN.md`)

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É–ø—Ä–æ—â–µ–Ω–∏—è

### –û–±—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- **–£–¥–∞–ª–µ–Ω–æ ~200+ —Å—Ç—Ä–æ–∫** –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞
- **–°–æ–∑–¥–∞–Ω–æ 3 –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª—è** –¥–ª—è –ª—É—á—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- **–£–ø—Ä–æ—â–µ–Ω–æ 9+ –º–µ—Å—Ç** —Å –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–º–∏—Å—è SQL –∑–∞–ø—Ä–æ—Å–∞–º–∏
- **–£–±—Ä–∞–Ω–∞ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å** –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—à–∏–±–æ–∫ –∏ –∑–∞–ø—É—Å–∫–µ –±—Ä–∞—É–∑–µ—Ä–æ–≤
- **–°–æ–∑–¥–∞–Ω –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π —Ö—É–∫** `useApiData` –¥–ª—è React

### –ü–æ —Ñ–∞–π–ª–∞–º:

#### `worker.py`
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ Row ‚Üí dict: 12 —Å—Ç—Ä–æ–∫ ‚Üí 1 —Å—Ç—Ä–æ–∫–∞
- –£–ø—Ä–æ—â–µ–Ω SQL –∑–∞–ø—Ä–æ—Å (—É–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ)
- –§—É–Ω–∫—Ü–∏—è `_ensure_column_exists()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–ª–æ–Ω–æ–∫
- –£–ø—Ä–æ—â–µ–Ω INSERT (–æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ –¥–≤—É—Ö)
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

#### `parser.py`
- –ó–∞–ø—É—Å–∫ –±—Ä–∞—É–∑–µ—Ä–æ–≤: 65 —Å—Ç—Ä–æ–∫ ‚Üí 40 —Å—Ç—Ä–æ–∫
- –£–±—Ä–∞–Ω–∞ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å try-except
- –§—É–Ω–∫—Ü–∏—è `_launch_browser()` –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- Cookies –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ –∫–æ–Ω—Ñ–∏–≥

#### React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- `ProgressTracker`: —É–±—Ä–∞–Ω–æ 65+ —Å—Ç—Ä–æ–∫ –º–æ–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- `MapParseTable`: —É–ø—Ä–æ—â–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- –°–æ–∑–¥–∞–Ω —Ö—É–∫ `useApiData` –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### `main.py`
- Helper —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ `core/helpers.py`
- –°–æ–∑–¥–∞–Ω –ø—Ä–∏–º–µ—Ä API –º–æ–¥—É–ª—è `api/services_api.py`
- –ó–∞–º–µ–Ω–µ–Ω—ã –≤—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `SELECT owner_id`

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

1. **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: –ö–æ–¥ —Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –º–æ–¥—É–ª–∏
2. **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å**: –õ–µ–≥—á–µ –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–π –∫–æ–¥
3. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: Helper —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Ö—É–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–µ–∑–¥–µ
4. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**: –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ –≤–ª–∏—è—é—Ç –Ω–∞ –≤—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
5. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ú–æ–¥—É–ª–∏ –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ
6. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥—É–ª–∏

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** –Ω–æ–≤—ã–µ –º–æ–¥—É–ª–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
2. **–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–∑–±–∏–µ–Ω–∏–µ** `main.py` –Ω–∞ –º–æ–¥—É–ª–∏ (—Å–º. `REFACTORING_PLAN.md`)
3. **–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Ä–æ—É—Ç—ã** –∏–∑ `main.py` –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π
4. **–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã** –¥–ª—è –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π
5. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å** API –º–æ–¥—É–ª–∏

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

- –°—Ç–∞—Ä—ã–µ —Ä–æ—É—Ç—ã –≤ `main.py` –ø–æ–∫–∞ –Ω–µ —É–¥–∞–ª–µ–Ω—ã (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
- –ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Ä–æ—É—Ç—ã
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –ª–∏–Ω—Ç–µ—Ä–æ–º, –æ—à–∏–±–æ–∫ –Ω–µ—Ç
- –ü–æ–≤–µ–¥–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ (—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥, –Ω–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏–µ)

