# üìã –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º –∑–∞–¥–∞—á–∞–º

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. –ö—Ä—É–≥–æ–≤—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –≤ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–º –¥–∞—à–±–æ—Ä–¥–µ
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–∞–≥—Ä–∞–º–º—ã –¥–æ—Ö–æ–¥–æ–≤ –ø–æ —É—Å–ª—É–≥–∞–º
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–∞–≥—Ä–∞–º–º—ã –¥–æ—Ö–æ–¥–æ–≤ –ø–æ –º–∞—Å—Ç–µ—Ä–∞–º
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `recharts`
- ‚úÖ –§–∞–π–ª: `frontend/src/components/FinancialMetrics.tsx`

### 2. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–º –∏ —Ñ–æ—Ç–æ
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–∞ —Ñ–æ—Ä–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (`TransactionForm.tsx`)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ (PDF, DOC, XLS, TXT, CSV)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ (PNG, JPG, JPEG)
- ‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ GigaChat API
- ‚úÖ –≠–Ω–¥–ø–æ–∏–Ω—Ç: `/api/finance/transaction/upload`
- ‚úÖ –ü—Ä–æ–º–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞: `prompts/transaction-analysis-prompt.txt`

### 3. Telegram-–±–æ—Ç
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/telegram_bot.py`
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —á–µ—Ä–µ–∑ –±–æ—Ç–∞
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ –∏ —Ç–µ–∫—Å—Ç–∞
- ‚úÖ –°–≤—è–∑—å —Å –∞–∫–∫–∞—É–Ω—Ç–æ–º —á–µ—Ä–µ–∑ `telegram_id`
- ‚úÖ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ: `TELEGRAM_BOT_SETUP.md`

### 4. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–µ—Ç–µ–π
- ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `NetworkSwitcher.tsx` –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏
- ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `NetworkDashboard.tsx` —Å–æ —Å–≤–æ–¥–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- ‚úÖ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:
  - `/api/networks` - —Å–ø–∏—Å–æ–∫ —Å–µ—Ç–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - `/api/networks/<network_id>/locations` - —Ç–æ—á–∫–∏ —Å–µ—Ç–∏
  - `/api/networks/<network_id>/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ç–∏
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Dashboard (–≤–∫–ª–∞–¥–∫–∞ "–°–µ—Ç–∏")

### 5. –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
- ‚úÖ `migrate_add_master_id.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ `master_id` –≤ FinancialTransactions
- ‚úÖ `migrate_add_network_support.py` - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–µ—Ç–µ–π:
  - –ü–æ–ª–µ `network_id` –≤ Businesses
  - –¢–∞–±–ª–∏—Ü–∞ `Networks`
  - –¢–∞–±–ª–∏—Ü–∞ `Masters`
  - –ü–æ–ª–µ `telegram_id` –≤ Users
  - –ü–æ–ª–µ `business_id` –≤ FinancialTransactions
- ‚úÖ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: `MIGRATION_INSTRUCTIONS.md`

### 6. –û–±–Ω–æ–≤–ª–µ–Ω–∏—è API
- ‚úÖ `/api/finance/breakdown` - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `business_id`
- ‚úÖ `/api/finance/transaction` - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `business_id` –∏ `master_id`
- ‚úÖ –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª–µ–π –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º

## üìù –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

```bash
cd /root/mapsparser-Replit-front

# –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø
cp src/reports.db src/reports.db.backup_$(date +%Y%m%d_%H%M%S)
cp reports.db reports.db.backup_$(date +%Y%m%d_%H%M%S) 2>/dev/null || true

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
python src/migrate_add_master_id.py
python src/migrate_add_network_support.py
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–ª—è Telegram-–±–æ—Ç–∞

```bash
pip install python-telegram-bot>=20.0
```

–ò–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å `requirements.txt` –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
```bash
pip install -r requirements.txt
```

### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Telegram-–±–æ—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–æ–±–∞–≤–∏—Ç—å –≤ `.env`:
```
TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–æ—Ç_BotFather
```

–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞:
```bash
python src/telegram_bot.py
```

–ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–∞–∫ systemd —Å–µ—Ä–≤–∏—Å (—Å–º. `TELEGRAM_BOT_SETUP.md`)

### 4. –û–±–Ω–æ–≤–∏—Ç—å frontend

```bash
cd frontend
npm install
npm run build
cp -r dist/* /var/www/html/
chown -R www-data:www-data /var/www/html
```

### 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã

```bash
systemctl restart nginx
systemctl restart seo-worker 2>/dev/null || true
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. **–ö—Ä—É–≥–æ–≤—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã:**
   - –ó–∞–π—Ç–∏ –≤ Dashboard ‚Üí –§–∏–Ω–∞–Ω—Å—ã
   - –î–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –¥–≤–µ –¥–∏–∞–≥—Ä–∞–º–º—ã: –ø–æ —É—Å–ª—É–≥–∞–º –∏ –ø–æ –º–∞—Å—Ç–µ—Ä–∞–º

2. **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤/—Ñ–æ—Ç–æ:**
   - –ó–∞–π—Ç–∏ –≤ Dashboard ‚Üí –§–∏–Ω–∞–Ω—Å—ã ‚Üí –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
   - –í—ã–±—Ä–∞—Ç—å "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª" –∏–ª–∏ "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ"
   - –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª/—Ñ–æ—Ç–æ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ

3. **–°–µ—Ç–∏:**
   - –ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å —Å–µ—Ç–∏, –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –≤–∫–ª–∞–¥–∫–∞ "–°–µ—Ç–∏"
   - –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏ —Å–µ—Ç–∏
   - –î–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –¥–∞—à–±–æ—Ä–¥ —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π

4. **Telegram-–±–æ—Ç:**
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å `/start` –±–æ—Ç—É
   - –í—ã–±—Ä–∞—Ç—å –±–∏–∑–Ω–µ—Å
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ –∏–ª–∏ —Ç–µ–∫—Å—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ú–∏–≥—Ä–∞—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã** - –∏—Å–ø–æ–ª—å–∑—É—é—Ç `safe_migrate()` —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –±—ç–∫–∞–ø–∞–º–∏
2. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - –≤—Å–µ API –ø—Ä–æ–≤–µ—Ä—è—é—Ç –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª–µ–π –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
3. **Telegram-–±–æ—Ç –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω** - —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –±–µ–∑ –Ω–µ–≥–æ
4. **–°–µ—Ç–∏** - —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ç–µ–π —á–µ—Ä–µ–∑ API –∏–ª–∏ –∞–¥–º–∏–Ω–∫—É

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `MIGRATION_INSTRUCTIONS.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –º–∏–≥—Ä–∞—Ü–∏—è–º
- `TELEGRAM_BOT_SETUP.md` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram-–±–æ—Ç–∞
- `database_schema_design.md` - —Å—Ö–µ–º–∞ –ë–î (–æ–±–Ω–æ–≤–ª–µ–Ω–∞)

