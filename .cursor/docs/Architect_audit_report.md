## 2026-01-21 - –£–ª—É—á—à–µ–Ω–∏–µ –ø–∞—Ä—Å–µ—Ä–∞ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç –∏ —Ä–µ–¥–∏–∑–∞–π–Ω –æ—Ç—á—ë—Ç–æ–≤

### Current Task
–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –ø–∞—Ä—Å–µ—Ä–∞ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ñ–∏–ª—è (–∫–æ–Ω—Ç–∞–∫—Ç—ã, —á–∞—Å—ã —Ä–∞–±–æ—Ç—ã, —É—Å–ª—É–≥–∏) –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ UI –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤.

### Architecture Decision
**–†–µ—à–µ–Ω–∏–µ**: –†–∞—Å—à–∏—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–∏—Å—Ç–µ–º—É –ø–∞—Ä—Å–∏–Ω–≥–∞ –±–µ–∑ breaking changes:
- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è –≤ `MapParseResults` —á–µ—Ä–µ–∑ –º–∏–≥—Ä–∞—Ü–∏—é —Å **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –±–µ–∫–∞–ø–æ–º –ë–î**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `yandex_maps_scraper.py` –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –ø–∞—Ä—Å–∏—Ç –≤—Å–µ –Ω—É–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –û–±–Ω–æ–≤–∏—Ç—å `worker.py` –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π
- –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `YandexBusinessReport` –≤–º–µ—Å—Ç–æ –∑–∞–º–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ HTML-–æ—Ç—á—ë—Ç–∞
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å –ø—Ä–æ—Ñ–∏–ª—è (0-100%) –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –±—ç–∫–µ–Ω–¥–∞

**–ü–æ—á–µ–º—É —Ç–∞–∫**:
- –î–∞–Ω–Ω—ã–µ —É–∂–µ –ø–∞—Ä—Å—è—Ç—Å—è –ø–∞—Ä—Å–µ—Ä–æ–º, –Ω–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è ‚Üí –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –ù–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤–º–µ—Å—Ç–æ –∑–∞–º–µ–Ω—ã —Å—Ç–∞—Ä–æ–≥–æ ‚Üí –±–µ–∑–æ–ø–∞—Å–Ω–æ, —Å—Ç–∞—Ä—ã–µ –æ—Ç—á—ë—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- **–ê–≤—Ç–æ–±–µ–∫–∞–ø –ë–î –≤ –º–∏–≥—Ä–∞—Ü–∏–∏** ‚Üí –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö (–∫—Ä–∏—Ç–∏—á–Ω–æ!)
- –†–∞—Å—á—ë—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏ –≤ worker.py ‚Üí –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

### Files to Modify
- `src/migrations/add_profile_completeness_fields.py` - **[NEW]** –º–∏–≥—Ä–∞—Ü–∏—è –ë–î —Å **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –±–µ–∫–∞–ø–æ–º**
- `src/worker.py` (—Å—Ç—Ä–æ–∫–∏ 456-541) - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ phone, website, hours, services, messengers; —Ä–∞—Å—á—ë—Ç profile_completeness
- `frontend/src/components/YandexBusinessReport.tsx` - **[NEW]** —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç—á—ë—Ç–∞
- `frontend/src/components/MapParseTable.tsx` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –≤–º–µ—Å—Ç–æ HTML

### Trade-offs & Decisions

#### 1. **Backward Compatibility vs Fresh Start**
- **–í—ã–±—Ä–∞–Ω–æ**: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ö–µ–º—ã, –Ω–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å—Ç–∞—Ä–æ–º—É
- **–ü–æ—á–µ–º—É**: –°—Ç–∞—Ä—ã–µ –æ—Ç—á—ë—Ç—ã –ø—Ä–æ–¥–æ–ª–∂–∞—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –¥–µ–ø–ª–æ–π –±–µ–∑ —Ä–∏—Å–∫–æ–≤
- **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞**: –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤—Å—ë —Å –Ω—É–ª—è ‚Üí –æ–ø–∞—Å–Ω–æ –¥–ª—è production

#### 2. **Backend vs Frontend —Ä–∞—Å—á—ë—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏**
- **–í—ã–±—Ä–∞–Ω–æ**: Backend (–≤ `worker.py` –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏)
- **–ü–æ—á–µ–º—É**: –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã, –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–µ–∑–¥–µ
- **Trade-off**: –ù–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º—É–ª—É –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞

#### 3. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (JSON vs –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ–ª—è)**
- **–í—ã–±—Ä–∞–Ω–æ**: JSON –¥–ª—è messengers –∏ working_hours, –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ
- **–ü–æ—á–µ–º—É**: –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –≥–∏–±–∫–æ—Å—Ç—å—é (messengers –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å—Å—è) –∏ —É–¥–æ–±—Å—Ç–≤–æ–º –∑–∞–ø—Ä–æ—Å–æ–≤ (phone, website —á–∞—Å—Ç–æ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç)

#### 4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±–µ–∫–∞–ø –≤ –º–∏–≥—Ä–∞—Ü–∏–∏** ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û
- **–í—ã–±—Ä–∞–Ω–æ**: –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ô –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±–µ–∫–∞–ø –ø–µ—Ä–µ–¥ ALTER TABLE
- **–ü–æ—á–µ–º—É**: –ö—Ä–∏—Ç–∏—á–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö, –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –±–µ–∑ –±–µ–∫–∞–ø–∞
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: `create_backup()` —Å–æ–∑–¥–∞—ë—Ç `.backup_YYYYMMDD_HHMMSS` –ø–µ—Ä–µ–¥ –ª—é–±—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
- **Trade-off**: –¢—Ä–µ–±—É–µ—Ç –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ, –Ω–æ —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ü–†–ê–í, —ç—Ç–æ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û

### Dependencies

#### Backend
- **–ù–ï–¢** –Ω–æ–≤—ã—Ö pip –ø–∞–∫–µ—Ç–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ: shutil, datetime, json)

#### Frontend  
- **–ù–ï–¢** –Ω–æ–≤—ã—Ö npm –ø–∞–∫–µ—Ç–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ: lucide-react, shadcn/ui)

#### Database
- Migration script: `src/migrations/add_profile_completeness_fields.py`
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±–µ–∫–∞–ø**: `src/reports.db.backup_YYYYMMDD_HHMMSS` (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- 7 –Ω–æ–≤—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ –≤ `MapParseResults`

#### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ù–ï–¢ –∏–∑–º–µ–Ω–µ–Ω–∏–π

#### Systemd/Nginx
- Worker: —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ—Å—Ç–∞—Ä—Ç –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞)
- Frontend: rebuild + copy to `/var/www/html/`
- Nginx: restart –ø–æ—Å–ª–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è

#### Breaking Changes
- **–ù–ï–¢** - –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã
- –°—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –≤ –ë–î –±—É–¥—É—Ç –∏–º–µ—Ç—å NULL –≤ –Ω–æ–≤—ã—Ö –ø–æ–ª—è—Ö (–¥–æ–ø—É—Å—Ç–∏–º–æ)
- –ü–∞—Ä—Å–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏ —Å—Ö–µ–º—ã (–±–ª–∞–≥–æ–¥–∞—Ä—è `_ensure_column_exists`)

### Status
- [x] Completed

---

# üîç –ê—É–¥–∏—Ç –ø—Ä–æ–µ–∫—Ç–∞ BeautyBot

**–î–∞—Ç–∞:** 2024  
**–û–±–ª–∞—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏:** –ü—Ä–æ—Å—Ç–æ—Ç–∞, –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã, –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

---

## üìä Executive Summary

### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã
- –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î —á–µ—Ä–µ–∑ `safe_db_utils`
- WAL —Ä–µ–∂–∏–º SQLite –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–∑–∞—â–∏—Ç–∞ –æ—Ç SQL injection)
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ auth_data –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
- –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤ worker.py –ø–µ—Ä–µ–¥ –¥–æ–ª–≥–∏–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏

### ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –°–ª–∞–±—ã–π —Ö–µ—à –ø–∞—Ä–æ–ª—è –≤ `database_manager.py` (SHA256 –±–µ–∑ —Å–æ–ª–∏) ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** N+1 –∑–∞–ø—Ä–æ—Å—ã –≤ `get_all_users_with_businesses()` ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
3. **–ü—Ä–æ—Å—Ç–æ—Ç–∞:** `main.py` —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (8872 —Å—Ç—Ä–æ–∫–∏)
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è localhost (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ) ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

### üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `main.py` –Ω–∞ Blueprint'—ã
- –î–æ–±–∞–≤–∏—Ç—å rate limiting –Ω–∞ backend ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
- –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å –ë–î

---

## üìã –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 2025-01-03 - –ü–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

#### Current Task
–ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î (46-50 —Ç–∞–±–ª–∏—Ü) –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —É–ø—Ä–æ—â–µ–Ω–∏—è —Å—Ö–µ–º—ã

#### Architecture Decision
**–ü—Ä–∏–Ω—è—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Å—Ç–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –ë–î –≤ 3 —ç—Ç–∞–ø–∞:**

**–≠—Ç–∞–ø 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ):** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –∏–Ω–¥–µ–∫—Å–æ–≤
**–≠—Ç–∞–ø 2 (–í–∞–∂–Ω–æ):** –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü
**–≠—Ç–∞–ø 3 (–£–ª—É—á—à–µ–Ω–∏—è):** –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ö–æ–∂–∏—Ö —Ç–∞–±–ª–∏—Ü

#### Files to Modify
- `src/init_database_schema.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –∏–Ω–¥–µ–∫—Å–æ–≤
- `src/migrate_remove_duplicate_tables.py` - —Å–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü
- `src/migrate_merge_examples_tables.py` - —Å–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü Examples
- `.cursor/docs/VERIFICATION.md` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î

#### Trade-offs & Decisions

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å vs –ü—Ä–æ—Å—Ç–æ—Ç–∞:**
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ —É–ª—É—á—à–∏—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ 5-10 —Ä–∞–∑
- –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü —É–ø—Ä–æ—Å—Ç–∏—Ç —Å—Ö–µ–º—É, –Ω–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü Examples —É–ø—Ä–æ—Å—Ç–∏—Ç –∑–∞–ø—Ä–æ—Å—ã, –Ω–æ —É—Å–ª–æ–∂–Ω–∏—Ç –ª–æ–≥–∏–∫—É —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ç–∏–ø—É

**Backwards compatibility:**
- –£–¥–∞–ª–µ–Ω–∏–µ `ClientInfo` —Ç—Ä–µ–±—É–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ `Businesses`
- –£–¥–∞–ª–µ–Ω–∏–µ `Cards` —Ç—Ä–µ–±—É–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ `MapParseResults`
- –£–¥–∞–ª–µ–Ω–∏–µ `GigaChatTokenUsage` –±–µ–∑–æ–ø–∞—Å–Ω–æ (–µ—Å—Ç—å `TokenUsage`)

**–†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –†–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `safe_migrate()` —Å –±—ç–∫–∞–ø–∞–º–∏
- –†–∏—Å–∫ –∑–∞–º–µ–¥–ª–µ–Ω–∏—è INSERT –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∏–Ω–¥–µ–∫—Å–æ–≤ ‚Üí –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π (SQLite —Ö–æ—Ä–æ—à–æ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è)
- –†–∏—Å–∫ breaking changes ‚Üí –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –¥–∞–Ω–Ω—ã—Ö

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**
- –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å ‚Üí –Ω–µ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ü–æ–ª–Ω–∞—è —Ä–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è ‚Üí —Å–ª–∏—à–∫–æ–º —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- –í—ã–±—Ä–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å –±—ç–∫–∞–ø–∞–º–∏

#### Dependencies

**–ù–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**
- `migrate_add_missing_indexes.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –∏–Ω–¥–µ–∫—Å–æ–≤
- `migrate_remove_duplicate_tables.py` - —É–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü
- `migrate_merge_examples_tables.py` - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü Examples

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º:**
- –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω—ã–π –±—ç–∫–∞–ø –ë–î
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:**
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Flask —Å–µ—Ä–≤–µ—Ä
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤
- –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

#### –ü–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–¥–ª—è –ö–æ–¥–µ—Ä–∞)

##### –≠–¢–ê–ü 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ (–ö—Ä–∏—Ç–∏—á–Ω–æ)

**–§–∞–π–ª:** `src/migrate_add_missing_indexes.py`

**–ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:**
```sql
-- UserSessions (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
CREATE INDEX IF NOT EXISTS idx_user_sessions_token ON UserSessions(token);
CREATE INDEX IF NOT EXISTS idx_user_sessions_expires ON UserSessions(expires_at);

-- Businesses (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö)
CREATE INDEX IF NOT EXISTS idx_businesses_active ON Businesses(is_active);
CREATE INDEX IF NOT EXISTS idx_businesses_subscription_status ON Businesses(subscription_status);

-- Bookings (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É)
CREATE INDEX IF NOT EXISTS idx_bookings_status ON Bookings(status);
CREATE INDEX IF NOT EXISTS idx_bookings_business_status ON Bookings(business_id, status);

-- ExternalBusinessReviews (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ)
CREATE INDEX IF NOT EXISTS idx_ext_reviews_published_at ON ExternalBusinessReviews(published_at);
CREATE INDEX IF NOT EXISTS idx_ext_reviews_business_published ON ExternalBusinessReviews(business_id, published_at);

-- ChatGPTRequests (–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
CREATE INDEX IF NOT EXISTS idx_chatgpt_requests_business_status ON ChatGPTRequests(business_id, response_status);

-- TokenUsage (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
CREATE INDEX IF NOT EXISTS idx_token_usage_business_created ON TokenUsage(business_id, created_at);
```

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:**
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Å—Å–∏–π: 10-50x
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö –±–∏–∑–Ω–µ—Å–æ–≤: 5-10x
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏: 3-5x

---

##### –≠–¢–ê–ü 2: –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü (–í–∞–∂–Ω–æ)

**–§–∞–π–ª:** `src/migrate_remove_duplicate_tables.py`

**–¢–∞–±–ª–∏—Ü—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:**

1. **ClientInfo** ‚Üí –¥–∞–Ω–Ω—ã–µ –≤ `Businesses`
   - –ú–∏–≥—Ä–∞—Ü–∏—è: `business_name`, `business_type`, `address`, `working_hours`, `description` ‚Üí `Businesses`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã

2. **GigaChatTokenUsage** ‚Üí –∑–∞–º–µ–Ω–µ–Ω–∞ –Ω–∞ `TokenUsage`
   - –ú–∏–≥—Ä–∞—Ü–∏—è: –µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ, –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ `TokenUsage`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `TokenUsage` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ

3. **Cards** ‚Üí –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `MapParseResults` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - –ú–∏–≥—Ä–∞—Ü–∏—è: –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ –≤ `MapParseResults`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –æ—Ç—á–µ—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:**
- –£–ø—Ä–æ—â–µ–Ω–∏–µ —Å—Ö–µ–º—ã: -3 —Ç–∞–±–ª–∏—Ü—ã
- –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- –£–ø—Ä–æ—â–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ (–Ω–µ –Ω—É–∂–Ω–æ JOIN —Å –¥—É–±–ª–∏—Ä—É—é—â–∏–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏)

---

##### –≠–¢–ê–ü 3: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ö–æ–∂–∏—Ö —Ç–∞–±–ª–∏—Ü (–£–ª—É—á—à–µ–Ω–∏—è)

**–§–∞–π–ª:** `src/migrate_merge_examples_tables.py`

**–¢–∞–±–ª–∏—Ü—ã –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è:**
- `UserNewsExamples` + `UserReviewExamples` + `UserServiceExamples` ‚Üí `UserExamples`

**–ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```sql
CREATE TABLE UserExamples (
    id TEXT PRIMARY KEY,
    user_id TEXT NOT NULL,
    example_type TEXT NOT NULL,  -- 'news', 'review', 'service'
    example_text TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES Users(id) ON DELETE CASCADE
);

CREATE INDEX idx_user_examples_user_type ON UserExamples(user_id, example_type);
```

**–ú–∏–≥—Ä–∞—Ü–∏—è:**
- –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ 3 —Ç–∞–±–ª–∏—Ü –≤ `UserExamples` —Å —É–∫–∞–∑–∞–Ω–∏–µ–º `example_type`
- –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Ç–∞–±–ª–∏—Ü—ã

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:**
- –£–ø—Ä–æ—â–µ–Ω–∏–µ —Å—Ö–µ–º—ã: -2 —Ç–∞–±–ª–∏—Ü—ã
- –£–ø—Ä–æ—â–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ (–æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ —Ç—Ä–µ—Ö)
- –õ–µ–≥—á–µ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –ø—Ä–∏–º–µ—Ä–æ–≤

---

#### –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

1. **–°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –ë–î** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
2. **–≠—Ç–∞–ø 1:** –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã (–±–µ–∑–æ–ø–∞—Å–Ω–æ, –º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å)
3. **–≠—Ç–∞–ø 2:** –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã (—Ç—Ä–µ–±—É–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö)
4. **–≠—Ç–∞–ø 3:** –û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã Examples (—Ç—Ä–µ–±—É–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö)
5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –∑–∞–ø—Ä–æ—Å–æ–≤
6. **–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é**

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–±–ª–∏—Ü (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ~40 –≤–º–µ—Å—Ç–æ 46)
SELECT COUNT(*) FROM sqlite_master WHERE type='table';

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã
SELECT name FROM sqlite_master WHERE type='index' AND name LIKE 'idx_%';

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤)
EXPLAIN QUERY PLAN SELECT * FROM UserSessions WHERE token = ?;
EXPLAIN QUERY PLAN SELECT * FROM Businesses WHERE is_active = 1;
```

#### Status
- [x] Approved for Implementation
- [x] In Progress (—á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
- [ ] Completed (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)

---

### 2025-01-03 - –ê–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —É–ø—Ä–æ—Å—Ç–∏—Ç–µ–ª—è –∫–æ–¥–∞

#### Current Task
–ê–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —É–ø—Ä–æ—Å—Ç–∏—Ç–µ–ª—è –∫–æ–¥–∞ –∏–∑ `.cursor/docs/SIMPLIFICATION.md` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î

#### Architecture Decision

**–û–¥–æ–±—Ä–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —É–ø—Ä–æ—â–µ–Ω–∏—è:**

1. ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ helper —Ñ—É–Ω–∫—Ü–∏–∏ `ensure_user_examples_table()`** - –æ–¥–æ–±—Ä–µ–Ω–æ –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
   - –£—Å—Ç—Ä–∞–Ω—è–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –≤ 6 –º–µ—Å—Ç–∞—Ö
   - –£–ø—Ä–æ—â–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É (–∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ)
   - –§–∞–π–ª: `src/core/db_helpers.py` - —Å–æ–∑–¥–∞–Ω

2. ‚úÖ **–í—ã–Ω–µ—Å–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ `_migrate_table_data()`** - –æ–¥–æ–±—Ä–µ–Ω–æ –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
   - –£—Å—Ç—Ä–∞–Ω—è–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
   - –£–ø—Ä–æ—â–∞–µ—Ç –∫–æ–¥ –º–∏–≥—Ä–∞—Ü–∏–π
   - –§–∞–π–ª: `src/migrate_remove_duplicate_tables.py` - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

3. ‚úÖ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ guard clauses** - –æ–¥–æ–±—Ä–µ–Ω–æ –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
   - –£–ª—É—á—à–∞–µ—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞
   - –£–º–µ–Ω—å—à–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å
   - –§–∞–π–ª: `src/migrate_merge_examples_tables.py` - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

4. ‚ö†Ô∏è **–£–±—Ä–∞—Ç—å f-strings –∏–∑ SQL** - —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
   - **–ü—Ä–æ–±–ª–µ–º–∞:** –í –∫–æ–¥–µ –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è f-strings –¥–ª—è SQL (—Å—Ç—Ä–æ–∫–∏ 17, 32, 70)
   - **–†–∏—Å–∫:** –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è SQL injection (—Ö–æ—Ç—è –∏–º–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü –∏–∑ –±–µ–ª–æ–≥–æ —Å–ø–∏—Å–∫–∞)
   - **–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—é –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –±–µ–ª–æ–≥–æ —Å–ø–∏—Å–∫–∞

5. ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –∏–º–µ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö** - –æ–¥–æ–±—Ä–µ–Ω–æ
   - –£–ª—É—á—à–∞–µ—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å
   - –§–∞–π–ª: `src/migrate_add_missing_indexes.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

#### Files to Modify

**–¢—Ä–µ–±—É—é—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å):**
- `src/migrate_remove_duplicate_tables.py` (—Å—Ç—Ä–æ–∫–∞ 17) - —É–±—Ä–∞—Ç—å f-string –∏–∑ SQL
- `src/migrate_merge_examples_tables.py` (—Å—Ç—Ä–æ–∫–∏ 32, 70) - —É–±—Ä–∞—Ç—å f-strings –∏–∑ SQL

**–£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- `src/core/db_helpers.py` - —Å–æ–∑–¥–∞–Ω helper –¥–ª—è `ensure_user_examples_table()`
- `src/migrate_remove_duplicate_tables.py` - —Å–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_migrate_table_data()`
- `src/migrate_merge_examples_tables.py` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã guard clauses

#### Trade-offs & Decisions

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å vs –ü—Ä–æ—Å—Ç–æ—Ç–∞:**
- F-strings –≤ SQL —É–ø—Ä–æ—â–∞—é—Ç –∫–æ–¥, –Ω–æ —Å–æ–∑–¥–∞—é—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—É—é —É—è–∑–≤–∏–º–æ—Å—Ç—å
- **–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—é —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –±–µ–ª–æ–≥–æ —Å–ø–∏—Å–∫–∞ (–∏–º–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü –∏–∑ –±–µ–ª–æ–≥–æ —Å–ø–∏—Å–∫–∞, –±–µ–∑–æ–ø–∞—Å–Ω–æ)

**–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å vs –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- Guard clauses —É–ª—É—á—à–∞—é—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å, –Ω–æ —Ç—Ä–µ–±—É—é—Ç –±–æ–ª—å—à–µ —Å—Ç—Ä–æ–∫
- **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å guard clauses (—É–ª—É—á—à–µ–Ω–∏–µ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –≤–∞–∂–Ω–µ–µ)

**–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ vs –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- Helper —Ñ—É–Ω–∫—Ü–∏–∏ —É—Å—Ç—Ä–∞–Ω—è—é—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, –Ω–æ –¥–æ–±–∞–≤–ª—è—é—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
- **–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å `core/db_helpers.py` –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π (–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ)

#### Dependencies

**–ù–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** - –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –∫–æ–¥–µ

**–¢—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –£–±—Ä–∞—Ç—å f-strings –∏–∑ SQL –≤ –º–∏–≥—Ä–∞—Ü–∏—è—Ö (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

#### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –∫–æ–¥–µ—Ä–∞

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å f-strings –≤ SQL:**
   ```python
   # –ë—ã–ª–æ (–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ):
   cursor.execute(f"SELECT COUNT(*) FROM {source_table}")
   cursor.execute(f"DROP TABLE IF EXISTS {table_name}")
   
   # –°—Ç–∞–ª–æ (–±–µ–∑–æ–ø–∞—Å–Ω–æ):
   # –í–∞—Ä–∏–∞–Ω—Ç 1: –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è (–µ—Å–ª–∏ table_name –∏–∑ –±–µ–ª–æ–≥–æ —Å–ø–∏—Å–∫–∞)
   ALLOWED_TABLES = {'ClientInfo', 'GigaChatTokenUsage', 'Cards', 'UserNewsExamples', ...}
   if table_name not in ALLOWED_TABLES:
       raise ValueError(f"–ù–µ—Ä–∞–∑—Ä–µ—à–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞: {table_name}")
   cursor.execute("SELECT COUNT(*) FROM " + table_name)
   cursor.execute("DROP TABLE IF EXISTS " + table_name)
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ f-strings –≤ SQL**

#### Status
- [x] Approved for Implementation
- [x] Partially Implemented
- [ ] Requires Security Fix (f-strings in SQL)

---

### 2024-12-XX - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ "no such column: business_id" –≤ ClientInfo (–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ)

#### Current Task
–ü—Ä–æ–±–ª–µ–º–∞: –º–∏–≥—Ä–∞—Ü–∏—è –≥–æ–≤–æ—Ä–∏—Ç —á—Ç–æ business_id —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –æ—à–∏–±–∫–∞ "no such column: business_id" –≤—Å–µ –µ—â–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è. –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏.

#### Architecture Decision
- –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü—ã ClientInfo –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ `/api/client-info`
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–ª–æ–Ω–æ–∫ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø—ã—Ç–∞—Ç—å—Å—è –Ω–∞–π—Ç–∏ `business_id` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã Businesses –ø–æ `user_id`
- –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ `migrate_clientinfo_add_business_id.py` –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

#### Files to Modify
- `src/main.py` (—Å—Ç—Ä–æ–∫–∏ 3035-3073) - —É–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ ClientInfo:
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–ª–æ–Ω–æ–∫ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º —Ç–∞–±–ª–∏—Ü—ã
  - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏
  - –ü–æ–∏—Å–∫ business_id –∏–∑ —Ç–∞–±–ª–∏—Ü—ã Businesses –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –≤ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- `src/migrate_clientinfo_add_business_id.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏:
  - –£–¥–∞–ª–µ–Ω –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∏–º–ø–æ—Ä—Ç `from core.helpers import find_business_id_for_user`
  - –î–æ–±–∞–≤–ª–µ–Ω –ø—Ä—è–º–æ–π –ø–æ–∏—Å–∫ business_id –∏–∑ —Ç–∞–±–ª–∏—Ü—ã Businesses
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ —Å `updated_at` –≤ INSERT
- `src/check_clientinfo_structure.py` - —Å–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã

#### Trade-offs & Decisions
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è vs –†—É—á–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è**: –í—ã–±—Ä–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ + —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
- **–ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö**: –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ–º —Ç–∞–±–ª–∏—Ü—ã
- **Business_id –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π**: –ï—Å–ª–∏ business_id –Ω–µ—Ç, –ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –µ–≥–æ –∏–∑ Businesses, –∏–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º user_id –∫–∞–∫ fallback

#### Dependencies
- –ù–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ `/api/client-info` –º–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

#### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã
1. –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –≥–æ–≤–æ—Ä–∏—Ç "‚úÖ –ö–æ–ª–æ–Ω–∫–∞ business_id —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç", –Ω–æ –æ—à–∏–±–∫–∞ –≤—Å–µ –µ—â–µ –µ—Å—Ç—å
2. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ —Å–∫—Ä–∏–ø—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è
   - –ú–∏–≥—Ä–∞—Ü–∏—è –≤ main.py –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ
   - –¢–∞–±–ª–∏—Ü–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ –∏–º–µ–µ—Ç business_id, –Ω–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–µ—Ç –ª–æ–∂–Ω—ã–π –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

#### –†–µ—à–µ–Ω–∏–µ
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å `python src/check_clientinfo_structure.py` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
2. –ï—Å–ª–∏ business_id –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç - –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Flask —Å–µ—Ä–≤–µ—Ä (–Ω–µ —Ç–æ–ª—å–∫–æ worker!)

#### Status
- [x] Completed

---

### 2024-12-XX - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ workflow –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞

#### Current Task
–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª —Ä–∞–±–æ—Ç—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Architect_audit_report.md

#### Architecture Decision
- –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `.cursor/rules/architect-workflow.mdc` —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ —Ä–∞–±–æ—Ç—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞
- –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å `AUDIT_REPORT.md` –≤ `.cursor/docs/Architect_audit_report.md`
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –≤ –∫–æ–Ω—Ü–µ –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏

#### Files to Modify
- `.cursor/rules/architect-workflow.mdc` - —Å–æ–∑–¥–∞–Ω —Ñ–∞–π–ª —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ —Ä–∞–±–æ—Ç—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞
- `.cursor/docs/Architect_audit_report.md` - —Å–æ–∑–¥–∞–Ω/–æ–±–Ω–æ–≤–ª–µ–Ω —Ñ–∞–π–ª –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π
- `AUDIT_REPORT.md` - —É–¥–∞–ª–µ–Ω (–ø–µ—Ä–µ–º–µ—â–µ–Ω –≤ `.cursor/docs/`)

#### Trade-offs & Decisions
- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**: –í—Å–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è —Ç–µ–ø–µ—Ä—å –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: –ü—Ä–∞–≤–∏–ª–∞ –≤ `.cursor/rules/` –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (alwaysApply: true)
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å**: –ß–µ—Ç–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è

#### Dependencies
- –ù–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –§–∞–π–ª—ã –ø—Ä–∞–≤–∏–ª –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ Cursor IDE

#### Status
- [x] Completed

---

### 2024-12-XX - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

#### Current Task
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—á–∞–Ω–∏–π –∏–∑ –∞—É–¥–∏—Ç–∞: —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π, CORS, rate limiting, N+1 –∑–∞–ø—Ä–æ—Å—ã

#### Architecture Decision
- –£–¥–∞–ª–∏—Ç—å –º–µ—Ç–æ–¥ `authenticate_user` –∏–∑ `database_manager.py` (—É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ PBKDF2 –∏–∑ `auth_system.py`)
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CORS —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `ALLOWED_ORIGINS` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- –î–æ–±–∞–≤–∏—Ç—å rate limiting —á–µ—Ä–µ–∑ `flask-limiter` —Å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º `rate_limit_if_available()`
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å `get_all_users_with_businesses()`: 4 –∑–∞–ø—Ä–æ—Å–∞ –≤–º–µ—Å—Ç–æ N+1 (–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –≤ Python)

#### Files to Modify
- `src/database_manager.py` - —É–¥–∞–ª–µ–Ω –º–µ—Ç–æ–¥ `authenticate_user`, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω `get_all_users_with_businesses()`
- `src/main.py` - –¥–æ–±–∞–≤–ª–µ–Ω CORS —á–µ—Ä–µ–∑ env –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é, –¥–æ–±–∞–≤–ª–µ–Ω rate limiting —Å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º
- `requirements.txt` - –¥–æ–±–∞–≤–ª–µ–Ω `flask-limiter>=3.5.0`

#### Trade-offs & Decisions
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞ vs –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –í—ã–±—Ä–∞–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - —É–¥–∞–ª–µ–Ω –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–µ—Ç–æ–¥ —Å SHA256
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è N+1 –∑–∞–ø—Ä–æ—Å–æ–≤ —É–ª—É—á—à–∏—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **Backwards compatibility**: –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –ª–æ–º–∞—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ (–º–µ—Ç–æ–¥ `authenticate_user` –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –≤ –ø—Ä–æ–µ–∫—Ç–µ)
- **–ì–∏–±–∫–æ—Å—Ç—å**: CORS —á–µ—Ä–µ–∑ env –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π

#### Dependencies
- **–ù–æ–≤–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**: `flask-limiter>=3.5.0` (–Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å: `pip install "flask-limiter>=3.5.0"`)
- **–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è**: `ALLOWED_ORIGINS` –≤ `.env` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `http://localhost:3000,http://127.0.0.1:3000` –¥–ª—è dev)
- **–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞**: –¥–æ–±–∞–≤–∏—Ç—å –≤ `.env`: `ALLOWED_ORIGINS=https://yourdomain.com`

#### Status
- [x] Completed

---

## üîí –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –°–ª–∞–±—ã–π —Ö–µ—à –ø–∞—Ä–æ–ª—è

**–§–∞–π–ª:** `src/database_manager.py:82-98` (—É–¥–∞–ª–µ–Ω)

**–†–µ—à–µ–Ω–∏–µ:**
- –ú–µ—Ç–æ–¥ `authenticate_user` —Å SHA256 —É–¥–∞–ª–µ–Ω
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `auth_system.authenticate_user` —Å PBKDF2

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

---

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è localhost

**–§–∞–π–ª:** `src/main.py:70-74`

**–†–µ—à–µ–Ω–∏–µ:**
```python
allowed_origins = os.getenv('ALLOWED_ORIGINS', 'http://localhost:3000,http://127.0.0.1:3000').split(',')
allowed_origins = [origin.strip() for origin in allowed_origins if origin.strip()]
CORS(app, supports_credentials=True, origins=allowed_origins)
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞) ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

---

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –ù–µ—Ç rate limiting –Ω–∞ backend

**–§–∞–π–ª:** `src/main.py:76-86, 88-95`

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω `flask-limiter` —Å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º `rate_limit_if_available()`
- –≠–Ω–¥–ø–æ–∏–Ω—Ç `/api/auth/login` –æ–≥—Ä–∞–Ω–∏—á–µ–Ω: 5 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É
- –û–±—â–∏–µ –ª–∏–º–∏—Ç—ã: 200/–¥–µ–Ω—å, 50/—á–∞—Å

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

---

### ‚ö†Ô∏è –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–æ–ª—å –≤ dev —Ä–µ–∂–∏–º–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è

**–§–∞–π–ª:** `src/auth_encryption.py:41`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–æ–ª—å —Å–Ω–∏–∂–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –í—Å–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–Ω—É —Å–æ–ª—å

**–†–µ—à–µ–Ω–∏–µ:**
- –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞: —Ö—Ä–∞–Ω–∏—Ç—å —Å–æ–ª—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—É—é –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- –¢–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥ —Å PBKDF2 –ø—Ä–∏–µ–º–ª–µ–º, –Ω–æ —Å–æ–ª—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ–π

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π (—É–ª—É—á—à–µ–Ω–∏–µ)

---

### ‚úÖ SQL Injection –∑–∞—â–∏—Ç–∞

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –•–æ—Ä–æ—à–æ

–í—Å–µ SQL –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:
```python
cursor.execute("SELECT * FROM Users WHERE email = ?", (email,))
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ f-strings –¥–ª—è –∏–º–µ–Ω –ø–æ–ª–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ:
```python
# –ë–µ–∑–æ–ø–∞—Å–Ω–æ: –∏–º–µ–Ω–∞ –ø–æ–ª–µ–π –∏–∑ –±–µ–ª–æ–≥–æ —Å–ø–∏—Å–∫–∞
cursor.execute(f"UPDATE Businesses SET {', '.join(updates)} WHERE id = ?", params)
```

---

## ‚ö° –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: N+1 –∑–∞–ø—Ä–æ—Å—ã –≤ `get_all_users_with_businesses()`

**–§–∞–π–ª:** `src/database_manager.py:610-681`

**–†–µ—à–µ–Ω–∏–µ:**
- –í–º–µ—Å—Ç–æ N+1 –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 4 –∑–∞–ø—Ä–æ—Å–∞ —Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π –≤ Python
- –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º, –∑–∞—Ç–µ–º –≥—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ `owner_id` –∏ `network_id`
- –£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π (–ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π) ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

---

### ‚ö†Ô∏è –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω–∏—è DatabaseManager

**–ü—Ä–æ–±–ª–µ–º–∞:**
- 162 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `DatabaseManager()` –≤ –ø—Ä–æ–µ–∫—Ç–µ
- –ù–µ –≤—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è —è–≤–Ω–æ
- –†–∏—Å–∫ —É—Ç–µ—á–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ø—Ä–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è—Ö

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å context manager –≤–µ–∑–¥–µ:
```python
with DatabaseManager() as db:
    # –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π

---

### ‚úÖ WAL —Ä–µ–∂–∏–º SQLite

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –•–æ—Ä–æ—à–æ

WAL —Ä–µ–∂–∏–º –≤–∫–ª—é—á–µ–Ω –≤ `safe_db_utils.py`, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —á—Ç–µ–Ω–∏—è
- –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–º –¥–æ—Å—Ç—É–ø–µ

---

### ‚ö†Ô∏è –ë–æ–ª—å—à–æ–π —Ç–∞–π–º–∞—É—Ç –¥–ª—è –ë–î

**–§–∞–π–ª:** `src/safe_db_utils.py:31`

```python
conn = sqlite3.connect(db_path, timeout=30.0)
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- 30 —Å–µ–∫—É–Ω–¥ ‚Äî –æ—á–µ–Ω—å –¥–æ–ª–≥–æ –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—é –∑–∞–ø—Ä–æ—Å–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –£–º–µ–Ω—å—à–∏—Ç—å –¥–æ 5-10 —Å–µ–∫—É–Ω–¥
- –î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π

---

## üèóÔ∏è –ü–†–û–°–¢–û–¢–ê –ò –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### ‚ùå `main.py` —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (8872 —Å—Ç—Ä–æ–∫–∏)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–∞—Ä—É—à–µ–Ω–∏–µ Single Responsibility Principle
- –°–ª–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
- –°–º–µ—à–∞–Ω—ã —Ä–∞–∑–Ω—ã–µ –¥–æ–º–µ–Ω—ã (auth, business, finance, admin)

**–†–µ—à–µ–Ω–∏–µ:**
- –í—ã–Ω–µ—Å—Ç–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ Blueprint'—ã:
  - `business_api.py` ‚Äî –≤—Å–µ `/api/business/*`
  - `finance_api.py` ‚Äî –≤—Å–µ `/api/finance/*`
  - `admin_api.py` ‚Äî –≤—Å–µ `/api/admin/*`
  - `auth_api.py` ‚Äî –≤—Å–µ `/api/auth/*`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π (—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥)

---

### ‚ö†Ô∏è –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ sqlite3.Row

**–§–∞–π–ª:** `src/auth_system.py:100-123`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
if hasattr(user, 'keys'):
    user_id = user['id'] if 'id' in user.keys() else None
    # ... –º–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞
else:
    user_id = user[0] if len(user) > 0 else None
    # ...
```

**–†–µ—à–µ–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—É:
```python
def row_to_dict(row, columns=None):
    if hasattr(row, 'keys'):
        return dict(row)
    if columns:
        return dict(zip(columns, row))
    return dict(row)
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π (—É–ª—É—á—à–µ–Ω–∏–µ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏)

---

### ‚ö†Ô∏è –î–≤–∞ —Å–ø–æ—Å–æ–±–∞ —Ä–∞–±–æ—Ç—ã —Å –ë–î

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `DatabaseManager()` ‚Äî –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π API
- `get_db_connection()` ‚Äî –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –¥–æ—Å—Ç—É–ø

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–∏–µ–º–ª–µ–º–æ
- –†–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –æ–ø—Ä–∞–≤–¥–∞–Ω—ã
- –ù–æ –Ω—É–∂–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, –∫–æ–≥–¥–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

---

### ‚ö†Ô∏è –°–ª–æ–∂–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –†–∞–∑–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- –ò–Ω–æ–≥–¥–∞ `except Exception`, –∏–Ω–æ–≥–¥–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∏–ø—ã
- –ù–µ –≤—Å–µ–≥–¥–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –æ—à–∏–±–∫–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π error handler –≤ Flask

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π

---

## üîÑ –ö–û–ù–§–õ–ò–ö–¢–´

### ‚úÖ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –•–æ—Ä–æ—à–æ

- Worker –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –¥–æ–ª–≥–∏–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
- –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –º–µ–∂–¥—É Blueprint'–∞–º–∏
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã

---

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç: –¥–≤–∞ —Å–ø–æ—Å–æ–±–∞ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `auth_system.py` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PBKDF2 (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
- `database_manager.py` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª SHA256 (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ) ‚úÖ –£–î–ê–õ–ï–ù–û

**–†–µ—à–µ–Ω–∏–µ:**
- –ú–µ—Ç–æ–¥ `authenticate_user` —É–¥–∞–ª–µ–Ω –∏–∑ `database_manager.py`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `auth_system.authenticate_user`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

---

## üìã –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### –ö—Ä–∏—Ç–∏—á–Ω–æ (—Å–¥–µ–ª–∞—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è –≤ `database_manager.py`
2. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CORS –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

### –í–∞–∂–Ω–æ (—Å–¥–µ–ª–∞—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è)
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å rate limiting –Ω–∞ backend
4. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å N+1 –∑–∞–ø—Ä–æ—Å—ã –≤ `get_all_users_with_businesses()`
5. ‚úÖ –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π

### –£–ª—É—á—à–µ–Ω–∏—è (–º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å)
6. üîÑ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `main.py` –Ω–∞ Blueprint'—ã
7. üîÑ –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
8. üîÑ –£–ª—É—á—à–∏—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏ —Å –ë–î
9. üîÑ –°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å sqlite3.Row

---

## üìà –ú–ï–¢–†–ò–ö–ò –ö–ê–ß–ï–°–¢–í–ê

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------|--------|-------------|
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | üü¢ 9/10 | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | üü¢ 9/10 | N+1 –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, WAL —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **–ü—Ä–æ—Å—Ç–æ—Ç–∞** | üü° 6/10 | `main.py` —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π |
| **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** | üü¢ 8/10 | SQLite —Å WAL —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ –¥–ª—è —Ç–µ–∫—É—â–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏ |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** üü¢ **8.0/10** (–±—ã–ª–æ 7.25/10)

---

## ‚úÖ –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢ –•–û–†–û–®–û

1. ‚úÖ –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
2. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã
3. ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã
4. ‚úÖ WAL —Ä–µ–∂–∏–º –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã
5. ‚úÖ –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ auth_data
6. ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤ worker
7. ‚úÖ –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Blueprint'–æ–≤

---

**–í—ã–≤–æ–¥:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã. –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥—É –ø–µ—Ä–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å SQLite. –ü—Ä–∏ —Ä–æ—Å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫–∏ (50+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π) —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ PostgreSQL.

---

## üìä –ü–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- **46-50 —Ç–∞–±–ª–∏—Ü** (–º–Ω–æ–≥–æ –¥–ª—è SQLite)
- **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:** ClientInfo, Cards, GigaChatTokenUsage
- **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–Ω–¥–µ–∫—Å–æ–≤:** –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ–ª—è—Ö
- **–ü–æ—Ö–æ–∂–∏–µ —Ç–∞–±–ª–∏—Ü—ã:** UserNewsExamples, UserReviewExamples, UserServiceExamples –º–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å

### –ü–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (3 —ç—Ç–∞–ø–∞)

#### –≠–¢–ê–ü 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ (–ö—Ä–∏—Ç–∏—á–Ω–æ)
**–§–∞–π–ª:** `src/migrate_add_missing_indexes.py`

**–ò–Ω–¥–µ–∫—Å—ã:**
- `UserSessions.token`, `UserSessions.expires_at`
- `Businesses.is_active`, `Businesses.subscription_status`
- `Bookings.status`, `Bookings(business_id, status)` - —Å–æ—Å—Ç–∞–≤–Ω–æ–π
- `ExternalBusinessReviews.published_at`, `ExternalBusinessReviews(business_id, published_at)` - —Å–æ—Å—Ç–∞–≤–Ω–æ–π
- `ChatGPTRequests(business_id, response_status)` - —Å–æ—Å—Ç–∞–≤–Ω–æ–π
- `TokenUsage(business_id, created_at)` - —Å–æ—Å—Ç–∞–≤–Ω–æ–π

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ 5-10 —Ä–∞–∑

---

#### –≠–¢–ê–ü 2: –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü (–í–∞–∂–Ω–æ)
**–§–∞–π–ª:** `src/migrate_remove_duplicate_tables.py`

**–¢–∞–±–ª–∏—Ü—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:**
1. `ClientInfo` ‚Üí –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ `Businesses`
2. `GigaChatTokenUsage` ‚Üí –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `TokenUsage` (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ)
3. `Cards` ‚Üí –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `MapParseResults` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** -3 —Ç–∞–±–ª–∏—Ü—ã, —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

---

#### –≠–¢–ê–ü 3: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ö–æ–∂–∏—Ö —Ç–∞–±–ª–∏—Ü (–£–ª—É—á—à–µ–Ω–∏—è)
**–§–∞–π–ª:** `src/migrate_merge_examples_tables.py`

**–¢–∞–±–ª–∏—Ü—ã –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è:**
- `UserNewsExamples` + `UserReviewExamples` + `UserServiceExamples` ‚Üí `UserExamples`
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `example_type` ('news', 'review', 'service')

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** -2 —Ç–∞–±–ª–∏—Ü—ã, —É–ø—Ä–æ—â–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

---

### –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- 46-50 —Ç–∞–±–ª–∏—Ü
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–Ω–µ—Ç –∏–Ω–¥–µ–∫—Å–æ–≤)

**–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- 40-41 —Ç–∞–±–ª–∏—Ü–∞ (-5-9 —Ç–∞–±–ª–∏—Ü)
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ 5-10 —Ä–∞–∑
- –£–ø—Ä–æ—â–µ–Ω–∏–µ —Å—Ö–µ–º—ã –∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

**–ü–æ–¥—Ä–æ–±–Ω—ã–π –ø–ª–∞–Ω:** —Å–º. —Å–µ–∫—Ü–∏—é "2025-01-03 - –ü–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö" –≤—ã—à–µ.

---

### 2025-01-03 - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤ Nginx –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –Ø–Ω–¥–µ–∫—Å.–ë–∏–∑–Ω–µ—Å

#### Current Task
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –æ–±—Ä—ã–≤–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –Ø–Ω–¥–µ–∫—Å.–ë–∏–∑–Ω–µ—Å –ø–æ —Ç–∞–π–º–∞—É—Ç—É Nginx

#### Architecture Decision

**–ü—Ä–∏–Ω—è—Ç–æ —Ä–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç—ã Nginx –¥–æ 600 —Å–µ–∫—É–Ω–¥ (10 –º–∏–Ω—É—Ç) –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –Ø–Ω–¥–µ–∫—Å.–ë–∏–∑–Ω–µ—Å

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–¥–ª—è –±—É–¥—É—â–µ–≥–æ):** –°–¥–µ–ª–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å (–∫–∞–∫ –æ–±—ã—á–Ω—ã–π –ø–∞—Ä—Å–µ—Ä)

#### Files to Modify

**–í–∞—Ä–∏–∞–Ω—Ç 1 (–±—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ):**
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–æ–±—ã—á–Ω–æ `/etc/nginx/sites-available/default`)
  - –£–≤–µ–ª–∏—á–∏—Ç—å `proxy_read_timeout` –¥–æ 600s
  - –£–≤–µ–ª–∏—á–∏—Ç—å `proxy_connect_timeout` –¥–æ 600s
  - –£–≤–µ–ª–∏—á–∏—Ç—å `proxy_send_timeout` –¥–æ 600s

**–í–∞—Ä–∏–∞–Ω—Ç 2 (–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ):**
- `src/main.py` - –∏–∑–º–µ–Ω–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç `/api/admin/yandex/sync/business/<business_id>` (—Å—Ç—Ä–æ–∫–∏ 5484-5595)
- `src/worker.py` - –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–∞–¥–∞—á —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `SyncQueue` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ParseQueue` —Å –Ω–æ–≤—ã–º —Ç–∏–ø–æ–º –∑–∞–¥–∞—á–∏

#### Trade-offs & Decisions

**–ü—Ä–æ—Å—Ç–æ—Ç–∞ vs –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å:**
- –í–∞—Ä–∏–∞–Ω—Ç 1 (—É–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç—ã) - –ø—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ, –Ω–æ –Ω–µ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –ø–æ–ª–Ω–æ—Å—Ç—å—é
- –í–∞—Ä–∏–∞–Ω—Ç 2 (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞) - –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å 5-10 –º–∏–Ω—É—Ç –¥–ª—è –±–∏–∑–Ω–µ—Å–æ–≤ —Å –±–æ–ª—å—à–∏–º –æ–±—ä–µ–º–æ–º –¥–∞–Ω–Ω—ã—Ö
- –¢–µ–∫—É—â–∏–µ —Ç–∞–π–º–∞—É—Ç—ã (300 —Å–µ–∫—É–Ω–¥) –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 600 —Å–µ–∫—É–Ω–¥ (10 –º–∏–Ω—É—Ç)

**–†–∏—Å–∫–∏:**
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—é –¥–æ–ª–≥–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—Ä–µ–±—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –æ—á–µ—Ä–µ–¥–∏ –∏ worker'–∞

**–†–µ—à–µ–Ω–∏–µ:**
- –°–Ω–∞—á–∞–ª–∞ —É–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç—ã (–±—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ)
- –ü–æ—Ç–æ–º —Å–¥–µ–ª–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É (–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ)

#### Dependencies

**–ù–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** - —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx –∏–ª–∏ –∫–æ–¥–µ

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Nginx –ø–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Flask –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ

#### Status
- [x] Approved for Implementation
- [ ] In Progress
- [ ] Completed

**–ü–æ–¥—Ä–æ–±–Ω–∞—è –∑–∞–¥–∞—á–∞:** —Å–º. `TASK_NGINX_TIMEOUTS_FIX.md`

---

### 2025-01-03 - –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ SyncQueue –∏ ParseQueue –≤ –µ–¥–∏–Ω—É—é –æ—á–µ—Ä–µ–¥—å

#### Current Task
–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–≤—É—Ö –æ—á–µ—Ä–µ–¥–µ–π (ParseQueue –∏ SyncQueue) –≤ –æ–¥–Ω—É –¥–ª—è –µ–¥–∏–Ω–æ–π –ª–æ–≥–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á

#### Architecture Decision

**–ü—Ä–∏–Ω—è—Ç–æ —Ä–µ—à–µ–Ω–∏–µ:** –û–±—ä–µ–¥–∏–Ω–∏—Ç—å SyncQueue –≤ ParseQueue, –¥–æ–±–∞–≤–∏–≤ –ø–æ–ª–µ `task_type` –¥–ª—è —Ä–∞–∑–ª–∏—á–µ–Ω–∏—è —Ç–∏–ø–æ–≤ –∑–∞–¥–∞—á

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á
- –£–ø—Ä–æ—â–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ worker.py
- –õ–µ–≥—á–µ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –∑–∞–¥–∞—á
- –£–ø—Ä–æ—â–µ–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–æ–¥–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞)

#### Files to Modify

**–ú–∏–≥—Ä–∞—Ü–∏—è:**
- `src/migrate_syncqueue_to_parsequeue.py` - —Å–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö

**–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:**
- `src/init_database_schema.py` - –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –≤ ParseQueue, —É–±—Ä–∞—Ç—å SyncQueue

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏:**
- `src/worker.py` - –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å `process_queue()` –∏ `process_sync_queue()`
- `src/main.py` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ParseQueue –≤–º–µ—Å—Ç–æ SyncQueue –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

#### Trade-offs & Decisions

**–ü—Ä–æ—Å—Ç–æ—Ç–∞ vs –ú–∏–≥—Ä–∞—Ü–∏—è:**
- –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —É–ø—Ä–æ—Å—Ç–∏—Ç –∫–æ–¥, –Ω–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- **–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é —Å –±—ç–∫–∞–ø–æ–º, –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ, —É–¥–∞–ª–∏—Ç—å SyncQueue

**–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
- –°—Ç–∞—Ä—ã–µ –∑–∞–¥–∞—á–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ (–±–µ–∑ `task_type`) –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å
- **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `task_type = 'parse_card'` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–¢–∏–ø—ã –∑–∞–¥–∞—á:**
- `parse_card` - –ø–∞—Ä—Å–∏–Ω–≥ –ø—É–±–ª–∏—á–Ω—ã—Ö –∫–∞—Ä—Ç (—Ç–µ–∫—É—â–∏–π)
- `sync_yandex_business` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ø–Ω–¥–µ–∫—Å.–ë–∏–∑–Ω–µ—Å
- `sync_google_business` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Google Business
- `sync_2gis` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è 2–ì–ò–°

#### Dependencies

**–ù–æ–≤—ã–µ –ø–æ–ª—è –≤ ParseQueue:**
- `task_type TEXT DEFAULT 'parse_card'`
- `account_id TEXT`
- `source TEXT`
- `error_message TEXT`
- `updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP`

**–ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:**
- –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏–∑ SyncQueue –≤ ParseQueue
- –£–¥–∞–ª–∏—Ç—å SyncQueue –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ worker.py:**
- –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—á–µ—Ä–µ–¥–µ–π
- –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∑–∞–¥–∞—á

#### Status
- [x] Approved for Implementation
- [x] In Progress
- [x] Completed

**–ü–æ–¥—Ä–æ–±–Ω–∞—è –∑–∞–¥–∞—á–∞:** —Å–º. `TASK_UNIFY_QUEUES.md`

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è `src/migrate_syncqueue_to_parsequeue.py` –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö

---

### 2025-01-03 - –ü–∞—Ä—Å–∏–Ω–≥ –∏–∑ –∫–∞–±–∏–Ω–µ—Ç–∞ –∫–∞–∫ fallback –∏ —Ä–æ—Ç–∞—Ü–∏—è IP-–∞–¥—Ä–µ—Å–æ–≤

#### Current Task
1. –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –∏–∑ –∫–∞–±–∏–Ω–µ—Ç–∞ –∫–∞–∫ —Ç—Ä–µ—Ç—å—é –æ—á–µ—Ä–µ–¥—å –¥–ª—è –¥–æ–ø–∞—Ä—Å–∏–Ω–≥–∞ –Ω–µ—É—Å–ø–µ—à–Ω–æ–≥–æ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–æ—Ç–∞—Ü–∏—é IP-–∞–¥—Ä–µ—Å–æ–≤ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –Ø–Ω–¥–µ–∫—Å

#### Architecture Decision

**1. Fallback –ø–∞—Ä—Å–∏–Ω–≥ —á–µ—Ä–µ–∑ –∫–∞–±–∏–Ω–µ—Ç:**
- –î–æ–±–∞–≤–∏—Ç—å `task_type = 'parse_cabinet_fallback'` –≤ ParseQueue
- –ü–æ—Å–ª–µ –Ω–µ—É—Å–ø–µ—à–Ω–æ–≥–æ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ (–∫–∞–ø—á–∞, –Ω–µ–ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –æ—à–∏–±–∫–∏) –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ –∫–∞–±–∏–Ω–µ—Ç–∞
- –ï—Å–ª–∏ –µ—Å—Ç—å –∫–∞–±–∏–Ω–µ—Ç ‚Üí —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–¥–∞—á—É fallback ‚Üí –¥–æ–ø–æ–ª–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ YandexBusinessParser

**2. –†–æ—Ç–∞—Ü–∏—è IP —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏:**
- –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `ProxyServers` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–∫—Å–∏
- –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å `ProxyManager` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∫—Å–∏
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏ –≤ –≤—Å–µ –ø–∞—Ä—Å–µ—Ä—ã (interception, legacy, yandex_business)
- –†–æ—Ç–∞—Ü–∏—è —á–µ—Ä–µ–∑ round-robin —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –Ω–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø—Ä–æ–∫—Å–∏

#### Files to Modify

**Fallback –ø–∞—Ä—Å–∏–Ω–≥:**
- `src/worker.py` - –¥–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ fallback
- `src/init_database_schema.py` - —É–∂–µ –µ—Å—Ç—å –ø–æ–ª—è –≤ ParseQueue (task_type, account_id)

**–†–æ—Ç–∞—Ü–∏—è IP:**
- `src/init_database_schema.py` - —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É ProxyServers
- `src/proxy_manager.py` - —Å–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∫—Å–∏
- `src/parser_interception.py` - –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏
- `src/parser.py` - –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏
- `src/yandex_business_parser.py` - –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏
- `src/main.py` - –¥–æ–±–∞–≤–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∫—Å–∏

#### Trade-offs & Decisions

**Fallback –ø–∞—Ä—Å–∏–Ω–≥:**
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞ vs –ü–æ–ª–Ω–æ—Ç–∞ –¥–∞–Ω–Ω—ã—Ö:** Fallback —É—Å–ª–æ–∂–Ω—è–µ—Ç –ª–æ–≥–∏–∫—É, –Ω–æ –¥–∞–µ—Ç –±–æ–ª–µ–µ –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** Fallback –ø–∞—Ä—Å–∏–Ω–≥ –º–µ–¥–ª–µ–Ω–Ω–µ–µ (HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ API –∫–∞–±–∏–Ω–µ—Ç–∞)
- **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ (–Ω–µ—É—Å–ø–µ—à–Ω—ã–π –ø—É–±–ª–∏—á–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥)

**–†–æ—Ç–∞—Ü–∏—è IP:**
- **–°—Ç–æ–∏–º–æ—Å—Ç—å vs –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** –ü—Ä–æ–∫—Å–∏ —Ç—Ä–µ–±—É—é—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤, –Ω–æ –¥–∞—é—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ü—Ä–æ–∫—Å–∏ –º–æ–≥—É—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ 10-20%
- **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∑–∏–¥–µ–Ω—Ç–Ω—ã–µ –ø—Ä–æ–∫—Å–∏ (–º–µ–Ω—å—à–µ –±–∞–Ω–æ–≤, –≤—ã—à–µ —Å–∫–æ—Ä–æ—Å—Ç—å)

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**
- VPN —Ä–æ—Ç–∞—Ü–∏—è (–º–µ–¥–ª–µ–Ω–Ω–µ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ)
- Tor (–æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ, –Ω–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
- –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø—Ä–æ–∫—Å–∏ (–º–µ–Ω–µ–µ –Ω–∞–¥–µ–∂–Ω–æ)

#### Dependencies

**Fallback –ø–∞—Ä—Å–∏–Ω–≥:**
- –£–∂–µ –µ—Å—Ç—å –ø–æ–ª—è –≤ ParseQueue (task_type, account_id)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π YandexBusinessParser
- –¢—Ä–µ–±—É–µ—Ç –Ω–∞–ª–∏—á–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞ –≤ ExternalBusinessAccounts

**–†–æ—Ç–∞—Ü–∏—è IP:**
- –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞: `ProxyServers`
- –ù–æ–≤—ã–π –º–æ–¥—É–ª—å: `proxy_manager.py`
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: requests (—É–∂–µ –µ—Å—Ç—å), playwright (—É–∂–µ –µ—Å—Ç—å)
- –ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä—ã (–Ω—É–∂–Ω–æ –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏/–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å)

#### Status
- [x] Approved for Implementation
- [ ] In Progress
- [ ] Completed

**–ü–æ–¥—Ä–æ–±–Ω—ã–µ –∑–∞–¥–∞—á–∏:**
- `TASK_CABINET_FALLBACK_PARSING.md` - fallback –ø–∞—Ä—Å–∏–Ω–≥ —á–µ—Ä–µ–∑ –∫–∞–±–∏–Ω–µ—Ç
- `TASK_IP_ROTATION.md` - —Ä–æ—Ç–∞—Ü–∏—è IP-–∞–¥—Ä–µ—Å–æ–≤ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏

---

### 2025-01-03 - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–∑—ã–≤–æ–≤, –¥–∞—Ç –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

#### Current Task
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤:
1. –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–∑—ã–≤–æ–≤ –Ω–µ —Å–ø–∞—Ä—Å–∏–ª –Ω–∏ –æ–¥–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
2. –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–∞—Ç—É –æ—Ç–∑—ã–≤–∞ - –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ, –∫–æ–≥–¥–∞ –æ–Ω–∏ –Ω–∞–ø–∏—Å–∞–Ω—ã
3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (500 –æ—à–∏–±–∫–∞)
4. –û—Ç–≤–µ—Ç –Ω–∞ –æ—Ç–∑—ã–≤ —Ç–∞–∫–∂–µ –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è (500 –æ—à–∏–±–∫–∞: "string indices must be integers, not 'str'")

#### Architecture Decision

**1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –æ—Ç–∑—ã–≤—ã:**
- –ü—Ä–æ–±–ª–µ–º–∞: `analyze_text_with_gigachat()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É, –Ω–æ –∫–æ–¥ –ø—ã—Ç–∞–µ—Ç—Å—è –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –Ω–µ–π –∫–∞–∫ –∫ —Å–ª–æ–≤–∞—Ä—é
- –†–µ—à–µ–Ω–∏–µ: –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É, –ø–∞—Ä—Å–∏—Ç—å JSON –∏–∑ —Å—Ç—Ä–æ–∫–∏, –∏–º–µ—Ç—å fallback

**2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π:**
- –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ 500 –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- –†–µ—à–µ–Ω–∏–µ: –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç (—Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ —Å–ª–æ–≤–∞—Ä—å), –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞ –æ—à–∏–±–∫–∏, –¥–æ–±–∞–≤–ª—è—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**3. –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:**
- –ü—Ä–æ–±–ª–µ–º–∞: –û—Ç–≤–µ—Ç—ã –Ω–µ –ø–∞—Ä—Å—è—Ç—Å—è –∏–ª–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- –†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ –≤ –ø–∞—Ä—Å–µ—Ä–∞—Ö, –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

**4. –î–∞—Ç–∞ –æ—Ç–∑—ã–≤–∞:**
- –ü—Ä–æ–±–ª–µ–º–∞: –î–∞—Ç–∞ –º–æ–∂–µ—Ç –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤–µ–∑–¥–µ
- –†–µ—à–µ–Ω–∏–µ: –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –¥–∞—Ç–∞ –ø–∞—Ä—Å–∏—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ UI

#### Files to Modify

**–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- `src/main.py` (—Å—Ç—Ä–æ–∫–∏ 2659-2682) - –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ `/api/reviews/reply`
- `src/main.py` (—Å—Ç—Ä–æ–∫–∏ 2246-2272) - –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ `/api/news/generate`

**–ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–æ–≤:**
- `src/parser_interception.py` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ –∏–∑ API
- `src/parser.py` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ HTML –æ—Ç–≤–µ—Ç–æ–≤
- `src/worker.py` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤

**–î–∞—Ç–∞ –æ—Ç–∑—ã–≤–∞:**
- `src/parser_interception.py` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞—Ç—ã
- `src/parser.py` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç—ã
- `frontend/src/components/ReviewReplyAssistant.tsx` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞—Ç—ã

#### Trade-offs & Decisions

**–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ GigaChat:**
- `analyze_text_with_gigachat()` –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É
- –ù—É–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å JSON –∏–∑ —Å—Ç—Ä–æ–∫–∏, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
- Fallback –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –∫–∞–∫ –µ—Å—Ç—å, –µ—Å–ª–∏ JSON –Ω–µ —Ä–∞—Å–ø–∞—Ä—Å–∏–ª—Å—è

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –∏ –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–≤—ã–µ 200 —Å–∏–º–≤–æ–ª–æ–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

#### Dependencies

**–ù–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** - —Ç–æ–ª—å–∫–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞

#### Status
- [x] Approved for Implementation
- [ ] In Progress
- [ ] Completed

**–ü–æ–¥—Ä–æ–±–Ω–∞—è –∑–∞–¥–∞—á–∞:** —Å–º. `TASK_FIX_REVIEWS_AND_GENERATION.md`

---

### 2025-01-06 - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –∏ —Ç–∞–±–ª–∏—Ü –¥–ª—è –ò–ò-–∞–≥–µ–Ω—Ç–∞

#### Current Task
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ–ª–µ–π –∏ —Ç–∞–±–ª–∏—Ü –¥–ª—è –ò–ò-–∞–≥–µ–Ω—Ç–∞

#### Architecture Decision

**–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –≤ Businesses:**
- `waba_phone_id`, `waba_access_token` - –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å WhatsApp Business API
- `telegram_bot_token` - —Ç–æ–∫–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ Telegram –±–æ—Ç–∞
- `ai_agent_enabled`, `ai_agent_tone`, `ai_agent_restrictions` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ò–ò-–∞–≥–µ–Ω—Ç–∞

**–°–æ–∑–¥–∞–Ω—ã –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**
- `AIAgentConversations` - —Ä–∞–∑–≥–æ–≤–æ—Ä—ã —Å –ò–ò-–∞–≥–µ–Ω—Ç–æ–º (WhatsApp, Telegram)
- `AIAgentMessages` - —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞—Ö —Å –ò–ò-–∞–≥–µ–Ω—Ç–æ–º

**–°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–∏:**
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (2025-01-06)
- ‚úÖ –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
- ‚úÖ –ü–æ–ª—è –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ Businesses

#### Files to Modify

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- `README.md` - –æ–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ë–î
- `.cursor/docs/VERIFICATION.md` - –æ–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —Ç–∞–±–ª–∏—Ü Businesses, AIAgentConversations, AIAgentMessages

#### Trade-offs & Decisions

**–ù–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π** - —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏

#### Dependencies

**–ù–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** - –º–∏–≥—Ä–∞—Ü–∏—è —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞

#### Status
- [x] Approved for Implementation
- [x] In Progress
- [x] Completed

**–ú–∏–≥—Ä–∞—Ü–∏—è:** `migrations/migrate_ai_agent_fields.py` (–ø—Ä–∏–º–µ–Ω–µ–Ω–æ 2025-01-06)

---

### 2025-01-06 - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API —É—Å–ª—É–≥ –∏ UI —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### Current Task
–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏ –≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —É—Å–ª—É–≥:
1. –ü–æ–ª—è `optimized_name` –∏ `optimized_description` –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∏–∑ API (–±–æ–ª–µ–µ 30 –ø–æ–ø—ã—Ç–æ–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
2. –ö–Ω–æ–ø–∫–∞ "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –Ω–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
3. UI –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫

#### Architecture Decision

**1. API get_services():**
- –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ `sqlite3.Row`
- –†–µ—à–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `dict(service)` –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è Row –≤ —Å–ª–æ–≤–∞—Ä—å, –∏–ª–∏ –ø—Ä—è–º–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –ø–æ –∏–Ω–¥–µ–∫—Å—É
- –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

**2. –ö–Ω–æ–ø–∫–∞ "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å":**
- –ü—Ä–æ–±–ª–µ–º–∞: `setEditingService()` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –Ω–æ –Ω–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
- –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Ñ–æ—Ä–º–æ–π —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É—Å–ª—É–≥–∏
- –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ `editingForm` –∏ `useEffect` –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã

**3. UI –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- –ö–æ–¥ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É–∂–µ –µ—Å—Ç—å (—Å—Ç—Ä–æ–∫–∏ 663-785 –≤ CardOverviewPage.tsx)
- –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è API –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –∫–Ω–æ–ø–æ–∫ "–ü—Ä–∏–Ω—è—Ç—å"/"–û—Ç–∫–ª–æ–Ω–∏—Ç—å"

#### Files to Modify

**Backend:**
- `src/main.py` (—Å—Ç—Ä–æ–∫–∏ 3078-3171) - –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ `sqlite3.Row` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `get_services()`

**Frontend:**
- `frontend/src/pages/dashboard/CardOverviewPage.tsx`:
  - –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ `editingForm`
  - –î–æ–±–∞–≤–∏—Ç—å `useEffect` –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã
  - –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É—Å–ª—É–≥–∏
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ `optimized_name` –∏ `optimized_description`

#### Trade-offs & Decisions

**–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ sqlite3.Row:**
- `sqlite3.Row` –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Å–ª–æ–≤–∞—Ä—å –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `dict(service)` –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ø—Ä—è–º–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –ø–æ –∏–Ω–¥–µ–∫—Å—É, –∑–Ω–∞—è –ø–æ—Ä—è–¥–æ–∫ –ø–æ–ª–µ–π

**–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω —Å `showAddService` –∫–∞–∫ –ø—Ä–∏–º–µ—Ä
- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ –∏ —É–¥–æ–±–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### Dependencies

**–ù–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** - —Ç–æ–ª—å–∫–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞

#### Status
- [x] Approved for Implementation
- [ ] In Progress
- [ ] Completed

**–ü–æ–¥—Ä–æ–±–Ω–∞—è –∑–∞–¥–∞—á–∞:** —Å–º. `TASK_FIX_SERVICES_API_AND_UI.md`

---

### 2025-01-06 - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Google Business Profile API –∏ —É–ª—É—á—à–µ–Ω–∏–µ –î–∞—à–±–æ—Ä–¥–∞

#### Current Task
1. –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Google Business Profile API (–ø–æ–ª—É—á–µ–Ω–∏–µ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö)
2. –ü–æ–¥–≤–∫–ª–∞–¥–∫–∏ –≤ "–†–∞–±–æ—Ç–∞ —Å –∫–∞—Ä—Ç–∞–º–∏" –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º –∫–∞—Ä—Ç
3. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ "–ü—Ä–æ–≥—Ä–µ—Å—Å" ‚Üí "–î–∞—à–±–æ—Ä–¥" —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º
4. –°—Ç–∞—Ç—É—Å –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤ –î–∞—à–±–æ—Ä–¥–µ

#### Architecture Decision

**1. Google Business Profile API:**
- OAuth 2.0 –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Google Cloud Console
- –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö: –æ—Ç–∑—ã–≤—ã, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –ø–æ—Å—Ç—ã, —Ñ–æ—Ç–æ
- –ü—É–±–ª–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö: –æ—Ç–≤–µ—Ç—ã –Ω–∞ –æ—Ç–∑—ã–≤—ã, –ø–æ—Å—Ç—ã/–Ω–æ–≤–æ—Å—Ç–∏
- ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: —É—Å–ª—É–≥–∏ –Ω–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ API (—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –ø—Ä–æ—Å–º–æ—Ç—Ä—ã, –∫–ª–∏–∫–∏, –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤, –ø–µ—Ä–µ—Ö–æ–¥—ã –Ω–∞ —Å–∞–π—Ç, –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –∑–≤–æ–Ω–æ–∫

**2. –ü–æ–¥–≤–∫–ª–∞–¥–∫–∏ –≤ "–†–∞–±–æ—Ç–∞ —Å –∫–∞—Ä—Ç–∞–º–∏":**
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∫–∞—Ä—Ç—ã –ø–æ URL (–Ø–Ω–¥–µ–∫—Å, Google, 2–ì–ò–°)
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–≤–∫–ª–∞–¥–æ–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Å—ã–ª–æ–∫ –∏–∑ `BusinessMapLinks`
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (—É—Å–ª—É–≥–∏, –æ—Ç–∑—ã–≤—ã, –Ω–æ–≤–æ—Å—Ç–∏) –ø–æ –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ

**3. –î–∞—à–±–æ—Ä–¥:**
- –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ "–ü—Ä–æ–≥—Ä–µ—Å—Å" ‚Üí "–î–∞—à–±–æ—Ä–¥"
- –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ –≤—Å–µ—Ö –∫–∞—Ä—Ç –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –±–∏–∑–Ω–µ—Å—É
- –ì—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–æ—Ç–∑—ã–≤—ã, —Ä–µ–π—Ç–∏–Ω–≥, –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–∏)
- –°—Ç–∞—Ç—É—Å –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤ –±–ª–æ–∫–µ "–ü–∞—Ä—Å–∏–Ω–≥ –∫–∞—Ä—Ç"

#### Files to Modify

**Google Business API:**
- `src/google_business_auth.py` (—Å–æ–∑–¥–∞—Ç—å) - OAuth 2.0 –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `src/google_business_api.py` (—Å–æ–∑–¥–∞—Ç—å) - API –∫–ª–∏–µ–Ω—Ç
- `src/google_business_sync_worker.py` - –∑–∞–º–µ–Ω–∏—Ç—å –∑–∞–≥–ª—É—à–∫–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã
- `src/api/google_business_api.py` (—Å–æ–∑–¥–∞—Ç—å Blueprint) - API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- `requirements.txt` - –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Google API

**–ü–æ–¥–≤–∫–ª–∞–¥–∫–∏ –∏ –î–∞—à–±–æ—Ä–¥:**
- `frontend/src/pages/dashboard/CardOverviewPage.tsx` - –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–≤–∫–ª–∞–¥–∫–∏
- `frontend/src/pages/dashboard/ProgressPage.tsx` ‚Üí `DashboardPage.tsx` (–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å)
- `frontend/src/App.tsx` - –æ–±–Ω–æ–≤–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã
- `frontend/src/components/MapParseTable.tsx` - –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–∞—Ä—Å–∏–Ω–≥–∞
- `src/main.py` - –¥–æ–±–∞–≤–∏—Ç—å endpoints –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ —Å—Ç–∞—Ç—É—Å–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞

#### Trade-offs & Decisions

**Google Business API:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å OAuth 2.0 —Å offline access –¥–ª—è refresh token
- –®–∏—Ñ—Ä–æ–≤–∞—Ç—å credentials –≤ –ë–î —á–µ—Ä–µ–∑ `auth_encryption.py`
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: —É—Å–ª—É–≥–∏ –Ω–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ API - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å –æ–± —ç—Ç–æ–º

**–ü–æ–¥–≤–∫–ª–∞–¥–∫–∏:**
- –û–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ç–∏–ø –∫–∞—Ä—Ç—ã –ø–æ URL –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å `map_type` –≤ `BusinessMapLinks` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- Fallback –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–∞—Ä—Ç

**–î–∞—à–±–æ—Ä–¥:**
- –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ `ExternalBusinessStats` –¥–ª—è –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏ —Å—É–º–º—ã
- –†–∞–∑–±–∏–≤–∫–∞ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

#### Dependencies

**Google API:**
- `google-api-python-client>=2.100.0`
- `google-auth-httplib2>=0.1.1`
- `google-auth-oauthlib>=1.1.0`

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
- `GOOGLE_CLIENT_ID` - OAuth 2.0 Client ID
- `GOOGLE_CLIENT_SECRET` - OAuth 2.0 Client Secret
- `GOOGLE_REDIRECT_URI` - Redirect URI –¥–ª—è OAuth callback

#### Status
- [x] Approved for Implementation
- [ ] In Progress
- [ ] Completed

**–ü–æ–¥—Ä–æ–±–Ω—ã–µ –∑–∞–¥–∞—á–∏:**
- `TASK_GOOGLE_BUSINESS_API.md` - –ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Google Business Profile API
- `TASK_MAPS_TABS_AND_DASHBOARD.md` - –ø–æ–¥–≤–∫–ª–∞–¥–∫–∏ –∫–∞—Ä—Ç –∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –î–∞—à–±–æ—Ä–¥–∞
- `FRONTEND_GOOGLE_OAUTH_WIDGET.md` - –≤–∏–¥–∂–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Google –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
- `TASK_ADMIN_PARSING_TAB.md` - –≤–∫–ª–∞–¥–∫–∞ "–ü–∞—Ä—Å–∏–Ω–≥" –≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏

**–í–∞–∂–Ω–æ:** OAuth 2.0 –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –≤ Google Cloud Console. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑—É—é—Ç—Å—è —á–µ—Ä–µ–∑ –≤–∏–¥–∂–µ—Ç/–∫–Ω–æ–ø–∫—É –Ω–∞ —Å–∞–π—Ç–µ - –∏–º –Ω–µ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å Google Cloud Console —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.

---

### 2025-01-06 - –í–∫–ª–∞–¥–∫–∞ "–ü–∞—Ä—Å–∏–Ω–≥" –≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏

#### Current Task
–î–æ–±–∞–≤–∏—Ç—å –≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–Ω–µ–ª—å "–ë–∞–∑–∏—á" –Ω–æ–≤—É—é –≤–∫–ª–∞–¥–∫—É "–ü–∞—Ä—Å–∏–Ω–≥" –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –∫–æ–Ω—Å–æ–ª—å.

#### Architecture Decision

**–¶–µ–ª—å:** –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å —Å—Ç–∞—Ç—É—Å—ã –∑–∞–¥–∞—á –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –∏–º–∏ —á–µ—Ä–µ–∑ UI, –∞ –Ω–µ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å.

**–ü–æ–¥—Ö–æ–¥:**
- –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `ParsingManagement.tsx` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–¥–∞—á –∏–∑ ParseQueue
- –î–æ–±–∞–≤–∏—Ç—å API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–¥–∞—á, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏—è
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –ø–æ –∫–Ω–æ–ø–∫–µ "–û–±–Ω–æ–≤–∏—Ç—å" (–±–µ–∑ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ polling)
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∑–∞–≤–∏—Å—à–∏–µ –∑–∞–¥–∞—á–∏ (processing –±–æ–ª–µ–µ 30 –º–∏–Ω—É—Ç) —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π (—Å—Ç–∞—Ç—É—Å, —Ç–∏–ø, –∏—Å—Ç–æ—á–Ω–∏–∫)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º, —Ç–∏–ø–∞–º –∑–∞–¥–∞—á, –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∑–∞–≤–∏—Å—à–∏—Ö –∏–ª–∏ –æ—à–∏–±–æ—á–Ω—ã—Ö –∑–∞–¥–∞—á
- –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –∏–∑ –æ—á–µ—Ä–µ–¥–∏
- –í–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å—Ç–∞—Ç—É—Å–æ–≤

#### Files to Modify

**Backend:**
- `src/main.py` - –¥–æ–±–∞–≤–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:
  - `GET /api/admin/parsing/tasks` - —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
  - `POST /api/admin/parsing/tasks/<id>/restart` - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∑–∞–¥–∞—á–∏
  - `DELETE /api/admin/parsing/tasks/<id>` - —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
  - `GET /api/admin/parsing/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞

**Frontend:**
- `frontend/src/components/ParsingManagement.tsx` (—Å–æ–∑–¥–∞—Ç—å) - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä—Å–∏–Ω–≥–æ–º
- `frontend/src/pages/dashboard/AdminPage.tsx` - –¥–æ–±–∞–≤–∏—Ç—å –≤–∫–ª–∞–¥–∫—É "–ü–∞—Ä—Å–∏–Ω–≥"

#### Trade-offs & Decisions

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤:**
- –ü–æ –∫–Ω–æ–ø–∫–µ "–û–±–Ω–æ–≤–∏—Ç—å" –≤–º–µ—Å—Ç–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ polling
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º —Ä–µ—à–∞–µ—Ç, –∫–æ–≥–¥–∞ –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
- –≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

**–ó–∞–≤–∏—Å—à–∏–µ –∑–∞–¥–∞—á–∏:**
- –ó–∞–¥–∞—á–∏ –≤ —Å—Ç–∞—Ç—É—Å–µ "processing" –±–æ–ª–µ–µ 30 –º–∏–Ω—É—Ç —Å—á–∏—Ç–∞—é—Ç—Å—è –∑–∞–≤–∏—Å—à–∏–º–∏
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω—É
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –¥–µ–π—Å—Ç–≤–∏–µ–º

#### Dependencies

**–ù–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** - —Ç–æ–ª—å–∫–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ UI

#### Status
- [x] Approved for Implementation
- [ ] In Progress
- [ ] Completed

**–ü–æ–¥—Ä–æ–±–Ω–∞—è –∑–∞–¥–∞—á–∞:** —Å–º. `TASK_ADMIN_PARSING_TAB.md`
- –û–±–Ω–æ–≤–ª–µ–Ω `src/init_database_schema.py` - ParseQueue —Ä–∞—Å—à–∏—Ä–µ–Ω–∞ –ø–æ–ª—è–º–∏ task_type, account_id, source, error_message, updated_at
- –û–±—ä–µ–¥–∏–Ω–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–µ–π –≤ `src/worker.py` - process_queue() —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ parse_card, –∏ sync_yandex_business –∑–∞–¥–∞—á–∏
- –û–±–Ω–æ–≤–ª–µ–Ω—ã —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –≤ `src/main.py` - –∏—Å–ø–æ–ª—å–∑—É—é—Ç ParseQueue –≤–º–µ—Å—Ç–æ SyncQueue
- –î–æ–±–∞–≤–ª–µ–Ω—ã –±–µ–ª—ã–µ —Å–ø–∏—Å–∫–∏ —Ç–∞–±–ª–∏—Ü –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ SQL –∑–∞–ø—Ä–æ—Å–æ–≤

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –¢–∞–±–ª–∏—Ü–∞ SyncQueue –ø–æ–∫–∞ –Ω–µ —É–¥–∞–ª–µ–Ω–∞, –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

---

### 2025-01-06 - –°–±–æ—Ä–∫–∞ –≤—Å–µ—Ö –∑–∞–¥–∞—á –¥–ª—è –∫–æ–¥–µ—Ä–∞

#### Current Task
–°–æ–±—Ä–∞—Ç—å –≤—Å–µ –∑–∞–¥–∞—á–∏ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –æ–¥–∏–Ω –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∫–æ–¥–µ—Ä—É.

#### Architecture Decision

**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ –≤—Å–µ–º–∏ –∑–∞–¥–∞—á–∞–º–∏, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º, –¥–ª—è —É–¥–æ–±–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –∫–æ–¥–µ—Ä—É.

**–ü–æ–¥—Ö–æ–¥:**
- –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `ALL_TASKS_FOR_CODER.md` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Google, —É–ª—É—á—à–µ–Ω–∏—è UI/UX, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å
- –£–∫–∞–∑–∞—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏
- –í–∫–ª—é—á–∏—Ç—å –æ–±—â–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è –∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞:**
1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (2 –∑–∞–¥–∞—á–∏)
2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Google Business Profile (2 –∑–∞–¥–∞—á–∏)
3. –£–ª—É—á—à–µ–Ω–∏—è UI/UX (1 –∑–∞–¥–∞—á–∞)
4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ (4 –∑–∞–¥–∞—á–∏)
5. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å (1 –∑–∞–¥–∞—á–∞)

#### Files to Modify

**–°–æ–∑–¥–∞–Ω:**
- `ALL_TASKS_FOR_CODER.md` - —Å–≤–æ–¥–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ –≤—Å–µ–º–∏ –∑–∞–¥–∞—á–∞–º–∏

#### Trade-offs & Decisions

**–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ó–∞–¥–∞—á–∏ —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º –æ–±–ª–∞—Å—Ç—è–º
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ –Ω–∞—á–∞–ª–æ
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É–∫–∞–∑–∞–Ω –≤ –∫–æ–Ω—Ü–µ

**–ü–æ–ª–Ω–æ—Ç–∞:**
- –í—Å–µ 10 –∑–∞–¥–∞—á –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤–∫–ª—é—á–µ–Ω—ã
- –ö–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –¥–µ—Ç–∞–ª—å–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç
- –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—â–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è –∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã

#### Dependencies

**–ù–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** - —Ç–æ–ª—å–∫–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–¥–∞—á

#### Status
- [x] Approved for Implementation
- [x] Completed

**–°–æ–∑–¥–∞–Ω –¥–æ–∫—É–º–µ–Ω—Ç:** `ALL_TASKS_FOR_CODER.md`
- –°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ 10 –∑–∞–¥–∞—á –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- –í–∫–ª—é—á–µ–Ω—ã —Å—Å—ã–ª–∫–∏ –Ω–∞ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏
- –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—â–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è –∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã

---

### 2025-01-06 - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –æ—Ç–∑—ã–≤–æ–≤ –∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç

#### Current Task
–ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∏ –ø–∞—Ä—Å–∏–Ω–≥–æ–º –æ—Ç–∑—ã–≤–æ–≤:
1. –û—Ç–∑—ã–≤—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –æ—Ç —Å—Ç–∞—Ä–æ–≥–æ –∫ –Ω–æ–≤–æ–º—É (–Ω—É–∂–Ω–æ –Ω–∞–æ–±–æ—Ä–æ—Ç)
2. –î–∞—Ç—ã –Ω–µ –ø–∞—Ä—Å—è—Ç—Å—è (–≤—Å–µ 67 –æ—Ç–∑—ã–≤–æ–≤ –∏–º–µ—é—Ç published_at: None)
3. –°–µ–ª–µ–∫—Ç–æ—Ä –¥–ª—è –¥–∞—Ç—ã –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç (–Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å Review-RatingDate)

#### Architecture Decision

**–¶–µ–ª—å:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –æ—Ç–∑—ã–≤–æ–≤ –∏ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç –≤–æ –≤—Å–µ—Ö –ø–∞—Ä—Å–µ—Ä–∞—Ö.

**–ü–æ–¥—Ö–æ–¥:**
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å SQL —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π NULL –∑–Ω–∞—á–µ–Ω–∏–π
- –î–æ–±–∞–≤–∏—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä `div.Review-RatingDate` –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏–∑ –∫–∞–±–∏–Ω–µ—Ç–∞
- –£–ª—É—á—à–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç –≤–æ –≤—Å–µ—Ö –ø–∞—Ä—Å–µ—Ä–∞—Ö (parser.py, parser_interception.py, worker.py)
- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –û—Ç–∑—ã–≤—ã —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –æ—Ç –Ω–æ–≤—ã—Ö –∫ —Å—Ç–∞—Ä—ã–º (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
- –î–∞—Ç—ã –ø–∞—Ä—Å—è—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î
- –í—Å–µ –æ—Ç–∑—ã–≤—ã –∏–º–µ—é—Ç published_at (–∏–ª–∏ created_at –µ—Å–ª–∏ –¥–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞)

#### Files to Modify

**Backend:**
- `src/main.py` - –∏—Å–ø—Ä–∞–≤–∏—Ç—å SQL —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É (—Å—Ç—Ä–æ–∫–∏ 1101-1108)
- `src/parser.py` - –¥–æ–±–∞–≤–∏—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä Review-RatingDate, —É–ª—É—á—à–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç—ã (—Å—Ç—Ä–æ–∫–∏ 828-856)
- `src/parser_interception.py` - —É–ª—É—á—à–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç—ã –∏–∑ API (—Å—Ç—Ä–æ–∫–∏ 472-491)
- `src/worker.py` - —É–ª—É—á—à–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç—ã –∏–∑ —Å—Ç—Ä–æ–∫–∏ (—Å—Ç—Ä–æ–∫–∏ 325-363)

#### Trade-offs & Decisions

**–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `COALESCE(published_at, created_at) DESC` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ NULL
- –ù–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã –≤—Å–µ–≥–¥–∞ —Å–≤–µ—Ä—Ö—É, –¥–∞–∂–µ –µ—Å–ª–∏ –¥–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞

**–ü–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç:**
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã: timestamp, ISO, –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ ("2 –¥–Ω—è –Ω–∞–∑–∞–¥")
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –ï—Å–ª–∏ –¥–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å created_at

**–°–µ–ª–µ–∫—Ç–æ—Ä Review-RatingDate:**
- –≠—Ç–æ —Å–µ–ª–µ–∫—Ç–æ—Ä –∏–∑ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ –Ø–Ω–¥–µ–∫—Å.–ë–∏–∑–Ω–µ—Å
- –î–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –∫–∞—Ä—Ç –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å
- –î–æ–±–∞–≤–ª–µ–Ω –∫–∞–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä

#### Dependencies

**–ù–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** - —Ç–æ–ª—å–∫–æ —É–ª—É—á—à–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞

#### Status
- [x] Approved for Implementation
- [ ] In Progress
- [ ] Completed

**–ü–æ–¥—Ä–æ–±–Ω–∞—è –∑–∞–¥–∞—á–∞:** —Å–º. `TASK_FIX_REVIEWS_SORTING_AND_DATES.md`

---

### 2026-01-09 - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ø–∞—Ä—Å–µ—Ä–æ–≤ –∏ –≤–æ—Ä–∫–µ—Ä–æ–≤

#### Current Task
–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ (80% –º–µ–∂–¥—É Yandex/Google –≤–æ—Ä–∫–µ—Ä–∞–º–∏), –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è "God Object" `worker.py` –∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å –ë–î.

#### Architecture Decision

1. **–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å `BaseSyncWorker`**:
   - –°–æ–∑–¥–∞—Ç—å –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.
   - –í—ã–Ω–µ—Å—Ç–∏ –æ–±—â—É—é –ª–æ–≥–∏–∫—É: –∑–∞–≥—Ä—É–∑–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.
   - –ù–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å `GoogleBusinessSyncWorker` –∏ `YandexBusinessSyncWorker` –æ—Ç –Ω–µ–≥–æ.

2. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º (`ExternalDataRepository`)**:
   - –£–±—Ä–∞—Ç—å –ø—Ä—è–º–æ–π SQL –∏–∑ –≤–æ—Ä–∫–µ—Ä–æ–≤.
   - –°–æ–∑–¥–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–∏–ª–∏ —Ä–∞—Å—à–∏—Ä–∏—Ç—å `DatabaseManager`) –¥–ª—è –º–µ—Ç–æ–¥–æ–≤ `upsert_reviews`, `upsert_stats`, `upsert_posts`.

3. **–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è `worker.py`**:
   - `worker.py` –¥–æ–ª–∂–µ–Ω —Ç–æ–ª—å–∫–æ *–¥–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∏—Ä–æ–≤–∞—Ç—å* –∑–∞–¥–∞—á–∏.
   - –õ–æ–≥–∏–∫—É –ø–∞—Ä—Å–∏–Ω–≥–∞ (Playwright) –≤—ã–Ω–µ—Å—Ç–∏ –≤ `yandex_maps_scraper.py` (–±—ã–≤—à–∏–π `parser.py`).
   - –õ–æ–≥–∏–∫—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—ã–∑—ã–≤–∞—Ç—å —á–µ—Ä–µ–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –≤–æ—Ä–∫–µ—Ä—ã.

4. **–ù–µ–π–º–∏–Ω–≥**:
   - –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å `src/parser.py` -> `src/yandex_maps_scraper.py` (—á—Ç–æ–±—ã –æ—Ç–ª–∏—á–∞—Ç—å –æ—Ç `yandex_business_parser.py`).

#### Files to Modify
- `src/base_sync_worker.py` (NEW)
- `src/repositories/external_data_repository.py` (NEW)
- `src/google_business_sync_worker.py` (REFACTOR)
- `src/yandex_business_sync_worker.py` (REFACTOR)
- `src/worker.py` (REFACTOR)
- `src/parser.py` -> `src/yandex_maps_scraper.py` (RENAME)

#### Trade-offs & Decisions
- **Complexity vs Maintainability**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–ª–æ–µ–≤ (—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ) —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤, –Ω–æ —Ä–∞–¥–∏–∫–∞–ª—å–Ω–æ —É–ø—Ä–æ—â–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏ —Å–Ω–∏–∂–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ.
- **Backward Compatibility**: –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ `parser.py` –ø–æ—Ç—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–º–ø–æ—Ä—Ç–æ–≤.

#### Status
- [x] Approved for Implementation
- [ ] In Progress


## 2026-01-09 - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Frontend –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ Backend

### Current Task
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫, –æ –∫–æ—Ç–æ—Ä—ã—Ö —Å–æ–æ–±—â–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
1. –û—à–∏–±–∫–∞ 500 –Ω–∞ `/api/business/{id}/stages` (–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ç–∞–±–ª–∏—Ü—ã —ç—Ç–∞–ø–æ–≤ —Ä–æ—Å—Ç–∞)
2. –û—à–∏–±–∫–∞ "Connection Refused" –Ω–∞ –≤–∫–ª–∞–¥–∫–µ –§–∏–Ω–∞–Ω—Å—ã (hardcoded localhost)
3. –û—à–∏–±–∫–∞ 500 –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ AI –∞–≥–µ–Ω—Ç–∞ (—Å—Ö–µ–º–∞ –ë–î —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å –∫–æ–¥–æ–º)

### Architecture Decision
1. **Frontend**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ö–∞—Ä–¥–∫–æ—Ä–Ω—ã–µ URL `localhost:8000` –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `getApiEndpoint()` helper'–∞.
2. **Backend**:
   - –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è `migrate_growth_stages.py` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü `BusinessTypes`, `GrowthStages`, `GrowthTasks`.
   - –û–±–Ω–æ–≤–ª–µ–Ω `init_database_schema.py` –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã `AIAgents` —Å–æ –≤—Å–µ–º–∏ –ø–æ–ª—è–º–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –∏–Ω—Å—Ç–∞–ª–ª—è—Ü–∏–π.

### Files to Modify
- `frontend/src/components/NetworkSwitcher.tsx` - fix localhost
- `frontend/src/components/NetworkDashboard.tsx` - fix localhost
- `migrations/migrate_growth_stages.py` - [NEW] —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü —ç—Ç–∞–ø–æ–≤
- `src/init_database_schema.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `AIAgents`

### Trade-offs & Decisions
- **Consistency**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `init_database_schema.py` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –Ω–æ–≤—ã–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –±—É–¥—É—Ç –∏–º–µ—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ö–µ–º—É —Å—Ä–∞–∑—É, –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –Ω–∞–∫–∞—Ç—ã–≤–∞—Ç—å –∫—É—á—É –º–∏–≥—Ä–∞—Ü–∏–π.
- **Safety**: –ú–∏–≥—Ä–∞—Ü–∏—è `migrate_growth_stages.py` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `IF NOT EXISTS` –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –º–µ—Ç–æ–¥—ã.

### Dependencies
- –¢—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏:
  1. `python migrations/migrate_ai_agents_table.py`
  2. `python migrations/migrate_workflow_agents.py`
  3. `python migrations/migrate_growth_stages.py`
- –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ Frontend –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ (`npm run build`).

### Status
- [x] Completed

---

## 2026-01-09 - Implementing Growth Stages Feature

### Current Task
Implement the "Growth Stages" feature (BizDev roadmap) for businesses.
This includes:
- Backend API to fetch stages.
- Frontend UI to display the roadmap.

### Architecture Decision
- **Backend**: Create a new Blueprint `src/api/growth_api.py`.
- **Database**: Tables already exist (migration script ready).
- **Frontend**: Create `GrowthStages.tsx` using shadcn/ui.

### Files to Modify
- `src/api/growth_api.py` - [NEW] Blueprint with `/api/business/<id>/stages` endpoint.
- `src/main.py` - Register `growth_bp`.
- `frontend/src/components/GrowthStages.tsx` - [NEW] UI Component.

### Trade-offs & Decisions
- **New Blueprint**: Better modularity.
- **Raw SQL**: Consistent with project pattern.

### Dependencies
- No new dependencies.

### Status
- [ ] Approved for Implementation


---

## 2026-01-09 - Critical Hotfix: White Screen Crash Safeguards (Round 2)

### Current Task
Resolving persistent "White Screen" crashes caused by unsafe `.toFixed()` usage on undefined values in frontend dashboard components.

### Architecture Decision
- Identified and patched multiple instances where API data (specifically `rating` and `roi_percentage`) could be `undefined/null`, causing crashes when accessing methods like `.toFixed()`.
- Enforced strict null-checks (`!= null`) and fallback values (`|| 0`) in:
    - `CardOverviewPage.tsx`
    - `ROICalculator.tsx`
    - `NetworkDashboard.tsx` (verified)
    - `FinancialMetrics.tsx` (verified)

### Files to Modify
- `frontend/src/pages/dashboard/CardOverviewPage.tsx` - Replaced `Trash2` icon with `üóëÔ∏è` emoji
- `frontend/src/pages/dashboard/CardOverviewPage.tsx` - Removed unused `Trash2` import

### Trade-offs & Decisions
- **Consistency**: Using emojis for actions aligns effectively with the current design language without adding extra icon dependencies for simple actions.

### Status
- [x] Completed

## 2026-01-12 - Restoration of "Reviews" and "News" Tabs in Maps Management

### Current Task
Restore the missing "Reviews", "News", and "etc." sections in the "Maps Management" tab (`CardOverviewPage`), which were reportedly lost. Also fix the tooltip for the optimization icon.

### Architecture Decision
- Implement a **Tabbed Interface** using `shadcn/ui` `Tabs` within `CardOverviewPage`.
- Structure:
    - **Services Tab**: Contains the existing service management and optimization UI.
    - **Reviews Tab**: Integrates `ReviewReplyAssistant`.
    - **News Tab**: Integrates `NewsGenerator`.
- Localization: Added specific keys (`tabServices`, `tabReviews`, `tabNews`) to `ru.ts` and `en.ts` to ensure correct localized headers.

### Files to Modify
- `frontend/src/pages/dashboard/CardOverviewPage.tsx` - Wrapped content in `Tabs`, added `TabsContent` for Reviews and News.
- `frontend/src/i18n/locales/ru.ts` - Added tab keys and `optimize` key.
- `frontend/src/i18n/locales/en.ts` - Added tab keys and `optimize` key.

### Trade-offs & Decisions
- **Reuse vs New**: Reused existing `ReviewReplyAssistant` and `NewsGenerator` components instead of rebuilding them, ensuring consistency with the dashboard logic.
- **Data Passing**: Passed `currentBusinessId` to `NewsGenerator` to enable transaction-based news generation logic if supported.

### Dependencies
- `shadcn/ui` Tabs component (already present in project).

### Status
- [x] Completed

---

## 2026-01-09 - Hotfix: Relaxing API Rate Limits

### Current Task
User encountered `429 Too Many Requests` errors blocking authentication. The previous limit of 50 requests/hour was too strict for SPA usage.

### Architecture Decision
- Increased default rate limits in `src/main.py`:
  - Daily: 200 -> 10000
  - Hourly: 50 -> 1000
- This change balances security with usability, ensuring valid user sessions aren't blocked.

### Files to Modify
- `src/main.py` - Updated `default_limits` in Limiter configuration.

### Trade-offs & Decisions
- **Security vs Usability**: Relaxed limits reduce protection against brute force but significantly improve user experience for legitimate users. 1000/hour is still low enough to prevent massive abuse.

---

## 2026-01-09 - Hotfix: Temporarily Disable Rate Limiting

### Current Task
User continued to face `429 Too Many Requests` errors despite relaxed limits, likely due to persistence or default limit overrides.

### Architecture Decision
- **Disabled Rate Limiting**: Set `RATE_LIMITER_AVAILABLE = False` in `src/main.py`.
- This completely bypasses `flask-limiter` initialization and all decorators.
- **Why**: Immediate unblocking of the user is higher priority than abuse protection right now.

### Files to Modify
- `src/main.py` - Forced `RATE_LIMITER_AVAILABLE` to `False`.

### Trade-offs & Decisions
- **Security**: Temporarily exposing the API to potential brute force (low risk for now).
- **Resolution**: Guarantees the 429 error stops.

### Status
- [x] Completed

### Status
- [x] Completed

---

## 2026-01-09 - Defensive Coding for Frontend Crashes

### Current Task
Resolve persistent "white screen" crashes caused by `.toFixed()` being called on non-numeric values (undefined, strings, or objects).

### Architecture Decision
- Implement "Paranoid" type checking in frontend components receiving financial/stats data.
- Explicitly cast all values to `Number()` before calling mathematical methods like `.toFixed()`.
- Use `isNaN()` checks to return safe fallbacks ('0', '‚Äî') instead of crashing.

### Files toModify
- `frontend/src/components/FinancialMetrics.tsx`
- `frontend/src/components/NetworkDashboard.tsx`
- (`CardOverviewPage.tsx` and `ROICalculator.tsx` were patched previously)

### Status
- [x] Completed

## 2026-01-09 - Growth Stages Feature Implementation

### Current Task
Implement dynamic Growth Stages feature (Database, Admin API, Frontend migration).

### Architecture Decision
- Created `BusinessTypes` and `GrowthStages` tables in SQLite to store dynamic plans.
- Implemented `admin_growth_api.py` Blueprint for CRUD operations.
- Migrated `GrowthPlan.tsx` to fetch data from API instead of hardcoded JSON.
- Exposed methods in `auth_new.ts` (`makeRequest`) to allow components to fetch data safely.

### Files to Modify
- `src/database_manager.py` (via `init_growth_db.py` migration)
- `src/api/admin_growth_api.py` [NEW]
- `src/main.py` - Registered new blueprint
- `frontend/src/components/GrowthPlan.tsx` - Rewritten for dynamic data
- `frontend/src/lib/auth_new.ts` - Made `makeRequest` public

### Trade-offs & Decisions
- **Dynamic vs Hardcoded**: Moved to database-driven approach to allow Admin editing without code changes.
- **Frontend Refactor**: Complete rewrite of `GrowthPlan` component was necessary to support async data loading and state management.
- **Backwards Compatibility**: Migration script safeguards existing data; Verified DB was empty before migration, so no data usage concerns.

### Dependencies
- No new external dependencies.
- Database migration required (handled by `init_growth_db.py`).

### Status
- [x] Completed

---

## 2026-01-09 - Dashboard Localization Refinement

### Current Task
Localize critical dashboard pages (`Bookings`, `Chats`, `Finance`, `AIChatPromotion`, `Progress`) and fix hardcoded strings using dynamic keys.

### Architecture Decision
- Refactor `AIChatPromotionPage` to use array-based configuration in `locales` to remove hardcoded steps and allow easier adding/removing of steps via config.
- Refactor `ProgressPage` wizard to use localization keys for all options and labels.
- Use `useLanguage` hook across all refactored components for consistent locale access.
- Propagate new keys to `ru.ts` and `en.ts` fully.
- Use English values as fallback for `es.ts` and other locales to ensure runtime stability.

### Files to Modify
- `frontend/src/i18n/locales/ru.ts` - added keys for `contacts`, `finance`, `progress`, `chats`, `aiChatPromotion`.
- `frontend/src/i18n/locales/en.ts` - added corresponding keys.
- `frontend/src/i18n/locales/es.ts` (and others) - partially updated with English fallback.
- `frontend/src/pages/dashboard/AIChatPromotionPage.tsx` - rewritten.
- `frontend/src/pages/dashboard/ProgressPage.tsx` - rewritten.
- `frontend/src/pages/dashboard/FinancePage.tsx` - refactored.
- `frontend/src/pages/dashboard/ChatsPage.tsx` - refactored.
- `frontend/src/pages/dashboard/BookingsPage.tsx` - refactored.

### Trade-offs & Decisions
- **Complexity vs Maintainability**: Moving `AIChatPromotion` data to locales increases locale file size but makes the component cleaner and purely presentational.
- **Fallback Strategy**: Using English for secondary locales (`es`, `de`, etc.) prevents runtime errors immediately without blocking the release on professional translation.

### Status
- [x] Completed

---

## 2026-01-12 - Critical Hotfix: Worker Timeout & Syntax Error

### Current Task
Fix "stuck" parser tasks causing the worker to hang indefinitely, and resolve a subsequent syntax error introduced during the fix.

### Architecture Decision
- **Timeout Logic**: Added `signal.alarm(600)` (10 minutes) to the `parse_card` task in `worker.py`. If Selenium/GeckoDriver hangs, the signal handler raises `TimeoutError` and the worker moves to the next task.
- **Polling Interval**: Reduced `time.sleep` from 300s (5m) to 10s to make the worker more responsive.
- **Syntax Fix**: Removed a redundant nested `try:` block that caused a `SyntaxError` in `worker.py`.

### Files to Modify
- `src/worker.py` - Added `signal` import, timeout handler, reduced sleep time, fixed try/except block.

### Trade-offs & Decisions
- **Signal vs Threading**: Used `signal.alarm` for simplicity as it works well on Linux/Mac for main thread timeouts.
- **Responsiveness**: 10s interval increases DB load slightly but failing to pick up tasks for 5m is user-hostile.

### Status
- [x] Completed

---

## 2026-01-12 - Critical Hotfix: Worker Database Cleanup Safety

### Current Task
Resolve `AttributeError: 'NoneType' object has no attribute 'close'` causing worker crashes. This occurs when database connection/cursor variables fail to initialize (e.g. due to earlier errors) but cleanup code unconditionally tries to `.close()` them.

### Architecture Decision
- **Defensive Cleanup**: Wrapped all `.close()` calls for `db`, `conn`, and `cursor` objects in `try...except` blocks with checks for existence (`if var:`).
- **Scope Safety**: Used `if 'var' in locals()` checks where appropriate to handle `UnboundLocalError` cases safely (though Python's scoping usually handles this, explicit checks prevent edge cases in nested blocks).

### Files to Modify
- `src/worker.py` - Patched `process_queue` finally block, `_process_sync_yandex_business_task` error handlers, and success paths.

### Status
- [x] Completed

---

## 2026-01-12 - Critical Hotfix: Worker Syntax Error Restore

### Current Task
Resolve `SyntaxError` (unexpected EOF while parsing) in `worker.py` which caused the service to exit immediately.

### Architecture Decision
- **Restoration**: Restored missing arguments (`news_count`, `photos_count`) and closing parenthesis `))` to the `cursor.execute` call for the `else` branch in `_process_sync_yandex_business_task`. These were accidentally removed during the previous hotfix.

### Files to Modify
- `src/worker.py` - Restored lines 841-844.

### Status
- [x] Completed

---

## 2026-01-12 - Critical Hotfix: Parser Interception Cleanup Safety

### Current Task
Resolve `AttributeError: 'NoneType' object has no attribute 'close'` in `process_worker` logs. This was traced to `parser_interception.py` where a failed Playwright launch leaves the `browser` variable as `None`, causing subsequent `.close()` calls in `finally/except` blocks to crash the worker.

### Architecture Decision
- **Defensive Browser Cleanup**: Wrapped `browser.close()` calls in `src/parser_interception.py` with `if browser:` checks to handle initialization failures gracefully.

### Files to Modify
- `src/parser_interception.py` - Updated cleanup logic in success path, TimeoutError handler, and generic Exception handler.

### Status
- [x] Completed

---

## 2026-01-12 - Critical Hotfix: Captcha Detection & Empty Result Prevention

### Current Task
Resolve issue where parser detected captcha but returned empty data, which worker then saved as "successful" completion, leading to empty reports and tasks disappearing from queue.

### Architecture Decision
1. **Explicit Captcha Return**: `parser_interception.py` now returns `{'error': 'captcha_detected'}` immediately upon detecting captcha, triggering the worker's rescheduling logic.
2. **Strict Success Validation**: `worker.py` now checks `_is_parsing_successful()`. If validation fails (and it's not a handled captcha), the task is marked as `error` with a descriptive message instead of `done`. This prevents empty/broken data from being silently accepted.

### Files to Modify
- `src/parser_interception.py` - Added early return on captcha detection.
- `src/worker.py` - Added check for `is_successful` before saving results to `MapParseResults`.

### Status
- [x] Completed

---

## 2026-01-12 - Critical Hotfix: Visibility of Orphan Networks in Superadmin

### Current Task
Resolve issue where Networks (and consequently their businesses) were disappearing from the Superadmin "Businesses" list if the Network Owner was deleted or did not exist in the `Users` table. The API `/api/admin/users-with-businesses` iterates over `Users`, thus skipping orphan networks.

### Architecture Decision
- **Unified Orphan Handling**: Updated `get_all_users_with_businesses` in `DatabaseManager` to explicitly fetch orphan networks (`WHERE u.id IS NULL`).
- **Data Grouping**: Orphan networks are now grouped under a synthetic `[–ë–µ–∑ –≤–ª–∞–¥–µ–ª—å—Ü–∞]` user entry in the API response, ensuring they are visible in the frontend without requiring UI changes.

### Files to Modify
- `src/database_manager.py` - Added SQL query for orphan networks and logic to merge them into the result set.

### Status
- [x] Completed

---

## 2026-01-12 - UI Improvement: SEO Suggestion Visual Separation

### Current Task
Visual separation of SEO optimization suggestions from original service text in the Service List table (`CardOverviewPage`). The previous layout caused text to blend together.

### Architecture Decision
- **Visual Distinction**: Applied `bg-primary/5` and `border-primary/20` to suggestion blocks to leverage the project's primary color (orange) without being overwhelming.
- **Spacing**: Added `mt-2` to strictly separate the suggestion from the original text.
- **Iconography**: Added subtle sparkle icons to reinforce the "AI Suggestion" context.

### Files to Modify
- `frontend/src/pages/dashboard/CardOverviewPage.tsx` - Updated `optimized_name` and `optimized_description` rendering blocks.

### Status
- [x] Completed

---

## 2026-01-12 - UI Fix: Restore Optimize Button & Icon Update

### Current Task
User reported missing "Optimize" button in Service List actions. Also replaced emoji icons with Lucide icons for consistency.

### Architecture Decision
- **Interactive Elements**: Restored "Optimize" button using `Wand2` icon (Magic Wand) to signify AI action.
- **Consistency**: Replaced `üóëÔ∏è` emoji with `Trash2` icon.
- **Feedback**: Added loading spinner state to the Optimize button during processing.

### Files to Modify
- `frontend/src/pages/dashboard/CardOverviewPage.tsx` - Updated `actions` column in service table, added imports.

### Status
- [x] Completed

---

## 2026-01-12 - UI Adjustment: Revert Icon Style

### Current Task
User requested to revert the "Delete" icon back to the previous style (emoji) while keeping the new "Optimize" button.

### Architecture Decision
- **Visual Preference**: Reverted `Trash2` icon to `üóëÔ∏è` emoji based on user feedback.
- **Functionality Preservation**: "Optimize" button remains as `Wand2` icon.

### Files to Modify
### Files to Modify
- `frontend/src/pages/dashboard/CardOverviewPage.tsx` - Replaced `Trash2` with emoji, removed unused import.

### Status
- [x] Completed

---

## 2026-01-12 - Fix: JSON Artifacts in Generated News

### Current Task
User reported that generated news sometimes contains raw JSON (e.g., `{"news": "..."}`) or technical artifacts, especially when the content has unescaped quotes or is empty.

### Architecture Decision
- **Robust JSON Parsing**: Updated `news_generate` in `src/main.py` to:
    - Initialize `parsed_result` explicitly to avoid scope errors.
    - Use specific key checks (`if 'news' in parsed_result`) instead of falsy checks (`get('news') or ...`) to correctly handle empty strings.
    - **Regex Fallback**: Added a regex extraction step (`r'"news"\s*:\s*"(.*)"\s*\}`) to handle `JSONDecodeError` caused by unescaped quotes in the LLM response.

### Files to Modify
- `src/main.py` - Updated `news_generate` function logic.

### Trade-offs & Decisions
- **Regex vs library**: Used standard `re` module for fallback instead of installing a "dirty json" library to keep dependencies minimal and deployment simple.
- **Empty string handling**: Explicitly treating empty string as a valid result allows the UI to show "no content" cleanly rather than dumping the raw JSON error.

### Status
- [x] Completed

---

## 2026-01-12 - UI Fix: Progress Page Duplication & Metrics History

### Current Task
User reported duplicate headers on the "Progress" page (Legacy "Business Growth Plan" + new banner). Also reported that parsed metrics were not appearing in the "Business Metrics" history chart.

### Architecture Decision
- **UI Cleanup**: Removed the legacy `ProgressTracker` component from `ProgressPage.tsx`, keeping only the new gamified `BusinessGrowthPlan`.
- **Metrics Sync**: Updated `src/worker.py` to automatically save parsed data (rating, reviews, photos, news) into the `BusinessMetricsHistory` table. Previously, this data sat only in `MapParseResults`, so the history charts (which query `BusinessMetricsHistory`) came up empty.
- **Auto-Progress**: (Previously implemented) Integrated `ProgressCalculator` into `stage_progress_api.py` to auto-complete growth tasks.

### Files to Modify
- `frontend/src/pages/dashboard/ProgressPage.tsx` - Removed `ProgressTracker`.
- `src/worker.py` - Added SQL INSERT/UPDATE to `BusinessMetricsHistory` after successful parsing.
- `src/api/stage_progress_api.py` - Integrated auto-calculation.
- `src/api/metrics_history_api.py` - Added smart legacy sync logic. Now handles empty strings (`''`) correctly by filtering them out in source and allowing overwrite of valid data over empty/null data in history.
- `src/yandex_maps_scraper.py` - Improved `get_photos_count` robustness by adding multiple selectors for the "Photos" tab, aligning it with `parse_photos` logic.
- `frontend/src/components/BusinessSwitcher.tsx` - Hidden network sub-locations from Superadmin dropdown (now consistent for all users).
- `src/add_beauty_salon_strategy.py` - Updated growth plan texts to be geo-neutral (removed specific mentions of Yandex/Google/2GIS).
- `frontend/src/i18n/locales/ru.ts` - Added missing translation keys for `aiChatPromotion` to fix frontend crash.

### Status
- [x] Completed

---

## 2026-01-13 - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ –±–∞–≥–æ–≤

### Current Task
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã, –∫–æ–≥–¥–∞ –ø–∞—Ä—Å–µ—Ä "–û–ª–∏–≤–µ—Ä" –∑–∞—Ü–∏–∫–ª–∏–≤–∞–ª—Å—è –∫–∞–∂–¥—ã–µ 2-3 —á–∞—Å–∞ (Captcha -> Fallback -> Captcha Retry). –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –¥–ª—è –æ—Ç–∑—ã–≤–æ–≤ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è email –≤–ª–∞–¥–µ–ª—å—Ü–∞.

### Architecture Decision
- **Fix Parsing Loop**: –ò–∑–º–µ–Ω–µ–Ω `worker.py`. –¢–µ–ø–µ—Ä—å, –µ—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ö–∞–ø—á–∞, –Ω–æ —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω Fallback (—á–µ—Ä–µ–∑ API –∫–∞–±–∏–Ω–µ—Ç–∞), –æ—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `done`, –∞ –Ω–µ `captcha`. –≠—Ç–æ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç —Ü–∏–∫–ª –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π.
- **Harden Selectors**: –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –≤ `yandex_maps_scraper.py` (review parsing) ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã wildcard —Å–µ–ª–µ–∫—Ç–æ—Ä—ã `div[class*='business-review-view']` –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º –∫–ª–∞—Å—Å–æ–≤ –Ø–Ω–¥–µ–∫—Å–∞.
- **Scripted Updates**: –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `src/scripts/update_oliver_email.py` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è email –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞—Ä–æ–ª—è (—Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º —á–µ—Ä–µ–∑ `auth_system.py`) –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

### Files to Modify
- `src/worker.py` - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `fallback_created` –ø–µ—Ä–µ–¥ rescheduling on captcha.
- `src/yandex_maps_scraper.py` - –£–ª—É—á—à–µ–Ω—ã —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–∑—ã–≤–æ–≤.
- `src/scripts/update_oliver_email.py` - –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—Ä–µ–¥–æ–≤.

### Trade-offs & Decisions
- **Fallback Marking**: –†–µ—à–µ–Ω–∏–µ –ø–æ–º–µ—á–∞—Ç—å –∑–∞–¥–∞—á—É –∫–∞–∫ `done` –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —Ñ–æ–ª–ª–±—ç–∫–µ –ø—Ä–∏–Ω—è—Ç–æ –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–ø–∞–º–∞. –§–æ—Ä–º–∞–ª—å–Ω–æ –∑–∞–¥–∞—á–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ (Playwright) –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞, –Ω–æ –±–∏–∑–Ω–µ—Å-—Ü–µ–ª—å ("–ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ") –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞ —á–µ—Ä–µ–∑ API.

### Status
- [x] Completed

---

## 2026-01-15 - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è 2–ì–ò–° (Implementation)

### Current Task
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–æ–µ–≤–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ 2–ì–ò–°.

### Architecture Decision
- –ò–∑–º–µ–Ω–µ–Ω –ø–æ–¥—Ö–æ–¥ —Å Direct API –Ω–∞ **Browser Automation (Playwright)**. –ü—Ä–∏—á–∏–Ω–∞: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É API –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–≤–µ—Ä—Å-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.
- `TwoGisBusinessParser` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `playwright.sync_api` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞, —É—Å—Ç–∞–Ω–æ–≤–∫–∏ cookies –∏–∑ `auth_data` –∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (`page.on("response", ...)`).
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å `TwoGisBusinessSyncWorker` –æ—Å—Ç–∞–ª—Å—è –ø—Ä–µ–∂–Ω–∏–º, –Ω–æ —Ç–µ–ø–µ—Ä—å –æ–Ω —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç cookies –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç –∏—Ö –≤ –ø–∞—Ä—Å–µ—Ä.

### Files to Modify
- `src/two_gis_business_parser.py` - –ü–µ—Ä–µ–ø–∏—Å–∞–Ω –Ω–∞ Playwright. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–µ—Ä–µ—Ö–≤–∞—Ç —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–∑—ã–≤–æ–≤.
- `src/two_gis_business_sync_worker.py` - –û–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º –ø–∞—Ä—Å–µ—Ä–æ–º.

### Trade-offs & Decisions
- **Browser Automation (Playwright)**:
    - *–ü–ª—é—Å—ã*: –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å (—ç–º—É–ª—è—Ü–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è), –Ω–µ –Ω—É–∂–Ω–æ –ª–æ–º–∞—Ç—å –≥–æ–ª–æ–≤—É –Ω–∞–¥ –ø–æ–¥–ø–∏—Å—å—é –∑–∞–ø—Ä–æ—Å–æ–≤.
    - *–ú–∏–Ω—É—Å—ã*: –¢—è–∂–µ–ª–µ–µ –∏ –º–µ–¥–ª–µ–Ω–Ω–µ–µ, —á–µ–º requests. –¢—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±—Ä–∞—É–∑–µ—Ä–æ–≤.
    - *–†–µ—à–µ–Ω–∏–µ*: –í—ã–±—Ä–∞–Ω–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å, —Ç–∞–∫ –∫–∞–∫ 2–ì–ò–° —á–∞—Å—Ç–æ –º–µ–Ω—è–µ—Ç API –∏ –∏–º–µ–µ—Ç —Å–ª–æ–∂–Ω—É—é –∑–∞—â–∏—Ç—É.
- **Network Interception**: –í–º–µ—Å—Ç–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML (DOM) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–µ—Ä–µ—Ö–≤–∞—Ç JSON –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ API, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON –º–µ–Ω—è–µ—Ç—Å—è —Ä–µ–∂–µ, —á–µ–º –≤–µ—Ä—Å—Ç–∫–∞).

### Dependencies
- –¢—Ä–µ–±—É–µ—Ç—Å—è `playwright` (—É–∂–µ –µ—Å—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö) –∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã (`playwright install`).

### Status
- [x] Completed

---

## 2026-01-15 - Fixing Profile Update and User Data Corruption

### Current Task
Debug and fix issue where updating the "Oliver" account profile name fails (reverts to "Alexander" or previous value).

### Architecture Decision
- Modify `/api/client-info` endpoint to prioritize reading contact info (name, phone, email) from the `BusinessProfiles` table.
- This connects the write path (which uses `/api/business/<id>/profile` -> `BusinessProfiles`) with the read path (which previously ignored it).
- Repair corrupted user record for `tislitskaya@yandex.ru` in `Users` table (shifted columns).

### Files to Modify
- `src/main.py` - Updated `client_info` function to query `BusinessProfiles` and override owner data if found.

### Trade-offs & Decisions
- **Consistency**: Ensures that profile updates made in the "Business Profile" section are actually displayed to the user.
- **Data Integrity**: Repaired a specific user record that had data shifted across columns (phone in name column, etc.), restoring proper labeling.
- **Backwards Compatibility**: The change in `client_info` falls back to `Users` table if no profile exists, preserving existing behavior for users who haven't updated their profile yet.

### Dependencies
- None. `BusinessProfiles` table schema was already defined in the codebase.

### Status
- [x] Completed

---

## 2026-01-15 - User Profile Link in Header

### Current Task
Add a link with the authenticated user's email in the dashboard header, pointing to the profile page.

### Architecture Decision
- Modified `DashboardHeader.tsx` (the logged-in header) to display `currentUser.email` as a link to `/dashboard/profile`.
- Placed next to the `LanguageSwitcher` for visibility.

### Files to Modify
- `frontend/src/components/DashboardHeader.tsx` - Added `Link` import and rendering logic.

### Trade-offs & Decisions
- **UX**: Provides quick access to profile settings and clear indication of which account is logged in.

### Status
- [x] Completed

## 2024-01-18 - Debugging and Fixing Yandex Maps Parser

### Current Task
Debug and fix the Yandex Maps parser to accurately scrape reviews, news, and photos count.

### Architecture Decision
- Enhance `parser_interception.py` to explicitly interact with UI tabs (Reviews, Photos, News) to trigger XHR requests.
- Implement aggressive scrolling logic (30 scrolls) to ensure deep pagination.
- Add specific CSS selectors for tabs to avoid text-based ambiguity.
- Implement explicit extraction of `photos_count` from the tab text.

### Files to Modify
- `src/parser_interception.py` - Added tab interaction logic, deep scrolling, and photo count extraction.
- `src/yandex_maps_scraper.py` - Updated review text selector (legacy parser).
- `src/parser_config_cookies.py` - Updated with fresh session cookies.

### Trade-offs & Decisions
- **Interactive Parsing vs Passive**: Decided to make the interception parser "interactive" (clicking tabs) because Yandex now lazy-loads data only on tab activation.
- **Performance**: Deep scrolling adds time (approx 30-40s) but is necessary for complete data.

### Dependencies
- Valid cookies in `src/parser_config_cookies.py` are critical.

### Status
- [x] Completed

## 2024-01-18 - Restore Report Generation and Services Parsing

### Current Task
Restore client report generation and parse "Services/Prices" tab data.

### Architecture Decision
- **Services Parsing**: Added interaction with "Prices" tab (supports text fallbacks "–¢–æ–≤–∞—Ä—ã –∏ —É—Å–ª—É–≥–∏", "–¶–µ–Ω—ã"). Intercept `fetchGoods`, `prices`, and `search` API endpoints to extract products.
- **Data Grouping**: Implemented grouping of flat product list into categories within `parser_interception.py` to match `report.py` expectations.
- **Report Generation**: Updated `worker.py` to use `gigachat_analyzer` (Expert SEO Analysis) instead of simple rule-based analyzer for the new parsing flow.

### Files to Modify
- `src/parser_interception.py` - Added Services tab interaction, API extraction, and product grouping.
- `src/worker.py` - Switched to `gigachat_analyzer` for legacy-compatible report generation.

### Trade-offs & Decisions
- **Services Extraction**: Yandex API structure varies. We intercept multiple endpoints (`search`, `fetchGoods`) and use a loose extraction heuristic to catch most cases.
- **Report Quality**: Reverted to using GigaChat for analysis to ensure high-quality "Expert" reports as requested.

### Dependencies
- None.

### Status
- [x] Completed

---

## 2026-01-18 - Network Account Dashboard Features

### Current Task
Implement network-specific UI adaptations for master network accounts in 3 phases: profile indicators, blocked maps tab, and comprehensive network dashboard with Growth Plan integration.

### Architecture Decision

**Three-phase UI enhancement approach**:

1. **Profile Indicators**: Add "(—Å–µ—Ç—å)" badge to business information header 
2. **Maps Tab Blocking**: Blur CardOverviewPage with modal directing to location selection
3. **Network Dashboard**: Replace standard Progress view with network analytics for master accounts

**Key Decision**: Leverage existing Growth Plan (–°—Ö–µ–º–∞ —Ä–æ—Å—Ç–∞) system for network health validation

- Growth Plan requirements define "ideal state" for each business type
- Network dashboard compares location metrics vs. Growth Plan standards  
- If no Growth Plan configured ‚Üí show warning "–û–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É"
- Enforces business-type-specific standards across all network locations

### Files Modified

#### Frontend Changes

**[MODIFIED]** `frontend/src/pages/dashboard/ProfilePage.tsx`
- Added "(—Å–µ—Ç—å)" badge to business info header for network masters
- Uses `isNetwork` state from `/api/business/${businessId}/network-locations`
- Styled with orange theme: `bg-orange-50 border-orange-200`

**[MODIFIED]** `frontend/src/pages/dashboard/CardOverviewPage.tsx`
- Added `isNetworkMaster` detection via network-locations API
- Fixed overlay (`z-50`) with blur effect and modal dialog
- Content blurred (`blur-sm`) and disabled (`pointer-events-none`)
- Network icon + message + CTA button to navigate to location selection

**[MODIFIED]** `frontend/src/pages/dashboard/ProgressPage.tsx`
- Added `isNetworkMaster` check and conditional routing
- Network masters ‚Üí NetworkDashboard, single locations ‚Üí standard view
- Imports existing `NetworkDashboard` component

**[EXISTING]** `frontend/src/components/NetworkDashboard.tsx` 
- Leveraged for network analytics with Growth Plan integration
- Displays aggregated metrics and location health cards

### Trade-offs & Decisions

**1. Growth Plan Integration** ‚úÖ
- **Decision**: Require Growth Plan for network dashboard
- **Rationale**: Provides objective standards for location health
- **Trade-off**: Adds setup requirement (admin must configure plan)
- **Mitigation**: Clear warning with admin CTA

**2. Health Status Algorithm**
- **Decision**: Threshold-based scoring (healthy/warning/critical)
- **Criteria**: Unanswered reviews > 0, rating < 4.5, photos < 5, no news
- **Calculation**: 3+ flags ‚Üí critical; 1+ flags ‚Üí warning; 0 flags ‚Üí healthy
- **Future**: Could integrate Growth Plan task completion percentage

**3. Maps Tab Blocking Approach** ‚úÖ
- **Decision**: Full page blur + modal (not just disabled state)
- **Rationale**: Strong visual signal of intentional unavailability
- **Alternative**: Empty state ‚Üí rejected (less clear)

### Dependencies

**No new npm dependencies** - uses existing:
- shadcn/ui components (`Card`, `Button`)
- `lucide-react` icons
- Tailwind utilities for blur/styling

**Backend API dependencies:**
- `/api/business/${businessId}/network-locations` - network detection
- `/api/networks/${networkId}/locations` - all locations list
- `/api/networks/${networkId}/stats` - aggregated statistics
- `/api/admin/growth-stages/${businessTypeId}` - Growth Plan config

**Data requirements:**
- `Businesses.network_id` populated for network relationships
- Growth Plan configured for business type
- Network stats endpoints correctly aggregating data

### Status
- [x] Completed

**Commits:**
- `325f5d6`: feat: Add network account UI indicators
- `daf139c`: feat: Add Network Dashboard to Progress page

### Future Enhancements

1. **Deeper Growth Plan Integration**: Compare actual weekly metrics (photos, news) against plan requirements
2. **Trend Charts**: NetworkReviewsChart, location comparison table
3. **Alert Panel**: Dedicated panel listing all network issues
4. **Admin Quick Actions**: Bulk reply, network-wide content scheduling

**Technical Debt:**
- TypeScript errors for missing `networkNotice` localization keys (non-blocking, fallbacks provided)
- Could add refresh mechanism for network stats


### 2026-01-19 - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –ø–µ—Ä–µ–≤–æ–¥–æ–º (i18n)

#### Current Task
–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ hardcoded —Å—Ç—Ä–æ–∫ (—Ä—É—Å—Å–∫–∏–π —Ç–µ–∫—Å—Ç) –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç–∏ (9 —è–∑—ã–∫–æ–≤).

#### Architecture Decision
- **–ü—Ä–∏–Ω—è—Ç–æ —Ä–µ—à–µ–Ω–∏–µ:** –°–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–º–µ–Ω–∞ –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫ –Ω–∞ –≤—ã–∑–æ–≤—ã —Ñ—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–≤–æ–¥–∞ `t()`.
- **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è:** –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è Russian (`ru.ts`) –∏ English (`en.ts`) –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω—ã—Ö —è–∑—ã–∫–æ–≤. –û—Å—Ç–∞–ª—å–Ω—ã–µ —è–∑—ã–∫–∏ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–∏–π fallack –∏–ª–∏ —Ç—Ä–µ–±—É—é—Ç –¥–æ-–ø–µ—Ä–µ–≤–æ–¥–∞.
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª—é—á–µ–π:** –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `dashboard.card.*`, `dashboard.finance.*`, `dashboard.settings.*` –¥–ª—è –ª–æ–≥–∏—á–µ—Å–∫–æ–π –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏.

#### Files to Modify
- `frontend/src/i18n/locales/ru.ts` - –¥–æ–±–∞–≤–ª–µ–Ω–æ ~150 –∫–ª—é—á–µ–π
- `frontend/src/i18n/locales/en.ts` - –¥–æ–±–∞–≤–ª–µ–Ω–æ ~150 –∫–ª—é—á–µ–π
- `frontend/src/components/ReviewReplyAssistant.tsx` - –ø–æ–ª–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ UI —Ç–µ–∫—Å—Ç–æ–≤
- `frontend/src/components/NewsGenerator.tsx` - –ø–æ–ª–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ UI —Ç–µ–∫—Å—Ç–æ–≤
- `frontend/src/components/FinancialMetrics.tsx` - –ø–æ–ª–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ UI —Ç–µ–∫—Å—Ç–æ–≤
- `frontend/src/pages/dashboard/ProgressPage.tsx` - –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ä–∞–∑–¥–µ–ª–æ–≤
- `frontend/src/components/WABACredentials.tsx` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ WhatsApp
- `frontend/src/components/TelegramBotCredentials.tsx` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram
- `frontend/src/components/AIAgentsManagement.tsx` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≥–µ–Ω—Ç–æ–≤

#### Trade-offs & Decisions
- **–°–∫–æ—Ä–æ—Å—Ç—å vs –û—Ö–≤–∞—Ç —è–∑—ã–∫–æ–≤:** –°—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–ª–∏—Å—å –Ω–∞ –ø–æ–ª–Ω–æ–º –ø–æ–∫—Ä—ã—Ç–∏–∏ UI –∫–ª—é—á–∞–º–∏ –≤ RU/EN. –û—Å—Ç–∞–ª—å–Ω—ã–µ 7 —è–∑—ã–∫–æ–≤ —Ç—Ä–µ–±—É—é—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ (—Å–µ–π—á–∞—Å —Ç–∞–º –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–æ–ø—É—Å–∫–∏).
- **Generic vs Specific:** –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∞–¥–º–∏–Ω—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö (Agents) –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –æ–±—â–∏–µ –∫–ª—é—á–∏, —á—Ç–æ–±—ã –Ω–µ —Ä–∞–∑–¥—É–≤–∞—Ç—å —Ñ–∞–π–ª—ã –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–∞–¥–∏ —Ä–µ–¥–∫–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤.
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–π:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–º–µ–Ω–∞ (sed) –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –æ–ø–µ—á–∞—Ç–æ–∫ –≤ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–∞—Ö.

#### Dependencies
- –ù–µ—Ç –Ω–æ–≤—ã—Ö npm –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
- –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (`npm run build`).

#### Status

---

## 2026-01-19 - Debugging White Screen & Fix Import Warnings

### Current Task
Diagnose and fix the "White Screen" issue occurring after deployment. The app loads but renders a blank screen.

### Architecture Decision
- **Enhanced Diagnostics**: Deployed an upgraded `ErrorBoundary` that captures and displays runtime errors with stack traces directly in the UI (replacing the generic "blank" state).
- **Import Fix**: Refactored `AIAgentSettings.tsx` to use **static import** of `newAuth` instead of dynamic `await import()`.
  - **Reason**: Vite emitted warnings about `auth_new.ts` being both statically and dynamically imported. This ambiguity can cause module loading race conditions or undefined behaviors in production builds, potentially crashing the app at startup.

### Files to Modify
- `frontend/src/components/ErrorBoundary.tsx` - improved error visualization (red box with details).
- `frontend/src/components/AIAgentSettings.tsx` - changed dynamic import to static.

### Trade-offs & Decisions
- **Static Import**: Increases initial bundle size slightly (vs dynamic), but guarantees `newAuth` is initialized consistently with `AIAgentsManagement`. Stability > micro-optimization of bundle size here.
- **Visible Errors**: Exposing stack traces in production is generally bad practice, but necessary for this specific debugging session where SSH access logs are insufficient to see client-side failures. Will be reverted after fix.

### Dependencies
- None.

### Status
- [ ] In Progress (Waiting for user verification)

### Status
- [x] Completed

---

## 2026-01-19 - Progress Tab Translation

### Current Task
Translate "Progress" tab components (`MetricsHistoryCharts.tsx` and `BusinessGrowthPlan.tsx`) to eliminate hardcoded Russian strings and use the `t()` function.

### Architecture Decision
- **Unified Translation Structure**: Adopted a nested structure in `en.ts` and `ru.ts` under `dashboard.progress` (e.g., `dashboard.progress.charts`, `dashboard.progress.growthPlan`) for better organization.
- **Component Refactoring**:
    - `MetricsHistoryCharts.tsx`: Added `useLanguage` hook, destructured `t`, and replaced strings.
    - `BusinessGrowthPlan.tsx`: Added `useLanguage` hook, destructured `t`, and replaced strings.

### Files to Modify
- `frontend/src/i18n/locales/ru.ts` - Added keys for charts and growth plan.
- `frontend/src/i18n/locales/en.ts` - Added corresponding English keys.
- `frontend/src/components/MetricsHistoryCharts.tsx` - Replaced strings with `t()` calls.
- `frontend/src/components/BusinessGrowthPlan.tsx` - Replaced strings with `t()` calls.

### Status
- [x] Completed

---

## 2026-01-14 - Localization Updates for Network & Parsing Management

### Current Task
Refactoring translation files to support Network and Parsing management features, and fixing syntax errors in locale files.

### Architecture Decision
- Added a global `common` object to `ru.ts` and `en.ts` for shared translations.
- Merged new `network` management keys into the existing `network` object structure within `dashboard` to preserve existing analytics translations while supporting the new UI.
- Updated `dashboard.network.title` to "Network Management" (was "Network Dashboard") to reflect the expanded functionality involved in managing networks, not just viewing stats.
- Added a new `parsing` object to `dashboard` for the Parsing Management UI.
- Fixed syntax errors (missing `export const` declarations and premature closing braces) in `ru.ts` and `en.ts`.

### Files to Modify
- `frontend/src/i18n/locales/ru.ts` - structure fixed, generic keys moved to `common`, `network` extended, `parsing` added.
- `frontend/src/i18n/locales/en.ts` - structure fixed, generic keys moved to `common`, `network` extended, `parsing` added.

### Trade-offs & Decisions
- **Merging vs Separation**: Decided to merge the new `network` management keys into the existing `dashboard.network` object. This avoids namespace collision and allows `dashboard.network` to be the single source of truth for all network-related translations, though it mixes analytics and management keys.
- **Title Update**: Changed the existing `title` from "Network Dashboard" to "Network Management". This was necessary for the new UI context. If the old analytics dashboard relies on this specific string, the context might slightly shift, but "Network Management" is broad enough to cover both.
- **Structure Repair**: The files had syntax errors (missing exports) and nesting issues. These were fixed to restore compilation.

### Dependencies
- None. Pure frontend resource update.

### Status
- [x] Completed

---

## 2026-01-14 - Global Localization Updates (All Languages)

### Current Task
Applying the structural fixes and new translation keys (Network & Parsing) to all remaining language files: `fr.ts`, `es.ts`, `de.ts`, `el.ts`, `th.ts`, `ar.ts`, `ha.ts`.

### Architecture Decision
- **Consistent Structure**: Applied the same `common` root object and `dashboard.network` / `dashboard.parsing` structure to all files as established in `ru.ts`/`en.ts`.
- **Syntax Correction**: Identified and fixed a syntax error where the key `2gis` was unquoted. It has been corrected to `"2gis"` in all updated files to ensure valid TypeScript objects.
- **Fallbacks**: Used English translations for new technical keys (like Parsing management) where native translations were not immediately available, ensuring functionality is not blocked by missing text.
- **Title Localization**: Preserved or updated the `dashboard.network.title` to the correct local language equivalents (e.g., "Netzwerkverwaltung" for German) where the term was already present or easily deducible.

### Files to Modify
- `frontend/src/i18n/locales/fr.ts`
- `frontend/src/i18n/locales/es.ts`
- `frontend/src/i18n/locales/de.ts`
- `frontend/src/i18n/locales/el.ts`
- `frontend/src/i18n/locales/th.ts`
- `frontend/src/i18n/locales/ar.ts`
- `frontend/src/i18n/locales/ha.ts`

### Trade-offs & Decisions
- **English Fallbacks**: Choosing to ship with English fallbacks for advanced/admin features (Parsing/Network management) allows us to release the feature globally without waiting for professional translation of technical terms.
- **Quoted Keys**: The usage of numerical keys like `2gis` requires quotes. This was a critical fix to prevent build errors.

### Status
- [x] Completed

---

## 2026-01-19 - Progress Tab Translations Fix

### Current Task
Fix "Russian text" appearing in "Progress" tab for non-English/Russian locales (e.g., German).

### Architecture Decision
- **Detected Issue**: The `dashboard.progress` section (Business Metrics, Growth Plan) was added to `ru.ts` and `en.ts` but missing from other locale files (`de`, `fr`, etc.), causing the UI to fall back to the default language (likely Russian or key names).
- **Resolution**: Propagated the comprehensive `dashboard.progress` block from `en.ts` to all 7 other locale files (`fr.ts`, `es.ts`, `de.ts`, `el.ts`, `th.ts`, `ar.ts`, `ha.ts`). Used English as the fallback content to ensuring immediate usability.

### Files to Modify
- `frontend/src/i18n/locales/fr.ts`
- `frontend/src/i18n/locales/es.ts`
- `frontend/src/i18n/locales/de.ts`
- `frontend/src/i18n/locales/el.ts`
- `frontend/src/i18n/locales/th.ts`
- `frontend/src/i18n/locales/ar.ts`
- `frontend/src/i18n/locales/ha.ts`

### Status
- [x] Completed

---

## 2026-01-13 - Comprehensive Localization Updates

### Current Task
Fixing remaining hardcoded Russian strings in "Progress", "Finance", "News", and "Settings" tabs, and propagating translation keys to all supported languages.

### Architecture Decision
- **Translation Propagation**: Expanded `common`, `dashboard.finance`, and `dashboard.progress` keys to all 9 locale files. Used English strings as fallback.
- **Component Localization**: Replaced hardcoded strings with `t()` calls in `ROICalculator.tsx`, `TransactionTable.tsx`, `MetricsHistoryCharts.tsx`, `WABACredentials.tsx`, `TelegramBotCredentials.tsx`, `NewsGenerator.tsx`.
- **Dynamic Formatting**: Implemented `useLanguage()` based date and currency formatting.

### Files to Modify
- `src/i18n/locales/*.ts` (all 9 files)
- `src/components/ROICalculator.tsx`
- `src/components/TransactionTable.tsx`
- `src/components/MetricsHistoryCharts.tsx`
- `src/components/WABACredentials.tsx`
- `src/components/TelegramBotCredentials.tsx`
- `src/components/NewsGenerator.tsx`

### Trade-offs & Decisions
- **English Fallback**: Chosen to use English for new keys in other languages to speed up implementation.
- **Batched Updates**: Grouped updates by tab to minimize file edits.

### Dependencies
- None.

### Status
- [x] Completed

## 2026-01-19 - Final Localization Polish

### Current Task
Eliminate remaining hardcoded strings in `FinancialMetrics.tsx` and translate English fallbacks in non-core languages (fr, de, es, el, th, ar, ha).

### Architecture Decision
- **Elimination of Fallbacks**: Replaced English fallback text in `dashboard.network` and `dashboard.parsing` sections for all non-English languages with native translations (Hausa, Arabic, Thai, French, German, Spanish, Greek).
- **Financial Metrics**: Replaced hardcoded Russian headers with `t()` calls in `FinancialMetrics.tsx`.

### Files Modified
- `frontend/src/components/FinancialMetrics.tsx` - Removed Russian strings.
- `frontend/src/i18n/locales/ha.ts` - Translated Network & Parsing.
- `frontend/src/i18n/locales/ar.ts` - Translated Parsing.
- `frontend/src/i18n/locales/th.ts` - Translated Parsing.
- `frontend/src/i18n/locales/fr.ts` - Translated Parsing.
- `frontend/src/i18n/locales/de.ts` - Translated Parsing.
- `frontend/src/i18n/locales/es.ts` - Translated Parsing.
- `frontend/src/i18n/locales/el.ts` - Translated Parsing.

### Trade-offs & Decisions
- **Manual Translation**: Used AI context to generate translations for technical terms in less common languages (Hausa, Thai), assuming standard terminology.
- **Completeness**: Prioritized having translated UI over perfect linguistic accuracy for administrative features (Parsing/Network), to meet the "no English fallbacks" requirement.

### Status
- [x] Completed

## 2026-01-19 - Growth Plan Stages Localization

### Current Task  
Translate dynamic Growth Plan stages (titles, descriptions, goals, tasks) from Russian database values to support all 9 languages.

### Architecture Decision
- **Frontend Translation Layer**: Instead of modifying the database, created a translation mapping in locale files that maps `stage_number` ‚Üí localized content
- **Component Modification**: Modified `BusinessGrowthPlan.tsx` to use `translateStage()` helper function that applies translations before rendering
- **Fallback Strategy**: If translation doesn't exist for a stage, component falls back to database value (Russian)

### Files Modified
- `frontend/src/components/BusinessGrowthPlan.tsx` - Added `translateStage()` helper, applies translations in render loop
- `frontend/src/i18n/locales/ru.ts` - Added `growthStages` object with Russian translations (from DB)
- `frontend/src/i18n/locales/en.ts` - Added `growthStages` object with English translations
- `frontend/src/i18n/locales/*.ts` (fr, es, de, el, th, ar, ha) - Added `growthStages` with English as temporary base

### Trade-offs & Decisions
- **Database vs Frontend**: Chose frontend translation over adding language columns to database
  - **Pro**: Simpler implementation, no database migration needed, easier for translators to update
  - **Con**: Large locale file size (+200 lines per language), but acceptable for 16 stages
- **English as Temporary Base**: Non-English/Russian languages use English translations temporarily
  - Can be replaced with native translations later without code changes
  - Ensures UI displays properly in all languages immediately

### Data Structure
Each stage contains:
- `title`, `description`, `goal`, `expectedResult`, `duration`: String fields
- `tasks`: Array of task strings (5-10 tasks per stage)
- Total: 16 stages for "beauty_salon" business type

### Verification
- ‚úÖ Build passed (`npm run build` successful)
- ‚úÖ All 9 locale files updated with proper TypeScript syntax
- ‚úÖ Changes committed and pushed to `main` (commit `57371e5`)

### Status
- [x] Completed

## 2026-01-19 - Network Health Dashboard + Playwright Headless Fix

### Current Task
Implement network health dashboard for Progress tab + fix critical Playwright parsing error.

### Architecture Decision
- Created `/api/network/health` and `/api/network/locations-alerts` endpoints
- Added alert thresholds to BusinessTypes table (news/photos/reviews days)
- Built NetworkHealthDashboard.tsx component (metric cards + location alerts)
- Fixed Playwright parsing error: changed headless=False to headless=True (parser_interception.py, analyzer.py)
- Integrated dashboard into Progress tab (replaced ProgressTracker)

### Files Modified
**Backend:**
- `src/api/network_health_api.py` (NEW)
- `src/main.py` - registered network_health_bp
- `src/parser_interception.py` - line 71: headless=True
- `src/analyzer.py` - line 402: headless=True
- `src/reports.db` - added 3 columns to BusinessTypes

**Frontend:**
- `frontend/src/components/NetworkHealthDashboard.tsx` (NEW)
- `frontend/src/pages/Dashboard.tsx` - integrated into Progress tab
- `frontend/src/i18n/locales/ru.ts` - added networkHealth translations
- `frontend/src/i18n/locales/en.ts` - added networkHealth translations
- `frontend/package.json` - added react-i18next, i18next

### Trade-offs
- **Alert thresholds in BusinessTypes**: Simple but less flexible than separate table
- **Replaced ProgressTracker**: Growth stages no longer visible (requested by user)
- **Headless=True**: Cannot debug CAPTCHA visually on server, but required for Linux
- **Russian-first localization**: Other languages use English fallback for now

### Dependencies
- Added: react-i18next, i18next (frontend)
- DB migration: 3 new columns in BusinessTypes table

### Status
- [x] Completed
- Commit: a236cdb
- Pushed to main
- Pending server deployment


## 2026-01-20 - Debugging Frontend Deployment & Network Health Dashboard

### Current Task
Deploying the Network Health Dashboard and resolving persistent issues where frontend updates were not reflecting in the browser.

### Architecture Decision
- **Cache Busting Strategy**: Implemented aggressive cache busting by manually versioning build artifacts (`index-TIMESTAMP.js`) and updating `index.html`. This bypasses Nginx's `immutable` cache headers which were preventing updates.
- **Component Association**: Identified that the `/dashboard/progress` route is handled by `ProgressPage.tsx`, not `Dashboard.tsx` (legacy). Switched implementation to `ProgressPage.tsx`.

### Files to Modify
- `frontend/src/pages/dashboard/ProgressPage.tsx` - Updated to render `NetworkHealthDashboard` and `FinancialMetrics`.
- `frontend/src/components/NetworkHealthDashboard.tsx` - Full implementation of the network health metrics.
- `frontend/src/i18n/locales/*.ts` - Fixed duplicate `growthStages` keys in all languages.

### Trade-offs & Decisions
- **Manual Cache Busting vs Config Change**: Chosen to force-rename files via script (`sed` in `index.html`) rather than risking Nginx config changes on a live production server without full access to reload strategies.
- **Direct SCP vs Git Pull**: Used `scp` for rapid iteration during debugging to bypass potential git/build pipeline latency or state mismatches.

### Dependencies
- No new external dependencies.
- valid `auth_new` library usage in `ProgressPage.tsx`.

### Debugging Learnings (Root Cause Analysis)
1.  **Nginx Caching**: The server configuration has `expires 1y; add_header Cache-Control "public, immutable";` for assets. Rebuilding Vite apps often produces the same filename (`index-HASH.js`) if code changes are minor. Nginx (and browsers) ignored the new content because the filename didn't change.
    *   *Fix*: Appending a timestamp to the filename (`mv old.js new-123.js`) forces a fresh download.
2.  **Routing Mismatch**: The project has legacy (`Dashboard.tsx`) and new (`dashboard/ProgressPage.tsx`) routing. We were editing the legacy file while the app was routing to the new one.
    *   *Fix*: Identified correct component via `grep "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ç—å—é"` and updated `ProgressPage.tsx`.

### Status
- [x] Completed

## 2026-01-20 - Yandex Maps 5-Star Growth Strategy

### Current Task
Implement the new "5 Stars on Yandex Maps" growth strategy guide as actionable stages and tasks in the application.

### Architecture Decision
- **Schema Extension**: Extended `GrowthTasks` table with `check_logic`, `reward_value`, `reward_type`, `tooltip`, `link_url`, `link_text`, `is_auto_verifiable` to support rich task features.
- **Content Population**: Created a dedicated script `populate_yandex_growth.py` to parse and insert the specific Yandex guide content, keeping content separation from logic.
- **Frontend Enhancement**: Updated `BusinessGrowthPlan.tsx` to render rich task details (tooltips, time-saved rewards) and adapted the data interface.

### Files to Modify
- `src/init_database_schema.py` - Checked base schema.
- `src/scripts/migrate_growth_tasks_schema.py` - Created migration for new columns.
- `src/api/growth_api.py` - Updated API to expose new fields.
- `src/scripts/populate_yandex_growth.py` - Created content population script.
- `frontend/src/components/BusinessGrowthPlan.tsx` - Updated UI to show tooltips and rewards.

### Trade-offs & Decisions
- **Database Schema vs JSON**: Selected explicit columns/schema extension for `GrowthTasks` over a JSON blob for better queryability and data integrity.
- **Russian-Native Content**: The provided guide is in Russian. Populated directly into DB. Frontend translation logic falls back to DB values, which is acceptable for the target audience.

### Dependencies
- No new external dependencies.
- Requires running migration and population scripts once.

### Status
- [x] Completed

## 2026-01-20 - UI/UX Pro Enhancements

### Current Task
Enhance the UI/UX of the "Growth Plan" using professional design standards (glassmorphism, advanced typography, iconic consistency).

### Architecture Decision
- **Design Tokens**: Created `frontend/src/lib/design-tokens.ts` to centralize "Pro" styles (glassmorphism, gradients, motion).
- **Iconography**: Replaced 100% of emojis in `BusinessGrowthPlan.tsx` with `lucide-react` SVG icons for vector consistency.
- **Glassmorphism**: Applied backdrop-blur and translucent backgrounds to cards and tooltips using the new tokens.

### Files to Modify
- `frontend/src/lib/design-tokens.ts` (NEW) - Central design system configs.
- `frontend/src/components/BusinessGrowthPlan.tsx` - Refactored to use new tokens and icons.

### Trade-offs & Decisions
- **Standard Icons**: Chose Lucide items over custom SVGs for immediate consistency with the rest of the generic UI.
- **Tailwind Extension**: Used `clsx` + `tailwind-merge` (standard `cn` utility) for dynamic class composition.

### Dependencies
- `lucide-react`, `clsx`, `tailwind-merge` (already present in package.json).

### Status
- [x] Completed

## 2026-01-20 - Fix Deployment Script (UI Not Updating)

### Current Task
The UI was not updating on the server because the accumulated build artifacts in `frontend/dist` were not being copied to the Nginx web root `/var/www/html`.

### Architecture Decision
Updated `deploy_network_health.sh` to explicitly clean and copy the new build to the web root.

### Files to Modify
- `deploy_network_health.sh` - added `cp -r dist/* /var/www/html/`

### Status
- [x] Completed

### Fix Database Population
The `populate_yandex_growth.py` script failed because of Foreign Key constraints.
- Updated script to delete `GrowthTasks` before deleting `GrowthStages`.

### Status
- [x] Completed

## 2026-01-20 - Interactive Growth Plan

### Current Task
Make the Growth Stages interactive so checks (Rating 4.5, 15 Reviews) are verified automatically against real data.

### Architecture Decision
- **Safe Read-Only Logic**: The check logic runs on-the-fly in `get_business_stages` API.
- **Frontend**: Updated `BusinessGrowthPlan.tsx` to show green checkmarks ‚úÖ for completed tasks.

### Files to Modify
- `src/api/growth_api.py` - Added `check_task_status` logic.
- `frontend/src/components/BusinessGrowthPlan.tsx` - Added visual completion states and removed manual toggle.

### Status
- [x] Completed

## 2026-01-20 - Merging Growth Plans

### Current Task
User requested to combine the new Yandex "5 Stars" plan (5 stages) with the previous extensive growth plan (formerly stages 3-16), keeping the new ones as 1-5 and appending the old ones as 6-19.

### Architecture Decision
- Modified `populate_yandex_growth.py`:
    - Kept the new interactive Yandex stages (1-5).
    - Appended the old stages from `ru.ts` (formerly 3-16) as new stages 6-19.
    - Converted old stages to the new `GrowthTasks` format in the Python script.
    - Set `check_logic = 'manual_check'` for old stages (since they don't have auto-verification logic yet).
    - Used `.get('tooltip')` to handle missing tooltips in old tasks.

### Files to Modify
- `src/scripts/populate_yandex_growth.py` - Added 14 old stages to the population list.

### Trade-offs & Decisions
- **Manual vs Auto**: Old stages are restored as "Manual Check" tasks. This preserves the content but doesn't block the user (they can manually check them off).
- **Hardcoding vs DB**: Moving everything to DB means we have a single source of truth and removed the conflict with `ru.ts`.

### Dependencies
- None.

### Status
- [x] Completed

## 2026-01-20 - UI/UX Pro Enhancements (Settings, Profile, Card)

### Current Task
Refactoring the `/dashboard/settings`, `/dashboard/profile`, and `/dashboard/card` pages to align with the new "Pro" design standard.

### Architecture Decision
- **Settings Page**: Replaced inline styles with `DESIGN_TOKENS`, added Lucide icons, glassmorphism.
- **Profile Page**: Refactored logic-preserving `ProfilePage.tsx` with glassmorphism. **Updated gradient** to Orange/Gold (user preference).
- **Card Page**: Complete rewrite of `CardOverviewPage.tsx` using specialized "Pro" glass components, refined typography, and Lucide icons suitable for service management.
- **Localization**: Ensured `t.common.error` is used for consistent error messaging.

### Files to Modify
- `frontend/src/pages/dashboard/SettingsPage.tsx`
- `frontend/src/components/SubscriptionManagement.tsx`
- `frontend/src/components/AIAgentSettings.tsx`
- `frontend/src/pages/dashboard/ProfilePage.tsx`
- `frontend/src/pages/dashboard/CardOverviewPage.tsx`

### Trade-offs & Decisions
- **Visual Consistency**: Unified all main dashboard pages under the same design system (`design-tokens.ts`).
- **User Preference**: Switched Profile completion banner to Orange/Gold to match "Progress" tab as requested.

### Dependencies
- `lucide-react`, `clsx`, `tailwind-merge`

### Status
- [x] Completed (Local Code)
- [ ] Deployment (Manual Git Pull Required)

## 2026-01-20 - UI/UX Pro Enhancements (Reviews & News)

### Current Task
Completing the "Pro" redesign for the `/dashboard/card` page by refactoring the Reviews and News child components.

### Architecture Decision
- **ReviewReplyAssistant**: Redesigned to use glass settings panel, quick generator, and card-based layout for reviews. Added detailed `Lucide` icons.
- **NewsGenerator**: Redesigned utilizing a 2-column settings layout, gradient action buttons, and clean card lists for generated/external news.
- **Consistency**: Both components now share the same visual language as `CardOverviewPage`.

### Files to Modify
- `frontend/src/components/ReviewReplyAssistant.tsx`
- `frontend/src/components/NewsGenerator.tsx`

### Status
- [x] Completed (Local Code)
- [ ] Deployment (Manual Git Pull Required)


## 2026-01-22 - UI Polish & Landing Page Redesign

### Current Task
Refine UI/UX of Profile and Card pages (Network Points visibility, scrollbars, button colors) and redesign the Landing Page (Hero section) to match "Pro" standards.

### Architecture Decision
- **Network Points Visibility**: Implemented logic in `ProfilePage.tsx` to conditionally render network points only for the parent account (`isNetworkMaster`).
- **Button Colors**: Updated primary action buttons in `CardOverviewPage`, `ReviewReplyAssistant`, `NewsGenerator`, and `Hero` to use an orange/amber gradient (`from-amber-500 to-orange-600`) instead of blue/violet.
- **Scrollbars**: Removed visible scrollbars from tabs in `CardOverviewPage` using `[&::-webkit-scrollbar]:hidden` utility class for cleaner UI.
- **Landing Page (Hero)**: Refactored `Hero.tsx` to use glassmorphism for the form container and applied the new color scheme. Added `networkNotice` to translation files to support `CardOverviewPage` alerts.

### Files to Modify
- `frontend/src/pages/dashboard/ProfilePage.tsx` - added conditional rendering for network points.
- `frontend/src/pages/dashboard/CardOverviewPage.tsx` - button colors, scrollbar removal.
- `frontend/src/components/ReviewReplyAssistant.tsx` - button colors.
- `frontend/src/components/NewsGenerator.tsx` - button colors.
- `frontend/src/components/Hero.tsx` - landing page refactoring (glassmorphism, colors).
- `frontend/src/i18n/locales/en.ts`, `ru.ts` - added `networkNotice` translation object.

### Trade-offs & Decisions
- **Modifying Translations**: Added `networkNotice` to translations to fix runtime errors and support the UI update in `CardOverviewPage`, ensuring internationalization consistency.
- **Glassmorphism**: Applied lightweight glassmorphism using Tailwind/CSS utilities (`backdrop-blur`, `bg-white/70`) which assumes modern browser support (standard today).

### Dependencies
- No new package dependencies.
- Relies on existing `DESIGN_TOKENS` and `cn` utility.

### Status
- [x] Completed
